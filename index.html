<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¹˜Mä¿¡æ¯å‘å¸ƒå¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: #ff5100;
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 5px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .announcement-bar {
            background: linear-gradient(135deg, #ff8a00, #ff5100);
            color: white;
            padding: 10px 0;
            margin-bottom: 20px;
            overflow: hidden;
            border-radius: 25px;
            box-shadow: 0 2px 10px rgba(255, 81, 0, 0.3);
        }
        
        .announcement-content {
            display: flex;
            align-items: center;
            white-space: nowrap;
            animation: scroll-left 20s linear infinite;
        }
        
        .announcement-content:hover {
            animation-play-state: paused;
        }
        
        .announcement-icon {
            margin-right: 15px;
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .announcement-text {
            font-size: 1rem;
            font-weight: 500;
            padding-right: 50px;
        }
        
        .edit-announcement-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            cursor: pointer;
            margin-left: auto;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        
        .edit-announcement-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .announcement-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        .announcement-modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .announcement-modal h3 {
            color: #ff5100;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .announcement-textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
            resize: vertical;
            margin-bottom: 15px;
        }
        
        .announcement-textarea:focus {
            outline: none;
            border-color: #ff5100;
            box-shadow: 0 0 0 3px rgba(255, 81, 0, 0.1);
        }
        
        @keyframes scroll-left {
            0% {
                transform: translateX(100%);
            }
            100% {
                transform: translateX(-100%);
            }
        }
        
        .tabs {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            gap: 5px;
        }
        
        .tab {
            padding: 10px 16px;
            cursor: pointer;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 2px solid #dee2e6;
            border-bottom: none;
            border-radius: 12px 12px 0 0;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        
        .tab:hover {
            background: linear-gradient(135deg, #fff5f0, #ffe8d6);
            border-color: #ffccbc;
            transform: translateY(-1px);
        }
        
        .tab.active {
            background: linear-gradient(135deg, #ff5100, #ff6b35);
            color: white;
            border-color: #ff5100;
            margin-bottom: -2px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(255, 81, 0, 0.3);
        }
        
        .tab-content {
            display: none;
            background-color: white;
            padding: 20px;
            border-radius: 0 5px 5px 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .tab-content.active {
            display: block;
        }
        
        form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        button {
            background: linear-gradient(135deg, #ff6b35, #ff5100);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 81, 0, 0.3);
        }
        
        button:hover {
            background: linear-gradient(135deg, #ff5100, #e64a00);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 81, 0, 0.4);
        }
        
        .search-form {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
        }
        
        .search-form input {
            flex: 1;
            padding: 12px 16px;
            font-size: 1rem;
            border: 2px solid #ddd;
            border-radius: 25px;
            transition: border-color 0.3s ease;
            min-width: 300px;
        }
        
        .search-form input:focus {
            outline: none;
            border-color: #ff5100;
            box-shadow: 0 0 0 3px rgba(255, 81, 0, 0.1);
        }
        
        .search-form button {
            padding: 12px 24px;
            font-size: 0.95rem;
            white-space: nowrap;
            min-width: auto;
            flex-shrink: 0;
        }
        
        .rides-list {
            display: grid;
            gap: 15px;
        }
        
        .ride-card {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .ride-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .no-rides {
            text-align: center;
            padding: 40px;
            color: #777;
        }
        
        footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 20px 0;
            margin-top: 40px;
            border-top: 3px solid #ff5100;
        }
        
        footer p {
            margin: 0;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* ç”¨æˆ·ç³»ç»Ÿæ ·å¼ */
        .user-info {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px 15px;
            border-radius: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-info.guest {
            background: #f8f9fa;
        }

        .user-info.logged-in {
            background: linear-gradient(135deg, #ff5100, #ff6b35);
            color: white;
        }

        .user-btn {
            background: #ff5100;
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .user-btn:hover {
            background: #e64a00;
            transform: scale(1.05);
        }

        .user-btn.logout {
            background: #dc3545;
            margin-left: 5px;
        }

        .user-btn.logout:hover {
            background: #c82333;
        }

        /* ä»˜è´¹æŸ¥çœ‹åŠŸèƒ½æ ·å¼ */
        .phone-hidden {
            color: #999;
            font-style: italic;
        }

        .reveal-phone-btn {
            background: linear-gradient(135deg, #20c997, #1ea085);
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-left: 10px;
            transition: all 0.3s ease;
        }

        .reveal-phone-btn:hover {
            background: linear-gradient(135deg, #1ea085, #1a8c77);
            transform: translateY(-1px);
        }

        .payment-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .payment-modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
        }

        .payment-modal h3 {
            color: #ff5100;
            margin-bottom: 20px;
        }

        .payment-price {
            font-size: 2rem;
            color: #ff5100;
            font-weight: bold;
            margin: 15px 0;
        }

        .payment-btn {
            background: linear-gradient(135deg, #20c997, #1ea085);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .payment-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(32, 201, 151, 0.3);
        }

        .cancel-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            margin-top: 10px;
        }

        /* ç”¨æˆ·æ³¨å†Œ/ç™»å½•è¡¨å•æ ·å¼ */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .auth-modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .auth-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-bottom: none;
        }

        .auth-tab.active {
            background: #ff5100;
            color: white;
            border-color: #ff5100;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        /* ç®¡ç†å‘˜åŠŸèƒ½æ ·å¼ */
        .admin-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            padding: 20px;
            z-index: 999;
            display: none;
            min-width: 350px;
            max-height: 600px;
            overflow-y: auto;
        }

        .admin-panel.show {
            display: block;
        }

        .admin-header {
            background: linear-gradient(135deg, #ff5100, #ff6b35);
            color: white;
            padding: 15px;
            border-radius: 10px 10px 0 0;
            margin: -20px -20px 20px -20px;
            text-align: center;
        }

        .admin-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .admin-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .admin-section h4 {
            color: #ff5100;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .recharge-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .recharge-form input, .recharge-form select {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .recharge-form input:focus, .recharge-form select:focus {
            outline: none;
            border-color: #ff5100;
        }

        .admin-btn {
            background: linear-gradient(135deg, #20c997, #1ea085);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .admin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(32, 201, 151, 0.3);
        }

        .admin-btn.danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }

        .user-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .user-item {
            padding: 8px 12px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
        }

        .user-item:last-child {
            border-bottom: none;
        }

        .user-item:hover {
            background: white;
        }

        .balance-info {
            color: #20c997;
            font-weight: 600;
        }

        /* åˆ†äº«åŠŸèƒ½æ ·å¼ */
        .share-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .share-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .share-amount {
            color: #28a745;
            font-size: 1.2rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .share-status {
            font-size: 0.85rem;
            color: #666;
            margin-top: 10px;
        }
        
        /* å‘å¸ƒæ ‡ç­¾é¡µæ ·å¼ */
        .publish-tab-content {
            display: none;
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        
        .publish-tab-content.active {
            display: block;
        }
        
        /* æ¡Œé¢å¿«æ·æ–¹å¼åŠŸèƒ½æ ·å¼ */
        .shortcut-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 15px;
            margin-top: 30px;
            border: 2px solid #dee2e6;
        }
        
        .shortcut-btn {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 10px;
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
        }
        
        .shortcut-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4);
        }
        
        .shortcut-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .device-info {
            background: white;
            padding: 12px 20px;
            border-radius: 20px;
            border: 2px solid #007bff;
            color: #007bff;
            font-weight: 500;
            display: inline-block;
            margin: 10px 0;
        }
        
        .instructions-box {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
            border: 1px solid #dee2e6;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .instructions-box h4 {
            color: #007bff;
            margin-bottom: 15px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
        }
        
        .instructions-box ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .instructions-box li {
            margin: 8px 0;
            line-height: 1.6;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <!-- ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ -->
    <div class="user-info" id="user-info">
        <span id="user-status">æ¸¸å®¢æ¨¡å¼</span>
        <button class="user-btn" onclick="showAuthModal()">ç™»å½•/æ³¨å†Œ</button>
    </div>

    <!-- ç®¡ç†å‘˜é¢æ¿ -->
    <div class="admin-panel" id="admin-panel">
        <div class="admin-header">
            <h3>ğŸ”§ ç®¡ç†å‘˜æ§åˆ¶å°</h3>
        </div>
        
        <!-- ç”¨æˆ·å……å€¼ç®¡ç† -->
        <div class="admin-section">
            <h4>ğŸ’° ç”¨æˆ·å……å€¼ç®¡ç†</h4>
            <div class="recharge-form">
                <select id="recharge-username" placeholder="é€‰æ‹©ç”¨æˆ·">
                    <option value="">è¯·é€‰æ‹©ç”¨æˆ·</option>
                </select>
                <input type="number" id="recharge-amount" placeholder="å……å€¼é‡‘é¢ï¼ˆå…ƒï¼‰" min="0.01" step="0.01">
                <input type="text" id="recharge-note" placeholder="å……å€¼å¤‡æ³¨ï¼ˆå¦‚ï¼šçº¿ä¸‹æ‰“æ¬¾ï¼‰">
                <button class="admin-btn" onclick="adminRecharge()">ç¡®è®¤å……å€¼</button>
            </div>
        </div>

        <!-- ç”¨æˆ·ä½™é¢æŸ¥çœ‹ -->
        <div class="admin-section">
            <h4>ğŸ‘¥ ç”¨æˆ·ä½™é¢æŸ¥çœ‹</h4>
            <div class="user-list" id="admin-user-list">
                <!-- ç”¨æˆ·åˆ—è¡¨å°†åŠ¨æ€åŠ è½½ -->
            </div>
        </div>

        <!-- åˆ†äº«å¥–åŠ±è®°å½• -->
        <div class="admin-section">
            <h4>ğŸ“± åˆ†äº«å¥–åŠ±è®°å½•</h4>
            <div class="user-list" id="share-records">
                <!-- åˆ†äº«è®°å½•å°†åŠ¨æ€åŠ è½½ -->
            </div>
        </div>

        <!-- å…³é—­é¢æ¿ -->
        <div style="text-align: center; margin-top: 20px;">
            <button class="admin-btn danger" onclick="hideAdminPanel()">å…³é—­é¢æ¿</button>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>æ¹˜Mä¿¡æ¯å‘å¸ƒå¹³å°</h1>
            <p class="subtitle">ä¹¡é•‡é¡ºé£è½¦ã€å†œå‰¯äº§å“ã€å•†æœºä¿¡æ¯ä¸€ç«™å¼æœåŠ¡å¹³å°</p>
        </header>
        
        <div class="announcement-bar">
            <div class="announcement-content">
                <span class="announcement-icon">ğŸ“¢</span>
                <span class="announcement-text" id="announcement-text">æ¬¢è¿ä½¿ç”¨æ¹˜Mä¿¡æ¯å‘å¸ƒå¹³å°ï¼è½¦æ‰¾äººã€äººæ‰¾è½¦ï¼Œä¾¿æ·å‡ºè¡Œï¼Œç»¿è‰²ç¯ä¿ï¼</span>
                <button class="edit-announcement-btn" onclick="showPasswordModal()">
                    <i>âœï¸</i> ç¼–è¾‘å…¬å‘Š
                </button>
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('find')">ğŸ  é¦–é¡µ</div>
            <div class="tab" onclick="switchTab('my-rides')">ğŸ“ ä¿¡æ¯å‘å¸ƒ</div>
            <div class="tab" onclick="switchTab('share')">åˆ†äº«èµšå¥–åŠ±</div>
        </div>
        
        <div id="find" class="tab-content active">
            <h2>ğŸ  æ¹˜Mä¿¡æ¯å‘å¸ƒå¹³å°é¦–é¡µ</h2>
            <p style="color: #666; margin-bottom: 20px;">æ±‡èšä¹¡é•‡å‡ºè¡Œä¿¡æ¯ã€å†œå‰¯äº§å“ã€å•†ä¸šæœºä¼šï¼Œä¾¿æ°‘æœåŠ¡å¹³å°</p>
            
            <div class="search-form">
                <input type="text" id="search-input" placeholder="ğŸ” æœç´¢å‡ºå‘åœ°ã€ç›®çš„åœ°ã€äº§å“ã€å•†æœº..." onkeypress="if(event.keyCode==13) searchAll()">
                <button onclick="searchAll()">ğŸ” æœç´¢</button>
            </div>
            
            <!-- ä¿¡æ¯åˆ†ç±»æ˜¾ç¤º -->
            <div style="margin: 30px 0;">
                <h3 style="color: #ff5100; margin-bottom: 20px; border-bottom: 2px solid #ff5100; padding-bottom: 5px;">
                    ğŸš— é¡ºé£è½¦å‡ºè¡Œä¿¡æ¯
                </h3>
                <div id="rides-container">
                    <div class="no-rides">
                        <p style="font-size: 2rem; margin-bottom: 10px;">ğŸš—</p>
                        <p>æš‚æ— é¡ºé£è½¦ä¿¡æ¯</p>
                    </div>
                </div>
            </div>
            
            <div style="margin: 30px 0;">
                <h3 style="color: #28a745; margin-bottom: 20px; border-bottom: 2px solid #28a745; padding-bottom: 5px;">
                    ğŸŒ¾ å†œå‰¯äº§å“ä¿¡æ¯
                </h3>
                <div id="products-container">
                    <div class="no-rides">
                        <p style="font-size: 2rem; margin-bottom: 10px;">ğŸŒ¾</p>
                        <p>æš‚æ— å†œå‰¯äº§å“ä¿¡æ¯</p>
                    </div>
                </div>
            </div>
            
            <div style="margin: 30px 0;">
                <h3 style="color: #007bff; margin-bottom: 20px; border-bottom: 2px solid #007bff; padding-bottom: 5px;">
                    ğŸ’¼ å•†æœºåˆä½œä¿¡æ¯
                </h3>
                <div id="businesses-container">
                    <div class="no-rides">
                        <p style="font-size: 2rem; margin-bottom: 10px;">ğŸ’¼</p>
                        <p>æš‚æ— å•†æœºä¿¡æ¯</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="my-rides" class="tab-content">
            <h2>æˆ‘çš„å‘å¸ƒ</h2>
            <p style="color: #666; margin-bottom: 20px;">å‘å¸ƒæ–°ä¿¡æ¯æˆ–æŸ¥çœ‹æ‚¨å·²å‘å¸ƒçš„å†…å®¹</p>
            
            <!-- å‘å¸ƒé€‰é¡¹æ ‡ç­¾ -->
            <div class="tabs" style="margin-bottom: 30px;">
                <div class="tab active" onclick="switchPublishTab('publish-ride')">ğŸš— è½¦æ‰¾äºº</div>
                <div class="tab" onclick="switchPublishTab('publish-passenger')">ğŸš¶ äººæ‰¾è½¦</div>
                <div class="tab" onclick="switchPublishTab('publish-product')">ğŸŒ¾ å†œå‰¯äº§å“</div>
                <div class="tab" onclick="switchPublishTab('publish-business')">ğŸ’¼ å•†æœºå‘å¸ƒ</div>
                <div class="tab" onclick="switchPublishTab('my-list')">ğŸ“‹ æˆ‘çš„å‘å¸ƒåˆ—è¡¨</div>
            </div>
            
            <!-- è½¦æ‰¾äººå‘å¸ƒè¡¨å• -->
            <div id="publish-ride" class="publish-tab-content active">
                <h3>ğŸš— å‘å¸ƒè½¦æ‰¾äººä¿¡æ¯</h3>
                <p>å‘å¸ƒæ‚¨çš„é¡ºé£è½¦ä¿¡æ¯ï¼Œå¯»æ‰¾åŒè¡Œçš„ä¹˜å®¢ã€‚</p>
                <form onsubmit="publishRide(event)">
                    <div class="form-group">
                        <label for="departure">å‡ºå‘åœ°</label>
                        <input type="text" id="departure" placeholder="ä¾‹å¦‚: ç‹å®¶æ‘æ‘å§”ä¼š" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="destination">ç›®çš„åœ°</label>
                        <input type="text" id="destination" placeholder="ä¾‹å¦‚: å¿åŸæ±½è½¦ç«™" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="date">å‡ºå‘æ—¥æœŸ</label>
                        <input type="date" id="date" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="time">å‡ºå‘æ—¶é—´</label>
                        <input type="time" id="time" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="seats">å¯ç”¨åº§ä½</label>
                        <select id="seats" required>
                            <option value="">è¯·é€‰æ‹©</option>
                            <option value="1">1ä¸ªåº§ä½</option>
                            <option value="2">2ä¸ªåº§ä½</option>
                            <option value="3">3ä¸ªåº§ä½</option>
                            <option value="4">4ä¸ªåº§ä½</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="price">æ¯äººè´¹ç”¨</label>
                        <input type="number" id="price" placeholder="ä¾‹å¦‚: 10" required>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="notes">å¤‡æ³¨ä¿¡æ¯</label>
                        <textarea id="notes" rows="3" placeholder="ä¾‹å¦‚: åå¤‡ç®±ç©ºé—´æœ‰é™ï¼Œå¤§ä»¶è¡Œæè¯·æå‰å‘ŠçŸ¥"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="name">è”ç³»äºº</label>
                        <input type="text" id="name" placeholder="æ‚¨çš„å§“å" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="phone">è”ç³»ç”µè¯</label>
                        <input type="tel" id="phone" placeholder="æ‚¨çš„æ‰‹æœºå·ç " required>
                    </div>
                    
                    <div class="form-group full-width">
                        <button type="submit">å‘å¸ƒè½¦æ‰¾äººä¿¡æ¯</button>
                    </div>
                </form>
            </div>
            
            <!-- äººæ‰¾è½¦å‘å¸ƒè¡¨å• -->
            <div id="publish-passenger" class="publish-tab-content">
                <h3>ğŸš¶ å‘å¸ƒäººæ‰¾è½¦ä¿¡æ¯</h3>
                <p>å‘å¸ƒæ‚¨çš„ä¹˜è½¦éœ€æ±‚ï¼Œå¯»æ‰¾åˆé€‚çš„é¡ºé£è½¦ã€‚</p>
                <form onsubmit="publishPassenger(event)">
                    <div class="form-group">
                        <label for="passenger-departure">å‡ºå‘åœ°</label>
                        <input type="text" id="passenger-departure" placeholder="ä¾‹å¦‚: æå®¶æ‘å°å­¦" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="passenger-destination">ç›®çš„åœ°</label>
                        <input type="text" id="passenger-destination" placeholder="ä¾‹å¦‚: å¿åŸåŒ»é™¢" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="passenger-date">å‡ºå‘æ—¥æœŸ</label>
                        <input type="date" id="passenger-date" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="passenger-time">å‡ºå‘æ—¶é—´</label>
                        <input type="time" id="passenger-time" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="passenger-count">ä¹˜è½¦äººæ•°</label>
                        <select id="passenger-count" required>
                            <option value="">è¯·é€‰æ‹©</option>
                            <option value="1">1äºº</option>
                            <option value="2">2äºº</option>
                            <option value="3">3äºº</option>
                            <option value="4">4äºº</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="passenger-budget">é¢„ç®—è´¹ç”¨</label>
                        <input type="number" id="passenger-budget" placeholder="ä¾‹å¦‚: 15" required>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="passenger-notes">ç‰¹åˆ«éœ€æ±‚</label>
                        <textarea id="passenger-notes" rows="3" placeholder="ä¾‹å¦‚: æœ‰å„¿ç«¥åº§æ¤…éœ€æ±‚ï¼Œæœ‰å¤§ä»¶è¡Œæ"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="passenger-name">è”ç³»äºº</label>
                        <input type="text" id="passenger-name" placeholder="æ‚¨çš„å§“å" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="passenger-phone">è”ç³»ç”µè¯</label>
                        <input type="tel" id="passenger-phone" placeholder="æ‚¨çš„æ‰‹æœºå·ç " required>
                    </div>
                    
                    <div class="form-group full-width">
                        <button type="submit">å‘å¸ƒäººæ‰¾è½¦ä¿¡æ¯</button>
                    </div>
                </form>
            </div>
            
            <!-- å†œå‰¯äº§å“å‘å¸ƒè¡¨å• -->
            <div id="publish-product" class="publish-tab-content">
                <h3>ğŸŒ¾ å†œå‰¯äº§å“å‘å¸ƒ</h3>
                <p>å‘å¸ƒæ‚¨çš„å†œå‰¯äº§å“ä¿¡æ¯ï¼Œæ‹“å±•é”€å”®æ¸ é“ï¼Œä¿ƒè¿›å†œäº§å“æµé€šã€‚</p>
                <form onsubmit="publishProduct(event)">
                    <div class="form-group">
                        <label for="product-name">äº§å“åç§°</label>
                        <input type="text" id="product-name" placeholder="ä¾‹å¦‚: åœŸé¸¡è›‹ã€æ–°é²œè”¬èœã€æ‰‹å·¥è±†è…" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-category">äº§å“ç±»åˆ«</label>
                        <select id="product-category" required>
                            <option value="">è¯·é€‰æ‹©</option>
                            <option value="vegetables">æ–°é²œè”¬èœ</option>
                            <option value="fruits">æ—¶ä»¤æ°´æœ</option>
                            <option value="grains">ç²®é£Ÿæ‚ç²®</option>
                            <option value="livestock">ç¦½ç•œäº§å“</option>
                            <option value="aquatic">æ°´äº§æµ·é²œ</option>
                            <option value="processed">åŠ å·¥é£Ÿå“</option>
                            <option value="handmade">æ‰‹å·¥åˆ¶å“</option>
                            <option value="other">å…¶ä»–äº§å“</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-quantity">ä¾›åº”æ•°é‡</label>
                        <input type="text" id="product-quantity" placeholder="ä¾‹å¦‚: 50æ–¤ã€20ä¸ªã€100å…¬æ–¤" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-price">é¢„æœŸä»·æ ¼</label>
                        <input type="text" id="product-price" placeholder="ä¾‹å¦‚: 5å…ƒ/æ–¤ã€120å…ƒ/ç®±" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-location">äº§å“äº§åœ°</label>
                        <input type="text" id="product-location" placeholder="ä¾‹å¦‚: ç‹å®¶æ‘ç”Ÿæ€å†œåœº" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-harvest">é‡‡æ”¶æ—¶é—´</label>
                        <input type="date" id="product-harvest" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-quality">å“è´¨ç­‰çº§</label>
                        <select id="product-quality" required>
                            <option value="">è¯·é€‰æ‹©</option>
                            <option value="organic">æœ‰æœºè®¤è¯</option>
                            <option value="green">ç»¿è‰²æ— å…¬å®³</option>
                            <option value="ecological">ç”Ÿæ€ç§æ¤</option>
                            <option value="traditional">ä¼ ç»Ÿç§æ¤</option>
                            <option value="standard">å¸¸è§„æ ‡å‡†</option>
                        </select>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="product-description">äº§å“æè¿°</label>
                        <textarea id="product-description" rows="3" placeholder="è¯·è¯¦ç»†æè¿°äº§å“ç‰¹ç‚¹ã€ç§æ¤æ–¹å¼ã€è¥å…»ä»·å€¼ç­‰ä¿¡æ¯..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-contact">è”ç³»äºº</label>
                        <input type="text" id="product-contact" placeholder="æ‚¨çš„å§“å" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-phone">è”ç³»ç”µè¯</label>
                        <input type="tel" id="product-phone" placeholder="æ‚¨çš„æ‰‹æœºå·ç " required>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-wechat">å¾®ä¿¡å·ï¼ˆé€‰å¡«ï¼‰</label>
                        <input type="text" id="product-wechat" placeholder="ä¾¿äºå®¢æˆ·å¾®ä¿¡è”ç³»">
                    </div>
                    
                    <div class="form-group full-width">
                        <button type="submit">ğŸŒ¾ å‘å¸ƒå†œå‰¯äº§å“</button>
                    </div>
                </form>
            </div>
            
            <!-- å•†æœºå‘å¸ƒè¡¨å• -->
            <div id="publish-business" class="publish-tab-content">
                <h3>ğŸ’¼ å•†æœºå‘å¸ƒ</h3>
                <p>å‘å¸ƒå•†ä¸šåˆä½œä¿¡æ¯ã€æ‹›å•†ä¿¡æ¯ã€æ±‚èŒæ‹›è˜ç­‰å•†ä¸šæœºä¼šã€‚</p>
                <form onsubmit="publishBusiness(event)">
                    <div class="form-group">
                        <label for="business-title">å•†æœºæ ‡é¢˜</label>
                        <input type="text" id="business-title" placeholder="ä¾‹å¦‚: å¯»æ‰¾åˆä½œä¼™ä¼´ã€åº—é“ºè½¬è®©ã€è®¾å¤‡è½¬è®©" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="business-type">å•†æœºç±»å‹</label>
                        <select id="business-type" required>
                            <option value="">è¯·é€‰æ‹©</option>
                            <option value="cooperation">å•†ä¸šåˆä½œ</option>
                            <option value="investment">æŠ•èµ„æ‹›å•†</option>
                            <option value="transfer">åº—é“ºè½¬è®©</option>
                            <option value="equipment">è®¾å¤‡è½¬è®©</option>
                            <option value="recruitment">æ‹›è˜æ±‚èŒ</option>
                            <option value="procurement">é‡‡è´­éœ€æ±‚</option>
                            <option value="service">æœåŠ¡æä¾›</option>
                            <option value="other">å…¶ä»–å•†æœº</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="business-investment">æŠ•èµ„é‡‘é¢</label>
                        <select id="business-investment" required>
                            <option value="">è¯·é€‰æ‹©</option>
                            <option value="small">1ä¸‡å…ƒä»¥ä¸‹</option>
                            <option value="medium">1-5ä¸‡å…ƒ</option>
                            <option value="large">5-10ä¸‡å…ƒ</option>
                            <option value="xlarge">10ä¸‡å…ƒä»¥ä¸Š</option>
                            <option value="negotiable">é¢è®®</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="business-location">æ‰€åœ¨åœ°åŒº</label>
                        <input type="text" id="business-location" placeholder="ä¾‹å¦‚: æŸæŸä¹¡é•‡ã€æŸæŸå¿åŸ" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="business-expiry">æœ‰æ•ˆæœŸé™</label>
                        <input type="date" id="business-expiry" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="business-urgency">ç´§æ€¥ç¨‹åº¦</label>
                        <select id="business-urgency" required>
                            <option value="">è¯·é€‰æ‹©</option>
                            <option value="urgent">ç´§æ€¥</option>
                            <option value="normal">ä¸€èˆ¬</option>
                            <option value="relaxed">ä¸æ€¥</option>
                        </select>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="business-description">è¯¦ç»†è¯´æ˜</label>
                        <textarea id="business-description" rows="4" placeholder="è¯·è¯¦ç»†æè¿°å•†æœºå†…å®¹ã€åˆä½œæ¡ä»¶ã€å…·ä½“è¦æ±‚ç­‰ä¿¡æ¯..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="business-contact">è”ç³»äºº</label>
                        <input type="text" id="business-contact" placeholder="æ‚¨çš„å§“åæˆ–å…¬å¸åç§°" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="business-phone">è”ç³»ç”µè¯</label>
                        <input type="tel" id="business-phone" placeholder="æ‚¨çš„æ‰‹æœºå·ç " required>
                    </div>
                    
                    <div class="form-group">
                        <label for="business-email">é‚®ç®±åœ°å€</label>
                        <input type="email" id="business-email" placeholder="ä¾¿äºå‘é€è¯¦ç»†èµ„æ–™">
                    </div>
                    
                    <div class="form-group full-width">
                        <button type="submit">ğŸ’¼ å‘å¸ƒå•†æœºä¿¡æ¯</button>
                    </div>
                </form>
            </div>
            
            <!-- æˆ‘çš„å‘å¸ƒåˆ—è¡¨ -->
            <div id="my-list" class="publish-tab-content">
                <h3>ğŸ“‹ æˆ‘å·²å‘å¸ƒçš„ä¿¡æ¯</h3>
                <div id="my-rides-container">
                    <div class="no-rides">
                        <p style="font-size: 3rem; margin-bottom: 15px;">ğŸ“</p>
                        <p>æ‚¨è¿˜æ²¡æœ‰å‘å¸ƒè¿‡ä»»ä½•ä¿¡æ¯</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="share" class="tab-content">
            <h2>ğŸ“± åˆ†äº«èµšå¥–åŠ±</h2>
            <p>åˆ†äº«å¹³å°åˆ°å¾®ä¿¡ç¾¤æˆ–æœ‹å‹åœˆï¼Œæ¯æ—¥å‰5æ¬¡åˆ†äº«å¯è·å¾—å¥–åŠ±ï¼</p>
            
            <div class="share-section">
                <div style="font-size: 1.2rem; margin-bottom: 20px; color: #333;">
                    <strong>ğŸŒŸ åˆ†äº«å¥–åŠ±è§„åˆ™</strong><br>
                    <span style="font-size: 0.9rem; color: #666;">
                        â€¢ åˆ†äº«åˆ°å¾®ä¿¡ç¾¤ï¼šå¥–åŠ± Â¥0.10<br>
                        â€¢ åˆ†äº«åˆ°æœ‹å‹åœˆï¼šå¥–åŠ± Â¥0.10<br>
                        â€¢ æ¯æ—¥å‰5æ¬¡åˆ†äº«æœ‰æ•ˆè®¡è´¹<br>
                        â€¢ æ¯æ—¥æœ€å¤šå¯è·å¾— Â¥0.50 å¥–åŠ±<br>
                        â€¢ è¶…è¿‡5æ¬¡ååˆ†äº«æ— å¥–åŠ±
                    </span>
                </div>
                
                <div style="margin: 20px 0;">
                    <button class="share-btn" onclick="shareToWechat()">
                        ğŸ“‹ å¤åˆ¶é“¾æ¥åˆ†äº«åˆ°å¾®ä¿¡ç¾¤
                    </button>
                    <button class="share-btn" onclick="shareToMoments()">
                        ğŸ“· åˆ†äº«åˆ°æœ‹å‹åœˆ
                    </button>
                </div>
                
                <div class="share-amount">
                    ä»Šæ—¥å·²èµšï¼šÂ¥<span id="today-share-amount">0.00</span>
                </div>
                
                <div style="font-size: 0.9rem; color: #666; margin: 10px 0;">
                    åˆ†äº«æ¬¡æ•°ï¼š<span id="today-share-count">0/5</span>ï¼ˆå‰5æ¬¡æœ‰æ•ˆï¼‰
                </div>
                
                <div class="share-status" id="share-status">
                    åˆ†äº«æˆåŠŸåå¥–åŠ±å°†è‡ªåŠ¨åˆ°è´¦
                </div>
            </div>
            
            <!-- æ¡Œé¢å¿«æ·æ–¹å¼åˆ›å»ºåŒºåŸŸ -->
            <div class="shortcut-section">
                <h3 style="color: #ff5100; margin-bottom: 15px; text-align: center;">ğŸ–¥ï¸ åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼</h3>
                <p style="text-align: center; color: #666; margin-bottom: 20px;">ä¸€é”®åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼ï¼Œéšæ—¶è®¿é—®æ¹˜Mä¿¡æ¯å‘å¸ƒå¹³å°</p>
                
                <div style="text-align: center; margin: 20px 0;">
                    <button id="create-shortcut-btn" class="shortcut-btn pulse-animation" onclick="createDesktopShortcut()">
                        âš¡ åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼
                    </button>
                </div>
                
                <div id="shortcut-status" style="text-align: center; font-size: 0.9rem; color: #666; margin-top: 15px;">
                    <span id="device-info" class="device-info">æ­£åœ¨æ£€æµ‹æ‚¨çš„è®¾å¤‡ç±»å‹...</span>
                </div>
                
                <div id="shortcut-instructions" class="instructions-box" style="display: none;">
                    <h4>ğŸ“‹ æ“ä½œè¯´æ˜</h4>
                    <div id="instruction-text"></div>
                </div>
            </div>
        </div>
    </div>
    </div>
    
    <footer>
        <div class="container">
            <p>Â© 2025 æ¹˜Mé¡ºé£è½¦å‘å¸ƒå¹³å° | ç»¿è‰²å‡ºè¡Œ Â· å…±äº«èµ„æº Â· ä¾¿åˆ©ç”Ÿæ´»</p>
        </div>
    </footer>

    <!-- å¯†ç éªŒè¯æ¨¡æ€æ¡† -->
    <div class="announcement-modal" id="password-modal">
        <div class="announcement-modal-content">
            <h3>ğŸ” ç®¡ç†å‘˜éªŒè¯</h3>
            <p style="margin-bottom: 15px; text-align: center; color: #666;">è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ä»¥ç¼–è¾‘å…¬å‘Š</p>
            <input type="password" class="announcement-textarea" id="password-input" placeholder="è¯·è¾“å…¥å¯†ç ..." style="min-height: auto;" onkeypress="if(event.keyCode==13) verifyPassword()">
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button onclick="hidePasswordModal()" style="background: #6c757d;">å–æ¶ˆ</button>
                <button onclick="verifyPassword()">éªŒè¯</button>
            </div>
        </div>
    </div>

    <!-- ç”¨æˆ·è®¤è¯æ¨¡æ€æ¡† -->
    <div class="auth-modal" id="auth-modal">
        <div class="auth-modal-content">
            <h3>ğŸ‘¤ ç”¨æˆ·ä¸­å¿ƒ</h3>
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="switchAuthTab('login')">ç™»å½•</div>
                <div class="auth-tab" onclick="switchAuthTab('register')">æ³¨å†Œ</div>
            </div>
            
            <!-- ç™»å½•è¡¨å• -->
            <div class="auth-form active" id="login-form">
                <div class="form-group">
                    <label for="login-username">ç”¨æˆ·å</label>
                    <input type="text" id="login-username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required>
                </div>
                <div class="form-group">
                    <label for="login-password">å¯†ç </label>
                    <input type="password" id="login-password" placeholder="è¯·è¾“å…¥å¯†ç " required>
                </div>
                <div class="form-group">
                    <button type="button" class="user-btn" onclick="login()">ç™»å½•</button>
                </div>
            </div>
            
            <!-- æ³¨å†Œè¡¨å• -->
            <div class="auth-form" id="register-form">
                <div class="form-group">
                    <label for="register-username">ç”¨æˆ·å</label>
                    <input type="text" id="register-username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required>
                </div>
                <div class="form-group">
                    <label for="register-password">å¯†ç </label>
                    <input type="password" id="register-password" placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰" required>
                </div>
                <div class="form-group">
                    <label for="register-phone">æ‰‹æœºå·</label>
                    <input type="tel" id="register-phone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" required>
                </div>
                <div class="form-group">
                    <button type="button" class="user-btn" onclick="register()">æ³¨å†Œ</button>
                </div>
            </div>
            
            <div style="margin-top: 15px; text-align: center;">
                <button class="cancel-btn" onclick="hideAuthModal()">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- ä»˜è´¹æŸ¥çœ‹æ¨¡æ€æ¡† -->
    <div class="payment-modal" id="payment-modal">
        <div class="payment-modal-content">
            <h3>ğŸ’° æŸ¥çœ‹è”ç³»æ–¹å¼</h3>
            <p>æŸ¥çœ‹è”ç³»æ–¹å¼éœ€è¦æ”¯ä»˜è´¹ç”¨</p>
            <div class="payment-price">Â¥0.20</div>
            <p style="color: #666; font-size: 0.9rem;">æ”¯ä»˜åå¯æŸ¥çœ‹å®Œæ•´ç”µè¯å·ç å¹¶ç›´æ¥æ‹¨æ‰“</p>
            
            <div style="margin: 20px 0;">
                <button class="payment-btn" onclick="simulatePayment()">ç«‹å³æ”¯ä»˜</button>
            </div>
            
            <button class="cancel-btn" onclick="hidePaymentModal()">å–æ¶ˆ</button>
        </div>
    </div>

    <!-- å…¬å‘Šç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="announcement-modal" id="announcement-modal">
        <div class="announcement-modal-content">
            <h3>ğŸ“¢ ç¼–è¾‘å…¬å‘Šå†…å®¹</h3>
            <textarea class="announcement-textarea" id="announcement-textarea" placeholder="è¯·è¾“å…¥å…¬å‘Šå†…å®¹..."></textarea>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button onclick="hideAnnouncementModal()" style="background: #6c757d;">å–æ¶ˆ</button>
                <button onclick="saveAnnouncement()">ä¿å­˜å…¬å‘Š</button>
            </div>
        </div>
    </div>

    <script>
        // æ•°æ®åº“æœåŠ¡
        const databaseService = {
            // æ¨¡æ‹Ÿæ•°æ®åº“æœåŠ¡ï¼Œä½¿ç”¨ localStorage ä½œä¸ºå­˜å‚¨
            isOnline: false,
            
            async getData(collection) {
                try {
                    const data = localStorage.getItem(collection);
                    return data ? JSON.parse(data) : [];
                } catch (error) {
                    console.error('è·å–æ•°æ®å¤±è´¥:', error);
                    return [];
                }
            },
            
            async saveData(collection, data) {
                try {
                    localStorage.setItem(collection, JSON.stringify(data));
                    return true;
                } catch (error) {
                    console.error('ä¿å­˜æ•°æ®å¤±è´¥:', error);
                    return false;
                }
            },
            
            async deleteData(collection, id) {
                try {
                    const currentData = await this.getData(collection);
                    const filteredData = currentData.filter(item => item.id !== id);
                    localStorage.setItem(collection, JSON.stringify(filteredData));
                    return true;
                } catch (error) {
                    console.error('åˆ é™¤æ•°æ®å¤±è´¥:', error);
                    return false;
                }
            },
            
            syncOfflineData() {
                // æ¨¡æ‹Ÿç¦»çº¿æ•°æ®åŒæ­¥
                console.log('åŒæ­¥ç¦»çº¿æ•°æ®...');
            }
        };
        
        // æ•°æ®å­˜å‚¨

        // æ•°æ®å­˜å‚¨
        var rides = [];
        var passengers = [];
        var products = [];
        var businesses = [];
        
        // ç”¨æˆ·ç³»ç»Ÿ
        var currentUser = null;
        var users = [];
        var paidContacts = []; // å­˜å‚¨å·²ä»˜è´¹æŸ¥çœ‹çš„è”ç³»æ–¹å¼
        var shareRecords = []; // å­˜å‚¨åˆ†äº«å¥–åŠ±è®°å½•
        var adminUsers = ['admin']; // ç®¡ç†å‘˜ç”¨æˆ·åˆ—è¡¨
        
        // æ–°çš„æ•°æ®åŠ è½½å‡½æ•°
        async function loadAllData() {
            try {
                // ä»databaseè·å–æ•°æ®
                const allRides = await databaseService.getData('rides');
                
                // åˆ†ç¦»è½¦æ‰¾äººä¿¡æ¯å’Œäººæ‰¾è½¦ä¿¡æ¯
                rides = allRides.filter(ride => ride.type === 'car-find-passenger');
                passengers = allRides.filter(ride => ride.type === 'passenger-find-car');
                
                products = await databaseService.getData('products');
                businesses = await databaseService.getData('businesses');
                users = await databaseService.getData('users');
                
                console.log('æ•°æ®åŠ è½½å®Œæˆï¼š');
                console.log('- è½¦æ‰¾äººä¿¡æ¯ï¼š' + rides.length + ' æ¡');
                console.log('- äººæ‰¾è½¦ä¿¡æ¯ï¼š' + passengers.length + ' æ¡');
                console.log('- å†œå‰¯äº§å“ï¼š' + products.length + ' æ¡');
                console.log('- å•†æœºä¿¡æ¯ï¼š' + businesses.length + ' æ¡');
                console.log('- ç”¨æˆ·æ•°æ®ï¼š' + users.length + ' ä¸ªç”¨æˆ·');
                
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                // å‡ºé”™æ—¶ä½¿ç”¨æœ¬åœ°å­˜å‚¨æ•°æ®
                loadFromLocalStorage();
            }
        }
        
        // åŸæœ‰çš„æœ¬åœ°å­˜å‚¨åŠ è½½å‡½æ•°ä½œä¸ºå¤‡ç”¨
        function loadFromLocalStorage() {
            try {
                var savedRides = localStorage.getItem('rides');
                var savedPassengers = localStorage.getItem('passengers');
                var savedProducts = localStorage.getItem('products');
                var savedBusinesses = localStorage.getItem('businesses');
                var savedUsers = localStorage.getItem('users');
                
                rides = savedRides ? JSON.parse(savedRides) : [];
                passengers = savedPassengers ? JSON.parse(savedPassengers) : [];
                products = savedProducts ? JSON.parse(savedProducts) : [];
                businesses = savedBusinesses ? JSON.parse(savedBusinesses) : [];
                users = savedUsers ? JSON.parse(savedUsers) : [];
                
                console.log('ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®å®Œæˆ');
            } catch (e) {
                console.error('ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®å¤±è´¥:', e);
                rides = [];
                passengers = [];
                products = [];
                businesses = [];
                users = [];
            }
        }
        
        // å½“å‰è¦æŸ¥çœ‹çš„è”ç³»æ–¹å¼
        var currentViewingRide = null;
        var currentViewingType = null;
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabId) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            var tabContents = document.querySelectorAll('.tab-content');
            for (var i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            // å–æ¶ˆæ‰€æœ‰æ ‡ç­¾çš„æ´»åŠ¨çŠ¶æ€
            var tabs = document.querySelectorAll('.tab');
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾å†…å®¹
            var targetContent = document.getElementById(tabId);
            if (targetContent) {
                targetContent.classList.add('active');
            }
            
            // è®¾ç½®é€‰ä¸­æ ‡ç­¾çš„æ´»åŠ¨çŠ¶æ€
            for (var i = 0; i < tabs.length; i++) {
                var onclick = tabs[i].getAttribute('onclick');
                if (onclick && onclick.indexOf("switchTab('" + tabId + "')") !== -1) {
                    tabs[i].classList.add('active');
                    break;
                }
            }
            
            // å¦‚æœæ˜¯é¦–é¡µæ ‡ç­¾ï¼Œåˆ·æ–°æ‰€æœ‰ä¿¡æ¯åˆ—è¡¨
            if (tabId === 'find') {
                displayAllInfo();
            }
            
            // å¦‚æœæ˜¯æˆ‘çš„å‘å¸ƒæ ‡ç­¾ï¼Œåˆ·æ–°åˆ—è¡¨
            if (tabId === 'my-rides') {
                displayMyRides();
            }
        }
        
        // åˆ‡æ¢å‘å¸ƒæ ‡ç­¾é¡µ
        function switchPublishTab(tabId) {
            // éšè—æ‰€æœ‰å‘å¸ƒæ ‡ç­¾å†…å®¹
            var tabContents = document.querySelectorAll('.publish-tab-content');
            for (var i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            // å–æ¶ˆæ‰€æœ‰å‘å¸ƒæ ‡ç­¾çš„æ´»åŠ¨çŠ¶æ€
            var tabs = document.querySelectorAll('#my-rides .tab');
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            // æ˜¾ç¤ºé€‰ä¸­çš„å‘å¸ƒæ ‡ç­¾å†…å®¹
            var targetContent = document.getElementById(tabId);
            if (targetContent) {
                targetContent.classList.add('active');
            }
            
            // è®¾ç½®é€‰ä¸­å‘å¸ƒæ ‡ç­¾çš„æ´»åŠ¨çŠ¶æ€
            for (var i = 0; i < tabs.length; i++) {
                var onclick = tabs[i].getAttribute('onclick');
                if (onclick && onclick.indexOf("switchPublishTab('" + tabId + "')") !== -1) {
                    tabs[i].classList.add('active');
                    break;
                }
            }
            
            // å¦‚æœæ˜¯æˆ‘çš„å‘å¸ƒåˆ—è¡¨æ ‡ç­¾ï¼Œåˆ·æ–°åˆ—è¡¨
            if (tabId === 'my-list') {
                displayMyRides();
            }
        }
        
        // æ˜¾ç¤ºäº§å“åˆ—è¡¨
        function displayProducts() {
            var productsContainer = document.getElementById('products-container');
            
            if (products.length === 0) {
                productsContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸŒ¾</p><p>æš‚æ— å†œå‰¯äº§å“ä¿¡æ¯</p></div>';
                return;
            }
            
            var html = '<h3 style="color: #28a745; margin-bottom: 15px;">ğŸŒ¾ æ‰€æœ‰å†œå‰¯äº§å“ï¼ˆå…± ' + products.length + ' æ¡ï¼‰</h3>';
            for (var i = 0; i < products.length; i++) {
                var product = products[i];
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: #28a745; margin: 0;">' + product.name + '</h3>';
                html += '</div>';
                
                if (product.category) {
                    html += '<p><strong>ç±»åˆ«ï¼š</strong>' + product.category + '</p>';
                }
                
                if (product.quantity) {
                    html += '<p><strong>æ•°é‡ï¼š</strong>' + product.quantity + '</p>';
                }
                
                if (product.price) {
                    html += '<p><strong>ä»·æ ¼ï¼š</strong>' + product.price + '</p>';
                }
                
                if (product.location) {
                    html += '<p><strong>äº§åœ°ï¼š</strong>' + product.location + '</p>';
                }
                
                if (product.harvest) {
                    html += '<p><strong>é‡‡æ”¶æ—¶é—´ï¼š</strong>' + product.harvest + '</p>';
                }
                
                if (product.quality) {
                    html += '<p><strong>å“è´¨ç­‰çº§ï¼š</strong>' + product.quality + '</p>';
                }
                
                if (product.description) {
                    html += '<p><strong>æè¿°ï¼š</strong>' + product.description + '</p>';
                }
                
                if (product.contact && product.phone) {
                    html += '<p><strong>è”ç³»äººï¼š</strong>' + product.contact + ' (' + formatProductPhone(product, i) + ')</p>';
                }
                
                if (product.wechat) {
                    html += '<p><strong>å¾®ä¿¡ï¼š</strong>' + product.wechat + '</p>';
                }
                
                if (product.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + product.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            productsContainer.innerHTML = html;
        }
        
        // æ˜¾ç¤ºå•†æœºåˆ—è¡¨
        function displayBusinesses() {
            var businessesContainer = document.getElementById('businesses-container');
            
            if (businesses.length === 0) {
                businessesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸ’¼</p><p>æš‚æ— å•†æœºä¿¡æ¯</p></div>';
                return;
            }
            
            var html = '<h3 style="color: #007bff; margin-bottom: 15px;">ğŸ’¼ æ‰€æœ‰å•†æœºä¿¡æ¯ï¼ˆå…± ' + businesses.length + ' æ¡ï¼‰</h3>';
            for (var i = 0; i < businesses.length; i++) {
                var business = businesses[i];
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: #007bff; margin: 0;">' + business.title + '</h3>';
                html += '</div>';
                
                if (business.type) {
                    html += '<p><strong>ç±»å‹ï¼š</strong>' + business.type + '</p>';
                }
                
                if (business.investment) {
                    html += '<p><strong>æŠ•èµ„é‡‘é¢ï¼š</strong>' + business.investment + '</p>';
                }
                
                if (business.location) {
                    html += '<p><strong>åœ°åŒºï¼š</strong>' + business.location + '</p>';
                }
                
                if (business.expiry) {
                    html += '<p><strong>æœ‰æ•ˆæœŸï¼š</strong>' + business.expiry + '</p>';
                }
                
                if (business.urgency) {
                    html += '<p><strong>ç´§æ€¥ç¨‹åº¦ï¼š</strong>' + business.urgency + '</p>';
                }
                
                if (business.description) {
                    html += '<p><strong>è¯´æ˜ï¼š</strong>' + business.description + '</p>';
                }
                
                if (business.contact && business.phone) {
                    html += '<p><strong>è”ç³»äººï¼š</strong>' + business.contact + ' (' + formatBusinessPhone(business, i) + ')</p>';
                }
                
                if (business.email) {
                    html += '<p><strong>é‚®ç®±åœ°å€ï¼š</strong>' + business.email + '</p>';
                }
                
                if (business.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + business.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            businessesContainer.innerHTML = html;
        }
        
        // æ˜¾ç¤ºè¡Œç¨‹åˆ—è¡¨
        function displayRides() {
            var ridesContainer = document.getElementById('rides-container');
            
            // åˆå¹¶æ‰€æœ‰è¡Œç¨‹æ•°æ®
            var allRides = [];
            if (rides.length > 0) {
                allRides = allRides.concat(rides);
            }
            if (passengers.length > 0) {
                allRides = allRides.concat(passengers);
            }
            
            if (allRides.length === 0) {
                ridesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸš—</p><p>æš‚æ— å¯ç”¨è¡Œç¨‹ï¼Œè¯·ç¨åå†è¯•æˆ–å‘å¸ƒæ‚¨çš„è¡Œç¨‹</p></div>';
                return;
            }
            
            // æ˜¾ç¤ºæ‰€æœ‰è¡Œç¨‹
            var html = '<h3 style="color: #ff5100; margin-bottom: 15px;">ğŸš— æ‰€æœ‰å¯ç”¨è¡Œç¨‹ï¼ˆå…± ' + allRides.length + ' æ¡ï¼‰</h3>';
            for (var i = 0; i < allRides.length; i++) {
                var ride = allRides[i];
                var typeIcon = ride.type === 'car-find-passenger' ? 'ğŸš—' : 'ğŸš¶';
                var typeName = ride.type === 'car-find-passenger' ? 'è½¦æ‰¾äºº' : 'äººæ‰¾è½¦';
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: #ff5100; margin: 0;">' + typeIcon + ' ' + typeName + '</h3>';
                html += '</div>';
                
                if (ride.departure && ride.destination) {
                    html += '<p><strong>è·¯çº¿ï¼š</strong>' + ride.departure + ' â†’ ' + ride.destination + '</p>';
                }
                
                if (ride.date && ride.time) {
                    html += '<p><strong>æ—¶é—´ï¼š</strong>' + ride.date + ' ' + ride.time + '</p>';
                }
                
                if (ride.seats) {
                    html += '<p><strong>åº§ä½ï¼š</strong>' + ride.seats + 'ä¸ª</p>';
                }
                
                if (ride.count) {
                    html += '<p><strong>äººæ•°ï¼š</strong>' + ride.count + 'äºº</p>';
                }
                
                if (ride.price) {
                    html += '<p><strong>è´¹ç”¨ï¼š</strong>' + ride.price + 'å…ƒ</p>';
                }
                
                if (ride.budget) {
                    html += '<p><strong>é¢„ç®—ï¼š</strong>' + ride.budget + 'å…ƒ</p>';
                }
                
                if (ride.name && ride.phone) {
                    // åœ¨"æˆ‘çš„è¡Œç¨‹"ä¸­æ˜¾ç¤ºå®Œæ•´å·ç ï¼Œå› ä¸ºæ˜¯è‡ªå·±å‘å¸ƒçš„
                    var isOwnRide = currentUser && ride.publisher === currentUser.username;
                    if (isOwnRide) {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + ride.name + ' (' + ride.phone + ')</p>';
                    } else {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + ride.name + ' (' + formatPhone(ride, i, 'my') + ')</p>';
                    }
                }
                
                if (ride.notes) {
                    html += '<p><strong>å¤‡æ³¨ï¼š</strong>' + ride.notes + '</p>';
                }
                
                if (ride.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + ride.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            ridesContainer.innerHTML = html;
        }
        
        // æ˜¾ç¤ºæˆ‘çš„è¡Œç¨‹
        function displayMyRides() {
            var myRidesContainer = document.getElementById('my-rides-container');
            
            if (!currentUser) {
                myRidesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸ”’</p><p>è¯·å…ˆç™»å½•æŸ¥çœ‹æ‚¨çš„å‘å¸ƒä¿¡æ¯</p></div>';
                return;
            }
            
            // è·å–å½“å‰ç”¨æˆ·å‘å¸ƒçš„æ‰€æœ‰ä¿¡æ¯
            var myRides = rides.filter(ride => ride.publisher === currentUser.username);
            var myPassengers = passengers.filter(passenger => passenger.publisher === currentUser.username);
            var myProducts = products.filter(product => product.publisher === currentUser.username);
            var myBusinesses = businesses.filter(business => business.publisher === currentUser.username);
            
            // åˆå¹¶æ‰€æœ‰ä¿¡æ¯
            var allMyInfo = [];
            allMyInfo = allMyInfo.concat(myRides.map(r => ({...r, type: 'è½¦æ‰¾äºº', icon: 'ğŸš—', color: '#ff5100'})));
            allMyInfo = allMyInfo.concat(myPassengers.map(p => ({...p, type: 'äººæ‰¾è½¦', icon: 'ğŸš¶', color: '#ff5100'})));
            allMyInfo = allMyInfo.concat(myProducts.map(p => ({...p, type: 'å†œå‰¯äº§å“', icon: 'ğŸŒ¾', color: '#28a745'})));
            allMyInfo = allMyInfo.concat(myBusinesses.map(b => ({...b, type: 'å•†æœºä¿¡æ¯', icon: 'ğŸ’¼', color: '#007bff'})));
            
            if (allMyInfo.length === 0) {
                myRidesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸ“</p><p>æ‚¨è¿˜æ²¡æœ‰å‘å¸ƒè¿‡ä»»ä½•ä¿¡æ¯</p></div>';
                return;
            }
            
            var html = '<h3 style="color: #ff5100; margin-bottom: 20px;">ğŸ“‹ æˆ‘çš„å‘å¸ƒä¿¡æ¯ï¼ˆå…± ' + allMyInfo.length + ' æ¡ï¼‰</h3>';
            
            for (var i = 0; i < allMyInfo.length; i++) {
                var info = allMyInfo[i];
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: ' + info.color + '; margin: 0;">' + info.icon + ' ' + info.type;
                
                if (info.departure && info.destination) {
                    html += ' - ' + info.departure + ' â†’ ' + info.destination;
                } else if (info.name) {
                    html += ' - ' + info.name;
                } else if (info.title) {
                    html += ' - ' + info.title;
                }
                
                html += '</h3>';
                html += '<button onclick="deleteMyInfo(\'' + info.type + '\', \'' + info.id + '\')" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 0.8rem;">åˆ é™¤</button>';
                html += '</div>';
                
                // æ ¹æ®ç±»å‹æ˜¾ç¤ºä¸åŒçš„ä¿¡æ¯
                if (info.type === 'è½¦æ‰¾äºº' || info.type === 'äººæ‰¾è½¦') {
                    if (info.date && info.time) {
                        html += '<p><strong>æ—¶é—´ï¼š</strong>' + info.date + ' ' + info.time + '</p>';
                    }
                    if (info.seats) {
                        html += '<p><strong>åº§ä½ï¼š</strong>' + info.seats + 'ä¸ª</p>';
                    }
                    if (info.count) {
                        html += '<p><strong>äººæ•°ï¼š</strong>' + info.count + 'äºº</p>';
                    }
                    if (info.price) {
                        html += '<p><strong>è´¹ç”¨ï¼š</strong>' + info.price + 'å…ƒ</p>';
                    }
                    if (info.budget) {
                        html += '<p><strong>é¢„ç®—ï¼š</strong>' + info.budget + 'å…ƒ</p>';
                    }
                    if (info.notes) {
                        html += '<p><strong>å¤‡æ³¨ï¼š</strong>' + info.notes + '</p>';
                    }
                } else if (info.type === 'å†œå‰¯äº§å“') {
                    if (info.category) {
                        html += '<p><strong>ç±»åˆ«ï¼š</strong>' + info.category + '</p>';
                    }
                    if (info.quantity) {
                        html += '<p><strong>æ•°é‡ï¼š</strong>' + info.quantity + '</p>';
                    }
                    if (info.price) {
                        html += '<p><strong>ä»·æ ¼ï¼š</strong>' + info.price + '</p>';
                    }
                    if (info.location) {
                        html += '<p><strong>äº§åœ°ï¼š</strong>' + info.location + '</p>';
                    }
                    if (info.harvest) {
                        html += '<p><strong>é‡‡æ”¶æ—¶é—´ï¼š</strong>' + info.harvest + '</p>';
                    }
                    if (info.quality) {
                        html += '<p><strong>å“è´¨ç­‰çº§ï¼š</strong>' + info.quality + '</p>';
                    }
                    if (info.description) {
                        html += '<p><strong>æè¿°ï¼š</strong>' + info.description + '</p>';
                    }
                } else if (info.type === 'å•†æœºä¿¡æ¯') {
                    if (info.businessType) {
                        html += '<p><strong>ç±»å‹ï¼š</strong>' + info.businessType + '</p>';
                    }
                    if (info.investment) {
                        html += '<p><strong>æŠ•èµ„é‡‘é¢ï¼š</strong>' + info.investment + '</p>';
                    }
                    if (info.location) {
                        html += '<p><strong>åœ°åŒºï¼š</strong>' + info.location + '</p>';
                    }
                    if (info.expiry) {
                        html += '<p><strong>æœ‰æ•ˆæœŸï¼š</strong>' + info.expiry + '</p>';
                    }
                    if (info.urgency) {
                        html += '<p><strong>ç´§æ€¥ç¨‹åº¦ï¼š</strong>' + info.urgency + '</p>';
                    }
                    if (info.description) {
                        html += '<p><strong>è¯´æ˜ï¼š</strong>' + info.description + '</p>';
                    }
                }
                
                if (info.contact && info.phone) {
                    html += '<p><strong>è”ç³»äººï¼š</strong>' + info.contact + ' (' + info.phone + ')</p>';
                }
                
                if (info.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + info.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            myRidesContainer.innerHTML = html;
        }
        
        // åˆ é™¤æˆ‘çš„ä¿¡æ¯
        function deleteMyInfo(type, id) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡ä¿¡æ¯å—ï¼Ÿ')) {
                return;
            }
            
            // æ ¹æ®ç±»å‹åˆ é™¤å¯¹åº”çš„æ•°æ®
            if (type === 'è½¦æ‰¾äºº') {
                rides = rides.filter(ride => ride.id !== id);
                localStorage.setItem('rides', JSON.stringify(rides));
            } else if (type === 'äººæ‰¾è½¦') {
                passengers = passengers.filter(passenger => passenger.id !== id);
                localStorage.setItem('passengers', JSON.stringify(passengers));
            } else if (type === 'å†œå‰¯äº§å“') {
                products = products.filter(product => product.id !== id);
                localStorage.setItem('products', JSON.stringify(products));
            } else if (type === 'å•†æœºä¿¡æ¯') {
                businesses = businesses.filter(business => business.id !== id);
                localStorage.setItem('businesses', JSON.stringify(businesses));
            }
            
            // åˆ·æ–°æ˜¾ç¤º
            displayMyRides();
            displayAllInfo();
            
            alert('åˆ é™¤æˆåŠŸï¼');
        }
        
        // åˆ‡æ¢å‘å¸ƒæ ‡ç­¾é¡µ
        function switchPublishTab(tabId) {
            // éšè—æ‰€æœ‰å‘å¸ƒæ ‡ç­¾å†…å®¹
            var tabContents = document.querySelectorAll('.publish-tab-content');
            for (var i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            // å–æ¶ˆæ‰€æœ‰å‘å¸ƒæ ‡ç­¾çš„æ´»åŠ¨çŠ¶æ€
            var tabs = document.querySelectorAll('#my-rides .tab');
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            // æ˜¾ç¤ºé€‰ä¸­çš„å‘å¸ƒæ ‡ç­¾å†…å®¹
            var targetContent = document.getElementById(tabId);
            if (targetContent) {
                targetContent.classList.add('active');
            }
            
            // è®¾ç½®é€‰ä¸­å‘å¸ƒæ ‡ç­¾çš„æ´»åŠ¨çŠ¶æ€
            for (var i = 0; i < tabs.length; i++) {
                var onclick = tabs[i].getAttribute('onclick');
                if (onclick && onclick.indexOf("switchPublishTab('" + tabId + "')") !== -1) {
                    tabs[i].classList.add('active');
                    break;
                }
            }
            
            // å¦‚æœæ˜¯æˆ‘çš„å‘å¸ƒåˆ—è¡¨æ ‡ç­¾ï¼Œåˆ·æ–°åˆ—è¡¨
            if (tabId === 'my-list') {
                displayMyRides();
            }
        }
        
        // æ˜¾ç¤ºäº§å“åˆ—è¡¨
        function displayProducts() {
            var productsContainer = document.getElementById('products-container');
            
            if (products.length === 0) {
                productsContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸŒ¾</p><p>æš‚æ— å†œå‰¯äº§å“ä¿¡æ¯</p></div>';
                return;
            }
            
            var html = '<h3 style="color: #28a745; margin-bottom: 15px;">ğŸŒ¾ æ‰€æœ‰å†œå‰¯äº§å“ï¼ˆå…± ' + products.length + ' æ¡ï¼‰</h3>';
            for (var i = 0; i < products.length; i++) {
                var product = products[i];
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: #28a745; margin: 0;">' + product.name + '</h3>';
                html += '</div>';
                
                if (product.category) {
                    html += '<p><strong>ç±»åˆ«ï¼š</strong>' + product.category + '</p>';
                }
                
                if (product.quantity) {
                    html += '<p><strong>æ•°é‡ï¼š</strong>' + product.quantity + '</p>';
                }
                
                if (product.price) {
                    html += '<p><strong>ä»·æ ¼ï¼š</strong>' + product.price + '</p>';
                }
                
                if (product.location) {
                    html += '<p><strong>äº§åœ°ï¼š</strong>' + product.location + '</p>';
                }
                
                if (product.harvest) {
                    html += '<p><strong>é‡‡æ”¶æ—¶é—´ï¼š</strong>' + product.harvest + '</p>';
                }
                
                if (product.quality) {
                    html += '<p><strong>å“è´¨ç­‰çº§ï¼š</strong>' + product.quality + '</p>';
                }
                
                if (product.description) {
                    html += '<p><strong>æè¿°ï¼š</strong>' + product.description + '</p>';
                }
                
                if (product.contact && product.phone) {
                    html += '<p><strong>è”ç³»äººï¼š</strong>' + product.contact + ' (' + formatProductPhone(product, i) + ')</p>';
                }
                
                if (product.wechat) {
                    html += '<p><strong>å¾®ä¿¡ï¼š</strong>' + product.wechat + '</p>';
                }
                
                if (product.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + product.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            productsContainer.innerHTML = html;
        }
        
        // æ˜¾ç¤ºå•†æœºåˆ—è¡¨
        function displayBusinesses() {
            var businessesContainer = document.getElementById('businesses-container');
            
            if (businesses.length === 0) {
                businessesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸ’¼</p><p>æš‚æ— å•†æœºä¿¡æ¯</p></div>';
                return;
            }
            
            var html = '<h3 style="color: #007bff; margin-bottom: 15px;">ğŸ’¼ æ‰€æœ‰å•†æœºä¿¡æ¯ï¼ˆå…± ' + businesses.length + ' æ¡ï¼‰</h3>';
            for (var i = 0; i < businesses.length; i++) {
                var business = businesses[i];
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: #007bff; margin: 0;">' + business.title + '</h3>';
                html += '</div>';
                
                if (business.type) {
                    html += '<p><strong>ç±»å‹ï¼š</strong>' + business.type + '</p>';
                }
                
                if (business.investment) {
                    html += '<p><strong>æŠ•èµ„é‡‘é¢ï¼š</strong>' + business.investment + '</p>';
                }
                
                if (business.location) {
                    html += '<p><strong>åœ°åŒºï¼š</strong>' + business.location + '</p>';
                }
                
                if (business.expiry) {
                    html += '<p><strong>æœ‰æ•ˆæœŸï¼š</strong>' + business.expiry + '</p>';
                }
                
                if (business.urgency) {
                    html += '<p><strong>ç´§æ€¥ç¨‹åº¦ï¼š</strong>' + business.urgency + '</p>';
                }
                
                if (business.description) {
                    html += '<p><strong>è¯´æ˜ï¼š</strong>' + business.description + '</p>';
                }
                
                if (business.contact && business.phone) {
                    html += '<p><strong>è”ç³»äººï¼š</strong>' + business.contact + ' (' + formatBusinessPhone(business, i) + ')</p>';
                }
                
                if (business.email) {
                    html += '<p><strong>é‚®ç®±åœ°å€ï¼š</strong>' + business.email + '</p>';
                }
                
                if (business.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + business.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            businessesContainer.innerHTML = html;
        }
        
        // æ˜¾ç¤ºè¡Œç¨‹åˆ—è¡¨
        function displayRides() {
            var ridesContainer = document.getElementById('rides-container');
            
            // åˆå¹¶æ‰€æœ‰è¡Œç¨‹æ•°æ®
            var allRides = [];
            if (rides.length > 0) {
                allRides = allRides.concat(rides);
            }
            if (passengers.length > 0) {
                allRides = allRides.concat(passengers);
            }
            
            if (allRides.length === 0) {
                ridesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸš—</p><p>æš‚æ— å¯ç”¨è¡Œç¨‹ï¼Œè¯·ç¨åå†è¯•æˆ–å‘å¸ƒæ‚¨çš„è¡Œç¨‹</p></div>';
                return;
            }
            
            // æ˜¾ç¤ºæ‰€æœ‰è¡Œç¨‹
            var html = '<h3 style="color: #ff5100; margin-bottom: 15px;">ğŸš— æ‰€æœ‰å¯ç”¨è¡Œç¨‹ï¼ˆå…± ' + allRides.length + ' æ¡ï¼‰</h3>';
            for (var i = 0; i < allRides.length; i++) {
                var ride = allRides[i];
                var typeIcon = ride.type === 'car-find-passenger' ? 'ğŸš—' : 'ğŸš¶';
                var typeName = ride.type === 'car-find-passenger' ? 'è½¦æ‰¾äºº' : 'äººæ‰¾è½¦';
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: #ff5100; margin: 0;">' + typeIcon + ' ' + typeName + '</h3>';
                html += '</div>';
                
                if (ride.departure && ride.destination) {
                    html += '<p><strong>è·¯çº¿ï¼š</strong>' + ride.departure + ' â†’ ' + ride.destination + '</p>';
                }
                
                if (ride.date && ride.time) {
                    html += '<p><strong>æ—¶é—´ï¼š</strong>' + ride.date + ' ' + ride.time + '</p>';
                }
                
                if (ride.seats) {
                    html += '<p><strong>åº§ä½ï¼š</strong>' + ride.seats + 'ä¸ª</p>';
                }
                
                if (ride.count) {
                    html += '<p><strong>äººæ•°ï¼š</strong>' + ride.count + 'äºº</p>';
                }
                
                if (ride.price) {
                    html += '<p><strong>è´¹ç”¨ï¼š</strong>' + ride.price + 'å…ƒ</p>';
                }
                
                if (ride.budget) {
                    html += '<p><strong>é¢„ç®—ï¼š</strong>' + ride.budget + 'å…ƒ</p>';
                }
                
                if (ride.name && ride.phone) {
                    // åœ¨"æˆ‘çš„è¡Œç¨‹"ä¸­æ˜¾ç¤ºå®Œæ•´å·ç ï¼Œå› ä¸ºæ˜¯è‡ªå·±å‘å¸ƒçš„
                    var isOwnRide = currentUser && ride.publisher === currentUser.username;
                    if (isOwnRide) {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + ride.name + ' (' + ride.phone + ')</p>';
                    } else {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + ride.name + ' (' + formatPhone(ride, i, 'my') + ')</p>';
                    }
                }
                
                if (ride.notes) {
                    html += '<p><strong>å¤‡æ³¨ï¼š</strong>' + ride.notes + '</p>';
                }
                
                if (ride.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + ride.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            ridesContainer.innerHTML = html;
        }
        
        // æ˜¾ç¤ºæˆ‘çš„è¡Œç¨‹
        function displayMyRides() {
            var myRidesContainer = document.getElementById('my-rides-container');
            
            if (!currentUser) {
                myRidesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸ”’</p><p>è¯·å…ˆç™»å½•æŸ¥çœ‹æ‚¨çš„å‘å¸ƒä¿¡æ¯</p></div>';
                return;
            }
            
            // è·å–å½“å‰ç”¨æˆ·å‘å¸ƒçš„æ‰€æœ‰ä¿¡æ¯
            var myRides = rides.filter(ride => ride.publisher === currentUser.username);
            var myPassengers = passengers.filter(passenger => passenger.publisher === currentUser.username);
            var myProducts = products.filter(product => product.publisher === currentUser.username);
            var myBusinesses = businesses.filter(business => business.publisher === currentUser.username);
            
            // åˆå¹¶æ‰€æœ‰ä¿¡æ¯
            var allMyInfo = [];
            allMyInfo = allMyInfo.concat(myRides.map(r => ({...r, type: 'è½¦æ‰¾äºº', icon: 'ğŸš—', color: '#ff5100'})));
            allMyInfo = allMyInfo.concat(myPassengers.map(p => ({...p, type: 'äººæ‰¾è½¦', icon: 'ğŸš¶', color: '#ff5100'})));
            allMyInfo = allMyInfo.concat(myProducts.map(p => ({...p, type: 'å†œå‰¯äº§å“', icon: 'ğŸŒ¾', color: '#28a745'})));
            allMyInfo = allMyInfo.concat(myBusinesses.map(b => ({...b, type: 'å•†æœºä¿¡æ¯', icon: 'ğŸ’¼', color: '#007bff'})));
            
            if (allMyInfo.length === 0) {
                myRidesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸ“</p><p>æ‚¨è¿˜æ²¡æœ‰å‘å¸ƒè¿‡ä»»ä½•ä¿¡æ¯</p></div>';
                return;
            }
            
            var html = '<h3 style="color: #ff5100; margin-bottom: 20px;">ğŸ“‹ æˆ‘çš„å‘å¸ƒä¿¡æ¯ï¼ˆå…± ' + allMyInfo.length + ' æ¡ï¼‰</h3>';
            
            for (var i = 0; i < allMyInfo.length; i++) {
                var info = allMyInfo[i];
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: ' + info.color + '; margin: 0;">' + info.icon + ' ' + info.type;
                
                if (info.departure && info.destination) {
                    html += ' - ' + info.departure + ' â†’ ' + info.destination;
                } else if (info.name) {
                    html += ' - ' + info.name;
                } else if (info.title) {
                    html += ' - ' + info.title;
                }
                
                html += '</h3>';
                html += '<button onclick="deleteMyInfo(\'' + info.type + '\', \'' + info.id + '\')" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 0.8rem;">åˆ é™¤</button>';
                html += '</div>';
                
                // æ ¹æ®ç±»å‹æ˜¾ç¤ºä¸åŒçš„ä¿¡æ¯
                if (info.type === 'è½¦æ‰¾äºº' || info.type === 'äººæ‰¾è½¦') {
                    if (info.date && info.time) {
                        html += '<p><strong>æ—¶é—´ï¼š</strong>' + info.date + ' ' + info.time + '</p>';
                    }
                    if (info.seats) {
                        html += '<p><strong>åº§ä½ï¼š</strong>' + info.seats + 'ä¸ª</p>';
                    }
                    if (info.count) {
                        html += '<p><strong>äººæ•°ï¼š</strong>' + info.count + 'äºº</p>';
                    }
                    if (info.price) {
                        html += '<p><strong>è´¹ç”¨ï¼š</strong>' + info.price + 'å…ƒ</p>';
                    }
                    if (info.budget) {
                        html += '<p><strong>é¢„ç®—ï¼š</strong>' + info.budget + 'å…ƒ</p>';
                    }
                    if (info.notes) {
                        html += '<p><strong>å¤‡æ³¨ï¼š</strong>' + info.notes + '</p>';
                    }
                } else if (info.type === 'å†œå‰¯äº§å“') {
                    if (info.category) {
                        html += '<p><strong>ç±»åˆ«ï¼š</strong>' + info.category + '</p>';
                    }
                    if (info.quantity) {
                        html += '<p><strong>æ•°é‡ï¼š</strong>' + info.quantity + '</p>';
                    }
                    if (info.price) {
                        html += '<p><strong>ä»·æ ¼ï¼š</strong>' + info.price + '</p>';
                    }
                    if (info.location) {
                        html += '<p><strong>äº§åœ°ï¼š</strong>' + info.location + '</p>';
                    }
                    if (info.harvest) {
                        html += '<p><strong>é‡‡æ”¶æ—¶é—´ï¼š</strong>' + info.harvest + '</p>';
                    }
                    if (info.quality) {
                        html += '<p><strong>å“è´¨ç­‰çº§ï¼š</strong>' + info.quality + '</p>';
                    }
                    if (info.description) {
                        html += '<p><strong>æè¿°ï¼š</strong>' + info.description + '</p>';
                    }
                } else if (info.type === 'å•†æœºä¿¡æ¯') {
                    if (info.businessType) {
                        html += '<p><strong>ç±»å‹ï¼š</strong>' + info.businessType + '</p>';
                    }
                    if (info.investment) {
                        html += '<p><strong>æŠ•èµ„é‡‘é¢ï¼š</strong>' + info.investment + '</p>';
                    }
                    if (info.location) {
                        html += '<p><strong>åœ°åŒºï¼š</strong>' + info.location + '</p>';
                    }
                    if (info.expiry) {
                        html += '<p><strong>æœ‰æ•ˆæœŸï¼š</strong>' + info.expiry + '</p>';
                    }
                    if (info.urgency) {
                        html += '<p><strong>ç´§æ€¥ç¨‹åº¦ï¼š</strong>' + info.urgency + '</p>';
                    }
                    if (info.description) {
                        html += '<p><strong>è¯´æ˜ï¼š</strong>' + info.description + '</p>';
                    }
                }
                
                if (info.contact && info.phone) {
                    html += '<p><strong>è”ç³»äººï¼š</strong>' + info.contact + ' (' + info.phone + ')</p>';
                }
                
                if (info.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + info.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            myRidesContainer.innerHTML = html;
        }
        
        // åˆ é™¤æˆ‘çš„ä¿¡æ¯
        function deleteMyInfo(type, id) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡ä¿¡æ¯å—ï¼Ÿ')) {
                return;
            }
            
            // æ ¹æ®ç±»å‹åˆ é™¤å¯¹åº”çš„æ•°æ®
            if (type === 'è½¦æ‰¾äºº') {
                rides = rides.filter(ride => ride.id !== id);
                localStorage.setItem('rides', JSON.stringify(rides));
            } else if (type === 'äººæ‰¾è½¦') {
                passengers = passengers.filter(passenger => passenger.id !== id);
                localStorage.setItem('passengers', JSON.stringify(passengers));
            } else if (type === 'å†œå‰¯äº§å“') {
                products = products.filter(product => product.id !== id);
                localStorage.setItem('products', JSON.stringify(products));
            } else if (type === 'å•†æœºä¿¡æ¯') {
                businesses = businesses.filter(business => business.id !== id);
                localStorage.setItem('businesses', JSON.stringify(businesses));
            }
            
            // åˆ·æ–°æ˜¾ç¤º
            displayMyRides();
            displayAllInfo();
            
            alert('åˆ é™¤æˆåŠŸï¼');
        }
        
        // å‘å¸ƒè½¦æ‰¾äººä¿¡æ¯
        async function publishRide(event) {
            event.preventDefault();
            
            // æ£€æŸ¥ç”¨æˆ·æƒé™
            if (!currentUser) {
                alert('ğŸ”’ è¯·å…ˆç™»å½•åå†å‘å¸ƒè¡Œç¨‹ä¿¡æ¯ï¼');
                showAuthModal();
                return;
            }
            
            // è·å–è¡¨å•æ•°æ®
            var rideData = {
                type: 'car-find-passenger',
                departure: document.getElementById('departure').value,
                destination: document.getElementById('destination').value,
                date: document.getElementById('date').value,
                time: document.getElementById('time').value,
                seats: document.getElementById('seats').value,
                price: document.getElementById('price').value,
                notes: document.getElementById('notes').value,
                name: document.getElementById('name').value,
                phone: document.getElementById('phone').value,
                publishTime: new Date().toLocaleString(),
                publisher: currentUser.username,
                userId: currentUser.id || currentUser.username
            };
            
            try {
                // ä½¿ç”¨Firebaseæ•°æ®åº“ä¿å­˜
                await databaseService.saveData('rides', rideData);
                alert('ğŸš— è½¦æ‰¾äººä¿¡æ¯å‘å¸ƒæˆåŠŸï¼');
                
                // æ¸…ç©ºè¡¨å•
                event.target.reset();
                
                // åˆ·æ–°æ˜¾ç¤º
                await displayMyRides();
                await displayAllInfo();
            } catch (error) {
                console.error('å‘å¸ƒå¤±è´¥:', error);
                alert('å‘å¸ƒå¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
            }
        }
        
        // å‘å¸ƒäººæ‰¾è½¦ä¿¡æ¯
        async function publishPassenger(event) {
            event.preventDefault();
            
            // æ£€æŸ¥ç”¨æˆ·æƒé™
            if (!currentUser) {
                alert('ğŸ”’ è¯·å…ˆç™»å½•åå†å‘å¸ƒè¡Œç¨‹ä¿¡æ¯ï¼');
                showAuthModal();
                return;
            }
            
            // è·å–è¡¨å•æ•°æ®
            var passengerData = {
                type: 'passenger-find-car',
                departure: document.getElementById('passenger-departure').value,
                destination: document.getElementById('passenger-destination').value,
                date: document.getElementById('passenger-date').value,
                time: document.getElementById('passenger-time').value,
                count: document.getElementById('passenger-count').value,
                budget: document.getElementById('passenger-budget').value,
                notes: document.getElementById('passenger-notes').value,
                name: document.getElementById('passenger-name').value,
                phone: document.getElementById('passenger-phone').value,
                publishTime: new Date().toLocaleString(),
                publisher: currentUser.username,
                userId: currentUser.id || currentUser.username
            };
            
            try {
                // ä½¿ç”¨databaseServiceä¿å­˜åˆ°ridesé›†åˆï¼ˆåˆå¹¶è½¦æ‰¾äººå’Œäººæ‰¾è½¦ï¼‰
                await databaseService.saveData('rides', passengerData);
                alert('ğŸš¶ äººæ‰¾è½¦ä¿¡æ¯å‘å¸ƒæˆåŠŸï¼');
                
                // æ¸…ç©ºè¡¨å•
                event.target.reset();
                
                // åˆ·æ–°æ˜¾ç¤º
                await displayMyRides();
                await displayAllInfo();
            } catch (error) {
                console.error('å‘å¸ƒå¤±è´¥:', error);
                alert('å‘å¸ƒå¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
            }
        }
        
        // å‘å¸ƒå†œå‰¯äº§å“
        async function publishProduct(event) {
            event.preventDefault();
            
            // æ£€æŸ¥ç”¨æˆ·æƒé™
            if (!currentUser) {
                alert('ğŸ”’ è¯·å…ˆç™»å½•åå†å‘å¸ƒäº§å“ä¿¡æ¯ï¼');
                showAuthModal();
                return;
            }
            
            // è·å–è¡¨å•æ•°æ®
            var productData = {
                name: document.getElementById('product-name').value,
                category: document.getElementById('product-category').value,
                quantity: document.getElementById('product-quantity').value,
                price: document.getElementById('product-price').value,
                location: document.getElementById('product-location').value,
                harvest: document.getElementById('product-harvest').value,
                quality: document.getElementById('product-quality').value,
                description: document.getElementById('product-description').value,
                contact: document.getElementById('product-contact').value,
                phone: document.getElementById('product-phone').value,
                wechat: document.getElementById('product-wechat').value,
                publishTime: new Date().toLocaleString(),
                publisher: currentUser.username,
                userId: currentUser.id || currentUser.username
            };
            
            try {
                // ä½¿ç”¨Firebaseæ•°æ®åº“ä¿å­˜
                await databaseService.saveData('products', productData);
                alert('ğŸŒ¾ å†œå‰¯äº§å“å‘å¸ƒæˆåŠŸï¼');
                
                // æ¸…ç©ºè¡¨å•
                event.target.reset();
                
                // åˆ·æ–°æ˜¾ç¤º
                await displayAllInfo();
            } catch (error) {
                console.error('å‘å¸ƒå¤±è´¥:', error);
                alert('å‘å¸ƒå¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
            }
        }
        
        // å‘å¸ƒå•†æœºä¿¡æ¯
        async function publishBusiness(event) {
            event.preventDefault();
            
            // æ£€æŸ¥ç”¨æˆ·æƒé™
            if (!currentUser) {
                alert('ğŸ”’ è¯·å…ˆç™»å½•åå†å‘å¸ƒå•†æœºä¿¡æ¯ï¼');
                showAuthModal();
                return;
            }
            
            // è·å–è¡¨å•æ•°æ®
            var businessData = {
                title: document.getElementById('business-title').value,
                type: document.getElementById('business-type').value,
                investment: document.getElementById('business-investment').value,
                location: document.getElementById('business-location').value,
                expiry: document.getElementById('business-expiry').value,
                urgency: document.getElementById('business-urgency').value,
                description: document.getElementById('business-description').value,
                contact: document.getElementById('business-contact').value,
                phone: document.getElementById('business-phone').value,
                email: document.getElementById('business-email').value,
                publishTime: new Date().toLocaleString(),
                publisher: currentUser.username,
                userId: currentUser.id || currentUser.username
            };
            
            try {
                // ä½¿ç”¨databaseServiceä¿å­˜
                await databaseService.saveData('businesses', businessData);
                alert('ğŸ’¼ å•†æœºä¿¡æ¯å‘å¸ƒæˆåŠŸï¼');
                
                // æ¸…ç©ºè¡¨å•
                event.target.reset();
                
                // åˆ·æ–°æ˜¾ç¤º
                await displayMyRides();
                await displayAllInfo();
            } catch (error) {
                console.error('å‘å¸ƒå¤±è´¥:', error);
                alert('å‘å¸ƒå¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
            }
        }
        
        // æœç´¢è¡Œç¨‹
        function searchRides() {
            var searchTerm = document.getElementById('search-input').value.toLowerCase();
            var ridesContainer = document.getElementById('rides-container');
            
            if (!searchTerm) {
                displayRides();
                return;
            }
            
            // åˆå¹¶æ‰€æœ‰è¡Œç¨‹æ•°æ®
            var allRides = [];
            if (rides.length > 0) {
                allRides = allRides.concat(rides);
            }
            if (passengers.length > 0) {
                allRides = allRides.concat(passengers);
            }
            
            // æœç´¢åŒ¹é…çš„è¡Œç¨‹
            var searchResults = [];
            for (var i = 0; i < allRides.length; i++) {
                var ride = allRides[i];
                var searchIn = [
                    ride.departure || '',
                    ride.destination || '',
                    ride.name || '',
                    ride.phone || '',
                    ride.notes || ''
                ].join(' ').toLowerCase();
                
                if (searchIn.indexOf(searchTerm) !== -1) {
                    searchResults.push(ride);
                }
            }
            
            // æ˜¾ç¤ºæœç´¢ç»“æœ
            if (searchResults.length === 0) {
                ridesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸ”</p><p>æœªæ‰¾åˆ°åŒ¹é…çš„è¡Œç¨‹ï¼Œè¯·å°è¯•å…¶ä»–å…³é”®è¯</p></div>';
                return;
            }
            
            // ç”Ÿæˆæœç´¢ç»“æœHTML
            var html = '<h3 style="color: #ff5100; margin-bottom: 15px;">ğŸ” æœç´¢ç»“æœï¼šæ‰¾åˆ° ' + searchResults.length + ' ä¸ªåŒ¹é…è¡Œç¨‹</h3>';
            for (var i = 0; i < searchResults.length; i++) {
                var ride = searchResults[i];
                var typeIcon = ride.type === 'car-find-passenger' ? 'ğŸš—' : 'ğŸš¶';
                var typeName = ride.type === 'car-find-passenger' ? 'è½¦æ‰¾äºº' : 'äººæ‰¾è½¦';
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: #ff5100; margin: 0;">' + typeIcon + ' ' + typeName + '</h3>';
                html += '</div>';
                
                if (ride.departure && ride.destination) {
                    html += '<p><strong>è·¯çº¿ï¼š</strong>' + ride.departure + ' â†’ ' + ride.destination + '</p>';
                }
                
                if (ride.date && ride.time) {
                    html += '<p><strong>æ—¶é—´ï¼š</strong>' + ride.date + ' ' + ride.time + '</p>';
                }
                
                if (ride.seats) {
                    html += '<p><strong>åº§ä½ï¼š</strong>' + ride.seats + 'ä¸ª</p>';
                }
                
                if (ride.count) {
                    html += '<p><strong>äººæ•°ï¼š</strong>' + ride.count + 'äºº</p>';
                }
                
                if (ride.price) {
                    html += '<p><strong>è´¹ç”¨ï¼š</strong>' + ride.price + 'å…ƒ</p>';
                }
                
                if (ride.budget) {
                    html += '<p><strong>é¢„ç®—ï¼š</strong>' + ride.budget + 'å…ƒ</p>';
                }
                
                if (ride.name && ride.phone) {
                    // åœ¨"æˆ‘çš„è¡Œç¨‹"ä¸­æ˜¾ç¤ºå®Œæ•´å·ç ï¼Œå› ä¸ºæ˜¯è‡ªå·±å‘å¸ƒçš„
                    var isOwnRide = currentUser && ride.publisher === currentUser.username;
                    if (isOwnRide) {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + ride.name + ' (' + ride.phone + ')</p>';
                    } else {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + ride.name + ' (' + formatPhone(ride, i, 'my') + ')</p>';
                    }
                }
                
                if (ride.notes) {
                    html += '<p><strong>å¤‡æ³¨ï¼š</strong>' + ride.notes + '</p>';
                }
                
                if (ride.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + ride.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            ridesContainer.innerHTML = html;
        }
        
        // æ˜¾ç¤ºé¦–é¡µæ‰€æœ‰ä¿¡æ¯
        function displayAllInfo() {
            displayRides();
            displayProducts();
            displayBusinesses();
        }
        
        // æ˜¾ç¤ºå†œå‰¯äº§å“ä¿¡æ¯
        function displayProducts() {
            var productsContainer = document.getElementById('products-container');
            
            if (products.length === 0) {
                productsContainer.innerHTML = '<div class="no-rides"><p style="font-size: 2rem; margin-bottom: 10px;">ğŸŒ¾</p><p>æš‚æ— å†œå‰¯äº§å“ä¿¡æ¯</p></div>';
                return;
            }
            
            var html = '';
            for (var i = 0; i < products.length; i++) {
                var product = products[i];
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: #28a745; margin: 0;">ğŸŒ¾ ' + product.name + '</h3>';
                html += '<span style="background: #28a745; color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.8rem;">' + getCategoryName(product.category) + '</span>';
                html += '</div>';
                
                html += '<p><strong>ä¾›åº”æ•°é‡ï¼š</strong>' + product.quantity + '</p>';
                html += '<p><strong>é¢„æœŸä»·æ ¼ï¼š</strong>' + product.price + '</p>';
                html += '<p><strong>äº§å“äº§åœ°ï¼š</strong>' + product.location + '</p>';
                
                if (product.harvest) {
                    html += '<p><strong>é‡‡æ”¶æ—¶é—´ï¼š</strong>' + product.harvest + '</p>';
                }
                
                if (product.quality) {
                    html += '<p><strong>å“è´¨ç­‰çº§ï¼š</strong>' + getQualityName(product.quality) + '</p>';
                }
                
                if (product.description) {
                    html += '<p><strong>äº§å“æè¿°ï¼š</strong>' + product.description + '</p>';
                }
                
                if (product.contact && product.phone) {
                    html += '<p><strong>è”ç³»äººï¼š</strong>' + product.contact + ' (' + formatProductPhone(product, i) + ')</p>';
                }
                
                if (product.wechat) {
                    html += '<p><strong>å¾®ä¿¡å·ï¼š</strong>' + product.wechat + '</p>';
                }
                
                if (product.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + product.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            productsContainer.innerHTML = html;
        }
        
        // æ˜¾ç¤ºå•†æœºä¿¡æ¯
        function displayBusinesses() {
            var businessesContainer = document.getElementById('businesses-container');
            
            if (businesses.length === 0) {
                businessesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 2rem; margin-bottom: 10px;">ğŸ’¼</p><p>æš‚æ— å•†æœºä¿¡æ¯</p></div>';
                return;
            }
            
            var html = '';
            for (var i = 0; i < businesses.length; i++) {
                var business = businesses[i];
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: #007bff; margin: 0;">ğŸ’¼ ' + business.title + '</h3>';
                html += '<span style="background: #007bff; color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.8rem;">' + getBusinessTypeName(business.type) + '</span>';
                html += '</div>';
                
                html += '<p><strong>æŠ•èµ„é‡‘é¢ï¼š</strong>' + getInvestmentName(business.investment) + '</p>';
                html += '<p><strong>æ‰€åœ¨åœ°åŒºï¼š</strong>' + business.location + '</p>';
                
                if (business.expiry) {
                    html += '<p><strong>æœ‰æ•ˆæœŸé™ï¼š</strong>' + business.expiry + '</p>';
                }
                
                if (business.urgency) {
                    html += '<p><strong>ç´§æ€¥ç¨‹åº¦ï¼š</strong>' + getUrgencyName(business.urgency) + '</p>';
                }
                
                if (business.description) {
                    html += '<p><strong>è¯¦ç»†è¯´æ˜ï¼š</strong>' + business.description + '</p>';
                }
                
                if (business.contact && business.phone) {
                    html += '<p><strong>è”ç³»äººï¼š</strong>' + business.contact + ' (' + formatBusinessPhone(business, i) + ')</p>';
                }
                
                if (business.email) {
                    html += '<p><strong>é‚®ç®±åœ°å€ï¼š</strong>' + business.email + '</p>';
                }
                
                if (business.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + business.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            businessesContainer.innerHTML = html;
        }
        
        // æ˜¾ç¤ºè¡Œç¨‹åˆ—è¡¨
        function displayRides() {
            var ridesContainer = document.getElementById('rides-container');
            
            // åˆå¹¶æ‰€æœ‰è¡Œç¨‹æ•°æ®
            var allRides = [];
            if (rides.length > 0) {
                allRides = allRides.concat(rides);
            }
            if (passengers.length > 0) {
                allRides = allRides.concat(passengers);
            }
            
            if (allRides.length === 0) {
                ridesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸš—</p><p>æš‚æ— å¯ç”¨è¡Œç¨‹ï¼Œè¯·ç¨åå†è¯•æˆ–å‘å¸ƒæ‚¨çš„è¡Œç¨‹</p></div>';
                return;
            }
            
            // æ˜¾ç¤ºæ‰€æœ‰è¡Œç¨‹
            var html = '<h3 style="color: #ff5100; margin-bottom: 15px;">ğŸš— æ‰€æœ‰å¯ç”¨è¡Œç¨‹ï¼ˆå…± ' + allRides.length + ' æ¡ï¼‰</h3>';
            for (var i = 0; i < allRides.length; i++) {
                var ride = allRides[i];
                var typeIcon = ride.type === 'car-find-passenger' ? 'ğŸš—' : 'ğŸš¶';
                var typeName = ride.type === 'car-find-passenger' ? 'è½¦æ‰¾äºº' : 'äººæ‰¾è½¦';
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: #ff5100; margin: 0;">' + typeIcon + ' ' + typeName + '</h3>';
                html += '</div>';
                
                if (ride.departure && ride.destination) {
                    html += '<p><strong>è·¯çº¿ï¼š</strong>' + ride.departure + ' â†’ ' + ride.destination + '</p>';
                }
                
                if (ride.date && ride.time) {
                    html += '<p><strong>æ—¶é—´ï¼š</strong>' + ride.date + ' ' + ride.time + '</p>';
                }
                
                if (ride.seats) {
                    html += '<p><strong>åº§ä½ï¼š</strong>' + ride.seats + 'ä¸ª</p>';
                }
                
                if (ride.count) {
                    html += '<p><strong>äººæ•°ï¼š</strong>' + ride.count + 'äºº</p>';
                }
                
                if (ride.price) {
                    html += '<p><strong>è´¹ç”¨ï¼š</strong>' + ride.price + 'å…ƒ</p>';
                }
                
                if (ride.budget) {
                    html += '<p><strong>é¢„ç®—ï¼š</strong>' + ride.budget + 'å…ƒ</p>';
                }
                
                if (ride.name && ride.phone) {
                    // åœ¨"æˆ‘çš„è¡Œç¨‹"ä¸­æ˜¾ç¤ºå®Œæ•´å·ç ï¼Œå› ä¸ºæ˜¯è‡ªå·±å‘å¸ƒçš„
                    var isOwnRide = currentUser && ride.publisher === currentUser.username;
                    if (isOwnRide) {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + ride.name + ' (' + ride.phone + ')</p>';
                    } else {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + ride.name + ' (' + formatPhone(ride, i, 'my') + ')</p>';
                    }
                }
                
                if (ride.notes) {
                    html += '<p><strong>å¤‡æ³¨ï¼š</strong>' + ride.notes + '</p>';
                }
                
                if (ride.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + ride.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            ridesContainer.innerHTML = html;
        }
        
        // æ˜¾ç¤ºæˆ‘çš„è¡Œç¨‹
        function displayMyRides() {
            var myRidesContainer = document.getElementById('my-rides-container');
            var html = '';
            
            // æ˜¾ç¤ºé¡ºé£è½¦ä¿¡æ¯
            var allRides = [];
            if (rides.length > 0) {
                allRides = allRides.concat(rides);
            }
            if (passengers.length > 0) {
                allRides = allRides.concat(passengers);
            }
            
            if (allRides.length > 0) {
                html += '<h3 style="color: #ff5100; margin-bottom: 15px; border-bottom: 2px solid #ff5100; padding-bottom: 5px;">ğŸš— æˆ‘çš„é¡ºé£è½¦ä¿¡æ¯</h3>';
                for (var i = 0; i < allRides.length; i++) {
                    var ride = allRides[i];
                    var typeIcon = ride.type === 'car-find-passenger' ? 'ğŸš—' : 'ğŸš¶';
                    var typeName = ride.type === 'car-find-passenger' ? 'è½¦æ‰¾äºº' : 'äººæ‰¾è½¦';
                    
                    html += '<div class="ride-card">';
                    html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                    html += '<h4 style="color: #ff5100; margin: 0;">' + typeIcon + ' ' + typeName + '</h4>';
                    html += '<button onclick="deleteRide(\'' + ride.type + '\', ' + i + ')" style="background: #dc3545; color: white; padding: 5px 10px; border-radius: 5px; font-size: 0.8rem; border: none; cursor: pointer;">åˆ é™¤</button>';
                    html += '</div>';
                    
                    if (ride.departure && ride.destination) {
                        html += '<p><strong>è·¯çº¿ï¼š</strong>' + ride.departure + ' â†’ ' + ride.destination + '</p>';
                    }
                    
                    if (ride.date && ride.time) {
                        html += '<p><strong>æ—¶é—´ï¼š</strong>' + ride.date + ' ' + ride.time + '</p>';
                    }
                    
                    if (ride.price || ride.budget) {
                        html += '<p><strong>è´¹ç”¨ï¼š</strong>' + (ride.price || ride.budget) + 'å…ƒ</p>';
                    }
                    
                    if (ride.name && ride.phone) {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + ride.name + ' (' + ride.phone + ')</p>';
                    }
                    
                    if (ride.publishTime) {
                        html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + ride.publishTime + '</p>';
                    }
                    
                    html += '</div>';
                }
            }
            
            // æ˜¾ç¤ºå†œå‰¯äº§å“ä¿¡æ¯
            if (products.length > 0) {
                html += '<h3 style="color: #28a745; margin: 30px 0 15px 0; border-bottom: 2px solid #28a745; padding-bottom: 5px;">ğŸŒ¾ æˆ‘çš„å†œå‰¯äº§å“</h3>';
                for (var i = 0; i < products.length; i++) {
                    var product = products[i];
                    
                    html += '<div class="ride-card">';
                    html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                    html += '<h4 style="color: #28a745; margin: 0;">ğŸŒ¾ ' + product.name + '</h4>';
                    html += '<button onclick="deleteProduct(' + i + ')" style="background: #dc3545; color: white; padding: 5px 10px; border-radius: 5px; font-size: 0.8rem; border: none; cursor: pointer;">åˆ é™¤</button>';
                    html += '</div>';
                    
                    html += '<p><strong>ä¾›åº”æ•°é‡ï¼š</strong>' + product.quantity + '</p>';
                    html += '<p><strong>é¢„æœŸä»·æ ¼ï¼š</strong>' + product.price + '</p>';
                    html += '<p><strong>äº§å“äº§åœ°ï¼š</strong>' + product.location + '</p>';
                    
                    if (product.contact && product.phone) {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + product.contact + ' (' + product.phone + ')</p>';
                    }
                    
                    if (product.publishTime) {
                        html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + product.publishTime + '</p>';
                    }
                    
                    html += '</div>';
                }
            }
            
            // æ˜¾ç¤ºå•†æœºä¿¡æ¯
            if (businesses.length > 0) {
                html += '<h3 style="color: #007bff; margin: 30px 0 15px 0; border-bottom: 2px solid #007bff; padding-bottom: 5px;">ğŸ’¼ æˆ‘çš„å•†æœºä¿¡æ¯</h3>';
                for (var i = 0; i < businesses.length; i++) {
                    var business = businesses[i];
                    
                    html += '<div class="ride-card">';
                    html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                    html += '<h4 style="color: #007bff; margin: 0;">ğŸ’¼ ' + business.title + '</h4>';
                    html += '<button onclick="deleteBusiness(' + i + ')" style="background: #dc3545; color: white; padding: 5px 10px; border-radius: 5px; font-size: 0.8rem; border: none; cursor: pointer;">åˆ é™¤</button>';
                    html += '</div>';
                    
                    html += '<p><strong>å•†æœºç±»å‹ï¼š</strong>' + getBusinessTypeName(business.type) + '</p>';
                    html += '<p><strong>æŠ•èµ„é‡‘é¢ï¼š</strong>' + getInvestmentName(business.investment) + '</p>';
                    html += '<p><strong>æ‰€åœ¨åœ°åŒºï¼š</strong>' + business.location + '</p>';
                    
                    if (business.contact && business.phone) {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + business.contact + ' (' + business.phone + ')</p>';
                    }
                    
                    if (business.publishTime) {
                        html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + business.publishTime + '</p>';
                    }
                    
                    html += '</div>';
                }
            }
            
            if (html === '') {
                myRidesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸ“</p><p>æ‚¨è¿˜æ²¡æœ‰å‘å¸ƒè¿‡ä»»ä½•ä¿¡æ¯</p></div>';
            } else {
                myRidesContainer.innerHTML = html;
            }
        }
        
        // ä¿®æ”¹åçš„åˆ é™¤å‡½æ•°
        async function deleteRide(type, index) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè¡Œç¨‹å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ï¼')) return;
            
            try {
                let rideToDelete;
                if (type === 'car-find-passenger') {
                    rideToDelete = rides[index];
                    rides.splice(index, 1);
                } else if (type === 'passenger-find-car') {
                    rideToDelete = passengers[index];
                    passengers.splice(index, 1);
                }
                
                if (rideToDelete) {
                    await databaseService.deleteData('rides', rideToDelete.id);
                }
                
                alert('è¡Œç¨‹å·²åˆ é™¤ï¼');
                await displayMyRides();
                await displayAllInfo();
            } catch (error) {
                console.error('åˆ é™¤å¤±è´¥:', error);
                alert('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
            }
        }
        
        // åˆ é™¤å†œå‰¯äº§å“
        function deleteProduct(index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå†œå‰¯äº§å“ä¿¡æ¯å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ï¼')) {
                try {
                    products.splice(index, 1);
                    localStorage.setItem('products', JSON.stringify(products));
                    console.log('å†œå‰¯äº§å“ä¿¡æ¯å·²åˆ é™¤ï¼Œå‰©ä½™ï¼š' + products.length + ' æ¡');
                    
                    // åˆ·æ–°æ˜¾ç¤º
                    displayMyRides();
                    displayAllInfo();
                    alert('å†œå‰¯äº§å“ä¿¡æ¯å·²åˆ é™¤ï¼');
                } catch (e) {
                    console.error('åˆ é™¤å†œå‰¯äº§å“å¤±è´¥:', e);
                    alert('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
                }
            }
        }
        
        // åˆ é™¤å•†æœºä¿¡æ¯
        function deleteBusiness(index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå•†æœºä¿¡æ¯å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ï¼')) {
                try {
                    businesses.splice(index, 1);
                    localStorage.setItem('businesses', JSON.stringify(businesses));
                    console.log('å•†æœºä¿¡æ¯å·²åˆ é™¤ï¼Œå‰©ä½™ï¼š' + businesses.length + ' æ¡');
                    
                    // åˆ·æ–°æ˜¾ç¤º
                    displayMyRides();
                    displayAllInfo();
                    alert('å•†æœºä¿¡æ¯å·²åˆ é™¤ï¼');
                } catch (e) {
                    console.error('åˆ é™¤å•†æœºä¿¡æ¯å¤±è´¥:', e);
                    alert('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
                }
            }
        }
        
        // æ˜¾ç¤ºå¯†ç éªŒè¯æ¨¡æ€æ¡†
        function showPasswordModal() {
            var modal = document.getElementById('password-modal');
            var passwordInput = document.getElementById('password-input');
            passwordInput.value = '';
            modal.style.display = 'flex';
        }
        
        // éšè—å¯†ç éªŒè¯æ¨¡æ€æ¡†
        function hidePasswordModal() {
            var modal = document.getElementById('password-modal');
            modal.style.display = 'none';
        }
        
        // éªŒè¯å¯†ç 
        function verifyPassword() {
            var passwordInput = document.getElementById('password-input');
            var password = passwordInput.value.trim();
            
            // é»˜è®¤å¯†ç ï¼šadmin123
            if (password === 'admin123') {
                hidePasswordModal();
                showAnnouncementModal();
            } else {
                alert('å¯†ç é”™è¯¯ï¼è¯·è”ç³»ç®¡ç†å‘˜è·å–æ­£ç¡®å¯†ç ã€‚');
                passwordInput.value = '';
                passwordInput.focus();
            }
        }
        
        // æ˜¾ç¤ºå…¬å‘Šç¼–è¾‘æ¨¡æ€æ¡†
        function showAnnouncementModal() {
            var modal = document.getElementById('announcement-modal');
            var textarea = document.getElementById('announcement-textarea');
            var currentText = document.getElementById('announcement-text').textContent;
            
            textarea.value = currentText;
            modal.style.display = 'flex';
        }
        
        // éšè—å…¬å‘Šç¼–è¾‘æ¨¡æ€æ¡†
        function hideAnnouncementModal() {
            var modal = document.getElementById('announcement-modal');
            modal.style.display = 'none';
        }
        
        // ä¿å­˜å…¬å‘Š
        function saveAnnouncement() {
            var textarea = document.getElementById('announcement-textarea');
            var announcementText = textarea.value.trim();
            
            if (announcementText) {
                document.getElementById('announcement-text').textContent = announcementText;
                alert('å…¬å‘Šæ›´æ–°æˆåŠŸï¼');
                hideAnnouncementModal();
                
                // ä¿å­˜åˆ°localStorageä»¥ä¾¿æŒä¹…åŒ–
                localStorage.setItem('announcementText', announcementText);
            } else {
                alert('è¯·è¾“å…¥å…¬å‘Šå†…å®¹ï¼');
            }
        }
        
        // ç”¨æˆ·ç³»ç»Ÿç›¸å…³å‡½æ•°
        
        // æ ¼å¼åŒ–ç”µè¯å·ç æ˜¾ç¤º
        function formatPhone(ride, index, context) {
            // æ£€æŸ¥æ˜¯å¦å·²ä»˜è´¹
            var contactId = ride.type + '_' + index;
            var hasPaid = paidContacts.some(function(paid) { 
                return paid.id === contactId && paid.username === (currentUser ? currentUser.username : 'guest');
            });
            
            // å¦‚æœæ˜¯è‡ªå·±çš„è¡Œç¨‹æˆ–è€…å·²ä»˜è´¹ï¼Œæ˜¾ç¤ºå®Œæ•´å·ç 
            var isOwnRide = currentUser && ride.publisher === currentUser.username;
            if (isOwnRide || hasPaid) {
                return '<span style="color: #28a745;">' + ride.phone + '</span>';
            }
            
            // å¦åˆ™æ˜¾ç¤ºéšè—å·ç å’Œä»˜è´¹æŒ‰é’®
            var hiddenPhone = ride.phone.substring(0, 3) + '****' + ride.phone.substring(7);
            return '<span class="phone-hidden">' + hiddenPhone + '</span>' + 
                   '<button class="reveal-phone-btn" onclick="showPaymentModal(\'' + ride.type + '\', ' + index + ')">æŸ¥çœ‹å·ç </button>';
        }
        
        // æ˜¾ç¤ºè®¤è¯æ¨¡æ€æ¡†
        function showAuthModal() {
            var modal = document.getElementById('auth-modal');
            modal.style.display = 'flex';
        }
        
        // éšè—è®¤è¯æ¨¡æ€æ¡†
        function hideAuthModal() {
            var modal = document.getElementById('auth-modal');
            modal.style.display = 'none';
        }
        
        // åˆ‡æ¢è®¤è¯æ ‡ç­¾
        function switchAuthTab(tab) {
            var loginTab = document.querySelector('.auth-tab:first-child');
            var registerTab = document.querySelector('.auth-tab:last-child');
            var loginForm = document.getElementById('login-form');
            var registerForm = document.getElementById('register-form');
            
            if (tab === 'login') {
                loginTab.classList.add('active');
                registerTab.classList.remove('active');
                loginForm.classList.add('active');
                registerForm.classList.remove('active');
            } else {
                loginTab.classList.remove('active');
                registerTab.classList.add('active');
                loginForm.classList.remove('active');
                registerForm.classList.add('active');
            }
        }
        
        // ç”¨æˆ·æ³¨å†Œ
        function register() {
            var username = document.getElementById('register-username').value.trim();
            var password = document.getElementById('register-password').value.trim();
            var phone = document.getElementById('register-phone').value.trim();
            
            if (!username || !password || !phone) {
                alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯ï¼');
                return;
            }
            
            if (password.length < 6) {
                alert('å¯†ç è‡³å°‘éœ€è¦6ä½ï¼');
                return;
            }
            
            // æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
            if (users.some(function(user) { return user.username === username; })) {
                alert('ç”¨æˆ·åå·²å­˜åœ¨ï¼');
                return;
            }
            
            // åˆ›å»ºæ–°ç”¨æˆ·
            var newUser = {
                username: username,
                password: password,
                phone: phone,
                registerTime: new Date().toLocaleString(),
                balance: 0 // åˆå§‹ä½™é¢
            };
            
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            alert('ğŸ‰ æ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•ã€‚');
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('register-form').reset();
            
            // åˆ‡æ¢åˆ°ç™»å½•æ ‡ç­¾
            switchAuthTab('login');
        }
        
        // ç”¨æˆ·ç™»å½•
        function login() {
            var username = document.getElementById('login-username').value.trim();
            var password = document.getElementById('login-password').value.trim();
            
            if (!username || !password) {
                alert('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼');
                return;
            }
            
            // æŸ¥æ‰¾ç”¨æˆ·
            var user = users.find(function(u) { 
                return u.username === username && u.password === password; 
            });
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateUserDisplay();
                hideAuthModal();
                alert('ğŸ‰ ç™»å½•æˆåŠŸï¼æ¬¢è¿å›æ¥ï¼Œ' + user.username + 'ï¼');
                
                // æ¸…ç©ºç™»å½•è¡¨å•
                document.getElementById('login-form').reset();
                
                // åˆ·æ–°æ˜¾ç¤º
                displayRides();
                displayMyRides();
            } else {
                alert('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼');
            }
        }
        
        // ç”¨æˆ·é€€å‡ºç™»å½•
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                currentUser = null;
                localStorage.removeItem('currentUser');
                updateUserDisplay();
                alert('ğŸ‘‹ å·²é€€å‡ºç™»å½•');
                
                // åˆ·æ–°æ˜¾ç¤º
                displayRides();
                displayMyRides();
            }
        }
        
        // æ›´æ–°ç”¨æˆ·æ˜¾ç¤º
        function updateUserDisplay() {
            var userInfo = document.getElementById('user-info');
            var userStatus = document.getElementById('user-status');
            
            if (currentUser) {
                var isAdmin = adminUsers.includes(currentUser.username);
                var statusText = currentUser.username + ' (Â¥' + (currentUser.balance || 0).toFixed(2) + ')';
                
                userInfo.classList.add('logged-in');
                userInfo.classList.remove('guest');
                
                // æ„å»ºç”¨æˆ·ä¿¡æ¯HTML
                var userHTML = '<span id="user-status">' + statusText + '</span>';
                
                // å¦‚æœæ˜¯ç®¡ç†å‘˜ï¼Œæ·»åŠ ç®¡ç†å‘˜æŒ‰é’®
                if (isAdmin) {
                    userHTML += '<button class="user-btn" onclick="showAdminPanel()">ç®¡ç†</button>';
                }
                
                userHTML += '<button class="user-btn logout" onclick="logout()">é€€å‡º</button>';
                
                userInfo.innerHTML = userHTML;
            } else {
                userInfo.classList.add('guest');
                userInfo.classList.remove('logged-in');
                
                // æ›´æ–°æŒ‰é’®
                userInfo.innerHTML = '<span id="user-status">æ¸¸å®¢æ¨¡å¼</span>' +
                                 '<button class="user-btn" onclick="showAuthModal()">ç™»å½•/æ³¨å†Œ</button>';
            }
        }
        
        // æ˜¾ç¤ºä»˜è´¹æ¨¡æ€æ¡†
        function showPaymentModal(type, index) {
            currentViewingRide = index;
            currentViewingType = type;
            
            // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
            if (!currentUser) {
                alert('ğŸ”’ è¯·å…ˆç™»å½•åå†æŸ¥çœ‹è”ç³»æ–¹å¼ï¼');
                showAuthModal();
                return;
            }
            
            // æ£€æŸ¥ä½™é¢
            if ((currentUser.balance || 0) < 0.2) {
                alert('ğŸ’° ä½™é¢ä¸è¶³ï¼è¯·å……å€¼åå†æŸ¥çœ‹è”ç³»æ–¹å¼ã€‚\nå½“å‰ä½™é¢ï¼šÂ¥' + (currentUser.balance || 0).toFixed(2));
                return;
            }
            
            var modal = document.getElementById('payment-modal');
            modal.style.display = 'flex';
        }
        
        // éšè—ä»˜è´¹æ¨¡æ€æ¡†
        function hidePaymentModal() {
            var modal = document.getElementById('payment-modal');
            modal.style.display = 'none';
        }
        
        // æ¨¡æ‹Ÿæ”¯ä»˜
        function simulatePayment() {
            if (!currentUser || currentViewingRide === null) {
                alert('å‚æ•°é”™è¯¯ï¼');
                return;
            }
            
            // æ‰£é™¤è´¹ç”¨
            currentUser.balance = (currentUser.balance || 0) - 0.2;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            // æ›´æ–°ç”¨æˆ·åˆ—è¡¨ä¸­çš„ä½™é¢
            var userIndex = users.findIndex(function(u) { return u.username === currentUser.username; });
            if (userIndex !== -1) {
                users[userIndex].balance = currentUser.balance;
                localStorage.setItem('users', JSON.stringify(users));
            }
            
            // è®°å½•å·²ä»˜è´¹æŸ¥çœ‹
            var contactId = currentViewingType + '_' + currentViewingRide;
            paidContacts.push({
                id: contactId,
                username: currentUser.username,
                paymentTime: new Date().toLocaleString(),
                amount: 0.2
            });
            localStorage.setItem('paidContacts', JSON.stringify(paidContacts));
            
            // æ›´æ–°æ˜¾ç¤º
            updateUserDisplay();
            hidePaymentModal();
            alert('ğŸ’° æ”¯ä»˜æˆåŠŸï¼ç°åœ¨å¯ä»¥æŸ¥çœ‹è”ç³»æ–¹å¼äº†ã€‚');
            
            // åˆ·æ–°æ˜¾ç¤º
            if (document.getElementById('find').classList.contains('active')) {
                searchRides();
            } else if (document.getElementById('my-rides').classList.contains('active')) {
                displayMyRides();
            } else {
                displayRides();
            }
        }

        // ç®¡ç†å‘˜åŠŸèƒ½ç›¸å…³å‡½æ•°
        
        // æ˜¾ç¤ºç®¡ç†å‘˜é¢æ¿
        function showAdminPanel() {
            if (!currentUser || !adminUsers.includes(currentUser.username)) {
                alert('ğŸ”’ æ‚¨æ²¡æœ‰ç®¡ç†å‘˜æƒé™ï¼');
                return;
            }
            
            var panel = document.getElementById('admin-panel');
            panel.classList.add('show');
            
            // åŠ è½½ç”¨æˆ·åˆ—è¡¨
            loadAdminUserList();
            
            // åŠ è½½åˆ†äº«è®°å½•
            loadShareRecords();
        }
        
        // éšè—ç®¡ç†å‘˜é¢æ¿
        function hideAdminPanel() {
            var panel = document.getElementById('admin-panel');
            panel.classList.remove('show');
        }
        
        // åŠ è½½ç®¡ç†å‘˜ç”¨æˆ·åˆ—è¡¨
        function loadAdminUserList() {
            var userList = document.getElementById('admin-user-list');
            var usernameSelect = document.getElementById('recharge-username');
            
            // æ¸…ç©ºç°æœ‰å†…å®¹
            userList.innerHTML = '';
            usernameSelect.innerHTML = '<option value="">è¯·é€‰æ‹©ç”¨æˆ·</option>';
            
            if (users.length === 0) {
                userList.innerHTML = '<div class="user-item">æš‚æ— ç”¨æˆ·</div>';
                return;
            }
            
            // æ·»åŠ ç”¨æˆ·åˆ°åˆ—è¡¨å’Œé€‰æ‹©æ¡†
            users.forEach(function(user) {
                // æ·»åŠ åˆ°ç”¨æˆ·åˆ—è¡¨
                var userItem = document.createElement('div');
                userItem.className = 'user-item';
                userItem.innerHTML = '<span>' + user.username + '</span>' +
                                    '<span class="balance-info">Â¥' + (user.balance || 0).toFixed(2) + '</span>';
                userList.appendChild(userItem);
                
                // æ·»åŠ åˆ°é€‰æ‹©æ¡†
                var option = document.createElement('option');
                option.value = user.username;
                option.textContent = user.username + ' (ä½™é¢: Â¥' + (user.balance || 0).toFixed(2) + ')';
                usernameSelect.appendChild(option);
            });
        }
        
        // ç®¡ç†å‘˜å……å€¼
        function adminRecharge() {
            var username = document.getElementById('recharge-username').value;
            var amount = parseFloat(document.getElementById('recharge-amount').value);
            var note = document.getElementById('recharge-note').value.trim();
            
            if (!username) {
                alert('è¯·é€‰æ‹©è¦å……å€¼çš„ç”¨æˆ·ï¼');
                return;
            }
            
            if (!amount || amount <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„å……å€¼é‡‘é¢ï¼');
                return;
            }
            
            // æŸ¥æ‰¾ç”¨æˆ·
            var userIndex = users.findIndex(function(u) { return u.username === username; });
            if (userIndex === -1) {
                alert('ç”¨æˆ·ä¸å­˜åœ¨ï¼');
                return;
            }
            
            // æ›´æ–°ç”¨æˆ·ä½™é¢
            users[userIndex].balance = (users[userIndex].balance || 0) + amount;
            
            // è®°å½•å……å€¼è®°å½•
            var rechargeRecord = {
                username: username,
                amount: amount,
                note: note || 'ç®¡ç†å‘˜å……å€¼',
                admin: currentUser.username,
                timestamp: new Date().toLocaleString()
            };
            
            // ä¿å­˜å……å€¼è®°å½•
            if (!users[userIndex].rechargeRecords) {
                users[userIndex].rechargeRecords = [];
            }
            users[userIndex].rechargeRecords.push(rechargeRecord);
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('users', JSON.stringify(users));
            
            // å¦‚æœæ˜¯å½“å‰ç™»å½•ç”¨æˆ·ï¼ŒåŒæ—¶æ›´æ–°currentUser
            if (currentUser && currentUser.username === username) {
                currentUser.balance = users[userIndex].balance;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateUserDisplay();
            }
            
            // åˆ·æ–°ç®¡ç†é¢æ¿
            loadAdminUserList();
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('recharge-amount').value = '';
            document.getElementById('recharge-note').value = '';
            document.getElementById('recharge-username').value = '';
            
            alert('âœ… å……å€¼æˆåŠŸï¼\nç”¨æˆ·ï¼š' + username + '\né‡‘é¢ï¼šÂ¥' + amount.toFixed(2) + '\nå¤‡æ³¨ï¼š' + note);
        }
        
        // åŠ è½½åˆ†äº«è®°å½•
        function loadShareRecords() {
            var recordsContainer = document.getElementById('share-records');
            
            if (shareRecords.length === 0) {
                recordsContainer.innerHTML = '<div class="user-item">æš‚æ— åˆ†äº«è®°å½•</div>';
                return;
            }
            
            recordsContainer.innerHTML = '';
            
            // æŒ‰æ—¶é—´å€’åºæ’åˆ—
            var sortedRecords = shareRecords.slice().sort(function(a, b) {
                return new Date(b.timestamp) - new Date(a.timestamp);
            });
            
            // åªæ˜¾ç¤ºæœ€è¿‘20æ¡è®°å½•
            var recentRecords = sortedRecords.slice(0, 20);
            
            recentRecords.forEach(function(record) {
                var recordItem = document.createElement('div');
                recordItem.className = 'user-item';
                recordItem.innerHTML = '<span>' + record.username + ' (' + record.type + ')</span>' +
                                    '<span style="color: #28a745;">Â¥0.10</span>';
                recordItem.title = 'æ—¶é—´ï¼š' + record.timestamp;
                recordsContainer.appendChild(recordItem);
            });
        }

        // åˆ†äº«åŠŸèƒ½ç›¸å…³å‡½æ•°
        
        // åˆ†äº«åˆ°å¾®ä¿¡ç¾¤
        function shareToWechat() {
            if (!currentUser) {
                alert('ğŸ”’ è¯·å…ˆç™»å½•åå†åˆ†äº«ï¼');
                showAuthModal();
                return;
            }
            
            // å¤åˆ¶é“¾æ¥åˆ°å‰ªè´´æ¿
            var shareUrl = window.location.href;
            var shareText = 'ã€æ¹˜Mé¡ºé£è½¦ã€‘ç»¿è‰²å‡ºè¡Œï¼Œä¾¿æ°‘åˆ©æ°‘ï¼è½¦æ‰¾äººã€äººæ‰¾è½¦ï¼Œè¿˜æœ‰å†œå‰¯äº§å“å•†æœºå‘å¸ƒï¼Œèµ¶å¿«åŠ å…¥å§ï¼\n' + shareUrl;
            
            copyToClipboard(shareText);
            
            // éªŒè¯åˆ†äº«
            verifyShare('å¾®ä¿¡ç¾¤');
        }
        
        // åˆ†äº«åˆ°æœ‹å‹åœˆ
        function shareToMoments() {
            if (!currentUser) {
                alert('ğŸ”’ è¯·å…ˆç™»å½•åå†åˆ†äº«ï¼');
                showAuthModal();
                return;
            }
            
            // ç›´æ¥å¤åˆ¶é“¾æ¥å¹¶éªŒè¯
            var shareUrl = window.location.href;
            var shareText = 'ã€æ¹˜Mé¡ºé£è½¦ã€‘ç»¿è‰²å‡ºè¡Œï¼Œä¾¿æ°‘åˆ©æ°‘ï¼è½¦æ‰¾äººã€äººæ‰¾è½¦ï¼Œè¿˜æœ‰å†œå‰¯äº§å“å•†æœºå‘å¸ƒï¼Œèµ¶å¿«åŠ å…¥å§ï¼\n' + shareUrl;
            
            copyToClipboard(shareText);
            
            // ç®€åŒ–éªŒè¯ï¼šç‚¹å‡»å³è§†ä¸ºåˆ†äº«æˆåŠŸ
            verifyShare('æœ‹å‹åœˆ');
        }
        
        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard(text) {
            var textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                document.execCommand('copy');
                showShareStatus('âœ… é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            } catch (err) {
                showShareStatus('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ï¼š\n' + text);
            }
            
            document.body.removeChild(textarea);
        }
        
        // éªŒè¯åˆ†äº«å¹¶å‘æ”¾å¥–åŠ±
        function verifyShare(shareType) {
            if (!currentUser) return;
            
            // è·å–ä»Šæ—¥æ—¥æœŸ
            var today = new Date().toDateString();
            
            // è·å–ä»Šæ—¥åˆ†äº«è®°å½•ï¼ˆåŒ…æ‹¬ä¸è®¡è´¹çš„ï¼‰
            var todayAllRecords = shareRecords.filter(function(record) {
                return record.username === currentUser.username && 
                       record.timestamp.startsWith(today.substring(0, 10));
            });
            
            // è·å–ä»Šæ—¥å·²è®¡è´¹æ¬¡æ•°
            var todayPaidRecords = todayAllRecords.filter(function(record) {
                return record.amount > 0;
            });
            
            // æ£€æŸ¥ä»Šæ—¥å·²åˆ†äº«æ¬¡æ•°
            var totalShareCount = todayAllRecords.length;
            var paidShareCount = todayPaidRecords.length;
            
            // è®°å½•åˆ†äº«ï¼ˆå§‹ç»ˆè®°å½•ï¼Œä½†ä¸ä¸€å®šç»™å¥–åŠ±ï¼‰
            var shareRecord = {
                username: currentUser.username,
                type: shareType,
                amount: 0, // é»˜è®¤æ— å¥–åŠ±
                timestamp: new Date().toLocaleString()
            };
            
            var shouldGiveReward = false;
            var message = '';
            
            if (paidShareCount >= 5) {
                // å‰5æ¬¡å·²ç»è·å¾—å¥–åŠ±ï¼Œæœ¬æ¬¡ä¸ç»™å¥–åŠ±
                message = 'ğŸ“± åˆ†äº«å·²è®°å½•ï¼ä»Šæ—¥å‰5æ¬¡åˆ†äº«å·²è·å¾—å¥–åŠ±ï¼Œåç»­åˆ†äº«æ— å¥–åŠ±ã€‚';
            } else {
                // å‰5æ¬¡å†…ï¼Œç»™å¥–åŠ±
                shareRecord.amount = 0.10;
                shouldGiveReward = true;
                message = 'ğŸ‰ åˆ†äº«æˆåŠŸï¼è·å¾— Â¥0.10 å¥–åŠ±ï¼Œå·²è‡ªåŠ¨åˆ°è´¦ï¼';
            }
            
            // ä¿å­˜åˆ†äº«è®°å½•
            shareRecords.push(shareRecord);
            localStorage.setItem('shareRecords', JSON.stringify(shareRecords));
            
            // å¦‚æœéœ€è¦ç»™å¥–åŠ±
            if (shouldGiveReward) {
                currentUser.balance = (currentUser.balance || 0) + 0.10;
                
                // æ›´æ–°ç”¨æˆ·åˆ—è¡¨
                var userIndex = users.findIndex(function(u) { return u.username === currentUser.username; });
                if (userIndex !== -1) {
                    users[userIndex].balance = currentUser.balance;
                    localStorage.setItem('users', JSON.stringify(users));
                }
                
                // ä¿å­˜å½“å‰ç”¨æˆ·
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
            }
            
            // æ›´æ–°æ˜¾ç¤º
            updateUserDisplay();
            updateTodayShareAmount();
            updateShareCountDisplay(totalShareCount + 1, paidShareCount + (shouldGiveReward ? 1 : 0));
            
            showShareStatus(message);
        }
        
        // æ˜¾ç¤ºåˆ†äº«çŠ¶æ€
        function showShareStatus(message) {
            var statusElement = document.getElementById('share-status');
            statusElement.textContent = message;
            statusElement.style.color = message.includes('æˆåŠŸ') ? '#28a745' : '#dc3545';
            
            // 3ç§’åæ¢å¤é»˜è®¤çŠ¶æ€
            setTimeout(function() {
                statusElement.textContent = 'åˆ†äº«æˆåŠŸåå¥–åŠ±å°†è‡ªåŠ¨åˆ°è´¦';
                statusElement.style.color = '#666';
            }, 3000);
        }
        
        // æ›´æ–°ä»Šæ—¥åˆ†äº«é‡‘é¢
        function updateTodayShareAmount() {
            if (!currentUser) {
                document.getElementById('today-share-amount').textContent = '0.00';
                return;
            }
            
            var today = new Date().toDateString();
            var todayPaidRecords = shareRecords.filter(function(record) {
                return record.username === currentUser.username && 
                       record.timestamp.startsWith(today.substring(0, 10)) &&
                       record.amount > 0;
            });
            
            var todayAmount = todayPaidRecords.length * 0.10;
            document.getElementById('today-share-amount').textContent = todayAmount.toFixed(2);
        }
        
        // æ›´æ–°åˆ†äº«æ¬¡æ•°æ˜¾ç¤º
        function updateShareCountDisplay(totalCount, paidCount) {
            if (!currentUser) return;
            
            var countElement = document.getElementById('today-share-count');
            if (countElement) {
                countElement.textContent = paidCount + '/5';
            }
        }
        
        // åˆå§‹åŒ–åˆ†äº«æ¬¡æ•°æ˜¾ç¤º
        function initShareCountDisplay() {
            if (!currentUser) {
                var countElement = document.getElementById('today-share-count');
                if (countElement) {
                    countElement.textContent = '0/5';
                }
                return;
            }
            
            var today = new Date().toDateString();
            var todayAllRecords = shareRecords.filter(function(record) {
                return record.username === currentUser.username && 
                       record.timestamp.startsWith(today.substring(0, 10));
            });
            
            var todayPaidRecords = todayAllRecords.filter(function(record) {
                return record.amount > 0;
            });
            
            updateShareCountDisplay(todayAllRecords.length, todayPaidRecords.length);
        }
        
        // ä¿®æ”¹åçš„é¡µé¢åŠ è½½å‡½æ•°
        window.onload = async function() {
            console.log('æ¹˜Mé¡ºé£è½¦å¹³å°åŠ è½½å®Œæˆï¼');
            
            // æ•°æ®åŠ è½½ä¿æŠ¤å‡½æ•°
            function safeLoadData(key, defaultEmptyArray = false) {
                try {
                    var savedData = localStorage.getItem(key);
                    if (savedData) {
                        var parsed = JSON.parse(savedData);
                        return Array.isArray(parsed) ? parsed : [];
                    }
                    return defaultEmptyArray ? [] : null;
                } catch (e) {
                    console.warn('åŠ è½½æ•°æ®å¤±è´¥ [' + key + ']:', e);
                    return defaultEmptyArray ? [] : null;
                }
            }
            
            // ä¼˜å…ˆä»FirebaseåŠ è½½æ•°æ®
            await loadAllData();
            
            // åŠ è½½å½“å‰ç™»å½•ç”¨æˆ·
            var savedCurrentUser = localStorage.getItem('currentUser');
            if (savedCurrentUser) {
                try {
                    currentUser = JSON.parse(savedCurrentUser);
                } catch (e) {
                    console.warn('åŠ è½½å½“å‰ç”¨æˆ·å¤±è´¥:', e);
                    currentUser = null;
                }
            }
            
            // æ›´æ–°ç”¨æˆ·æ˜¾ç¤º
            updateUserDisplay();
            updateTodayShareAmount();
            initShareCountDisplay();
            
            // é»˜è®¤æ˜¾ç¤ºé¦–é¡µ
            switchTab('find');
            await displayAllInfo();
            
            // å¯åŠ¨æ•°æ®åŒæ­¥ï¼ˆæ¯30ç§’æ£€æŸ¥ä¸€æ¬¡ï¼‰
            setInterval(() => {
                if (databaseService.isOnline) {
                    databaseService.syncOfflineData();
                }
            }, 30000);
            
            // åˆå§‹åŒ–è®¾å¤‡æ£€æµ‹å’Œæ¡Œé¢å¿«æ·æ–¹å¼åŠŸèƒ½
            initializeDeviceDetection();
        };
        
        // æ•°æ®å¤‡ä»½åŠŸèƒ½ - åˆ›å»ºè‡ªåŠ¨å¤‡ä»½
        function createDataBackup() {
            try {
                var backupData = {
                    timestamp: new Date().toISOString(),
                    rides: rides,
                    passengers: passengers,
                    products: products,
                    businesses: businesses,
                    users: users,
                    shareRecords: shareRecords,
                    paidContacts: paidContacts
                };
                
                var backupKey = 'backup_' + new Date().getTime();
                localStorage.setItem(backupKey, JSON.stringify(backupData));
                
                // ä¿ç•™æœ€è¿‘10ä¸ªå¤‡ä»½
                var allKeys = Object.keys(localStorage).filter(function(key) {
                    return key.startsWith('backup_');
                });
                
                if (allKeys.length > 10) {
                    allKeys.sort();
                    for (var i = 0; i < allKeys.length - 10; i++) {
                        localStorage.removeItem(allKeys[i]);
                    }
                }
                
                console.log('æ•°æ®å¤‡ä»½å·²åˆ›å»ºï¼š' + backupKey);
            } catch (e) {
                console.error('åˆ›å»ºæ•°æ®å¤‡ä»½å¤±è´¥:', e);
            }
        }
        
        // å®šæœŸåˆ›å»ºå¤‡ä»½ï¼ˆæ¯5åˆ†é’Ÿï¼‰
        setInterval(function() {
            if (currentUser) {
                createDataBackup();
            }
        }, 5 * 60 * 1000);
        
        // è·å–äº§å“ç±»åˆ«åç§°
        function getCategoryName(category) {
            var categories = {
                'vegetables': 'æ–°é²œè”¬èœ',
                'fruits': 'æ—¶ä»¤æ°´æœ',
                'grains': 'ç²®é£Ÿæ‚ç²®',
                'livestock': 'ç¦½ç•œäº§å“',
                'aquatic': 'æ°´äº§æµ·é²œ',
                'processed': 'åŠ å·¥é£Ÿå“',
                'handmade': 'æ‰‹å·¥åˆ¶å“',
                'other': 'å…¶ä»–äº§å“'
            };
            return categories[category] || category;
        }
        
        // è·å–å“è´¨ç­‰çº§åç§°
        function getQualityName(quality) {
            var qualities = {
                'organic': 'æœ‰æœºè®¤è¯',
                'green': 'ç»¿è‰²æ— å…¬å®³',
                'ecological': 'ç”Ÿæ€ç§æ¤',
                'traditional': 'ä¼ ç»Ÿç§æ¤',
                'standard': 'å¸¸è§„æ ‡å‡†'
            };
            return qualities[quality] || quality;
        }
        
        // è·å–å•†æœºç±»å‹åç§°
        function getBusinessTypeName(type) {
            var types = {
                'cooperation': 'å•†ä¸šåˆä½œ',
                'investment': 'æŠ•èµ„æ‹›å•†',
                'transfer': 'åº—é“ºè½¬è®©',
                'equipment': 'è®¾å¤‡è½¬è®©',
                'recruitment': 'æ‹›è˜æ±‚èŒ',
                'procurement': 'é‡‡è´­éœ€æ±‚',
                'service': 'æœåŠ¡æä¾›',
                'other': 'å…¶ä»–å•†æœº'
            };
            return types[type] || type;
        }
        
        // è·å–æŠ•èµ„é‡‘é¢åç§°
        function getInvestmentName(investment) {
            var investments = {
                'small': '1ä¸‡å…ƒä»¥ä¸‹',
                'medium': '1-5ä¸‡å…ƒ',
                'large': '5-10ä¸‡å…ƒ',
                'xlarge': '10ä¸‡å…ƒä»¥ä¸Š',
                'negotiable': 'é¢è®®'
            };
            return investments[investment] || investment;
        }
        
        // è·å–ç´§æ€¥ç¨‹åº¦åç§°
        function getUrgencyName(urgency) {
            var urgencies = {
                'urgent': 'ç´§æ€¥',
                'normal': 'ä¸€èˆ¬',
                'relaxed': 'ä¸æ€¥'
            };
            return urgencies[urgency] || urgency;
        }
        
        // æ ¼å¼åŒ–äº§å“ç”µè¯å·ç æ˜¾ç¤º
        function formatProductPhone(product, index) {
            var isOwnProduct = currentUser && product.contact === currentUser.username;
            if (isOwnProduct) {
                return product.phone;
            }
            
            var contactKey = 'product_' + index;
            var hasPaid = paidContacts.some(function(contact) {
                return contact.key === contactKey && contact.username === currentUser.username;
            });
            
            if (hasPaid || !currentUser) {
                return product.phone;
            } else {
                return product.phone.substring(0, 3) + '****' + product.phone.substring(7) + 
                       ' <button class="reveal-phone-btn" onclick="showPaymentModal(\'product\', ' + index + ')">æŸ¥çœ‹</button>';
            }
        }
        
        // æ ¼å¼åŒ–å•†æœºç”µè¯å·ç æ˜¾ç¤º
        function formatBusinessPhone(business, index) {
            var isOwnBusiness = currentUser && business.contact === currentUser.username;
            if (isOwnBusiness) {
                return business.phone;
            }
            
            var contactKey = 'business_' + index;
            var hasPaid = paidContacts.some(function(contact) {
                return contact.key === contactKey && contact.username === currentUser.username;
            });
            
            if (hasPaid || !currentUser) {
                return business.phone;
            } else {
                return business.phone.substring(0, 3) + '****' + business.phone.substring(7) + 
                       ' <button class="reveal-phone-btn" onclick="showPaymentModal(\'business\', ' + index + ')">æŸ¥çœ‹</button>';
            }
        }
        
        // æ˜¾ç¤ºä»˜è´¹æŸ¥çœ‹æ¨¡æ€æ¡†
        function showPaymentModal(type, index) {
            currentViewingType = type;
            currentViewingIndex = index;
            document.getElementById('payment-modal').style.display = 'flex';
        }
        
        // æ¨¡æ‹Ÿæ”¯ä»˜åŠŸèƒ½
        function simulatePayment() {
            if (!currentUser) {
                alert('è¯·å…ˆç™»å½•åå†æŸ¥çœ‹è”ç³»æ–¹å¼ï¼');
                hidePaymentModal();
                showAuthModal();
                return;
            }
            
            var user = users.find(function(u) { return u.username === currentUser.username; });
            if (!user) {
                alert('ç”¨æˆ·ä¿¡æ¯é”™è¯¯ï¼Œè¯·é‡æ–°ç™»å½•ï¼');
                return;
            }
            
            if (user.balance < 0.20) {
                alert('ä½™é¢ä¸è¶³ï¼è¯·è”ç³»ç®¡ç†å‘˜å……å€¼ã€‚');
                hidePaymentModal();
                return;
            }
            
            // æ‰£é™¤è´¹ç”¨
            user.balance -= 0.20;
            localStorage.setItem('users', JSON.stringify(users));
            
            // è®°å½•ä»˜è´¹æŸ¥çœ‹
            var contactKey = currentViewingType + '_' + currentViewingIndex;
            paidContacts.push({
                username: currentUser.username,
                key: contactKey,
                time: new Date().toLocaleString(),
                amount: 0.20
            });
            localStorage.setItem('paidContacts', JSON.stringify(paidContacts));
            
            alert('æ”¯ä»˜æˆåŠŸï¼è”ç³»æ–¹å¼å·²æ˜¾ç¤ºã€‚');
            hidePaymentModal();
            
            // åˆ·æ–°æ˜¾ç¤º
            displayAllInfo();
        }
        
        // æœç´¢æ‰€æœ‰ä¿¡æ¯
        function searchAll() {
            var searchTerm = document.getElementById('search-input').value.toLowerCase();
            
            if (!searchTerm) {
                displayAllInfo();
                return;
            }
            
            // æœç´¢å¹¶æ˜¾ç¤ºç»“æœ
            searchAndDisplayRides(searchTerm);
            searchAndDisplayProducts(searchTerm);
            searchAndDisplayBusinesses(searchTerm);
        }
        
        // æœç´¢å¹¶æ˜¾ç¤ºè¡Œç¨‹
        function searchAndDisplayRides(searchTerm) {
            var ridesContainer = document.getElementById('rides-container');
            var allRides = [];
            
            if (rides.length > 0) {
                allRides = allRides.concat(rides);
            }
            if (passengers.length > 0) {
                allRides = allRides.concat(passengers);
            }
            
            var searchResults = allRides.filter(function(ride) {
                return [ride.departure, ride.destination, ride.name, ride.notes].some(function(field) {
                    return field && field.toLowerCase().includes(searchTerm);
                });
            });
            
            displaySearchResults(ridesContainer, searchResults, 'é¡ºé£è½¦', 'ğŸš—');
        }
        
        // æœç´¢å¹¶æ˜¾ç¤ºäº§å“
        function searchAndDisplayProducts(searchTerm) {
            var productsContainer = document.getElementById('products-container');
            var searchResults = products.filter(function(product) {
                return [product.name, product.location, product.description, product.contact].some(function(field) {
                    return field && field.toLowerCase().includes(searchTerm);
                });
            });
            
            displaySearchResults(productsContainer, searchResults, 'å†œå‰¯äº§å“', 'ğŸŒ¾');
        }
        
        // æœç´¢å¹¶æ˜¾ç¤ºå•†æœº
        function searchAndDisplayBusinesses(searchTerm) {
            var businessesContainer = document.getElementById('businesses-container');
            var searchResults = businesses.filter(function(business) {
                return [business.title, business.location, business.description, business.contact].some(function(field) {
                    return field && field.toLowerCase().includes(searchTerm);
                });
            });
            
            displaySearchResults(businessesContainer, searchResults, 'å•†æœºä¿¡æ¯', 'ğŸ’¼');
        }
        
        // æ˜¾ç¤ºæœç´¢ç»“æœ
        function displaySearchResults(container, results, typeName, icon) {
            if (results.length === 0) {
                container.innerHTML = '<div class="no-rides"><p style="font-size: 2rem; margin-bottom: 10px;">' + icon + '</p><p>æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„' + typeName + 'ä¿¡æ¯</p></div>';
                return;
            }
            
            // è°ƒç”¨ç›¸åº”çš„æ˜¾ç¤ºå‡½æ•°æ¥æ˜¾ç¤ºç»“æœ
            if (container.id === 'rides-container') {
                // ä¸´æ—¶ä¿å­˜åŸå§‹æ•°æ®å¹¶æ˜¾ç¤ºæœç´¢ç»“æœ
                var originalRides = rides;
                var originalPassengers = passengers;
                rides = results.filter(function(r) { return r.type === 'car-find-passenger'; });
                passengers = results.filter(function(r) { return r.type === 'passenger-find-car'; });
                displayRides();
                rides = originalRides;
                passengers = originalPassengers;
            } else if (container.id === 'products-container') {
                var originalProducts = products;
                products = results;
                displayProducts();
                products = originalProducts;
            } else if (container.id === 'businesses-container') {
                var originalBusinesses = businesses;
                businesses = results;
                displayBusinesses();
                businesses = originalBusinesses;
            }
        }
        
        // ===== æ¡Œé¢å¿«æ·æ–¹å¼åŠŸèƒ½ =====
        
        // æ£€æµ‹è®¾å¤‡ç±»å‹
        function detectDeviceType() {
            const userAgent = navigator.userAgent.toLowerCase();
            const deviceInfo = document.getElementById('device-info');
            
            if (/mobile|android|iphone|ipad|phone/i.test(userAgent)) {
                return 'mobile';
            } else if (/tablet|ipad/i.test(userAgent)) {
                return 'tablet';
            } else {
                return 'desktop';
            }
        }
        
        // åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼ä¸»å‡½æ•°
        async function createDesktopShortcut() {
            const deviceType = detectDeviceType();
            const statusElement = document.getElementById('shortcut-status');
            const instructionsElement = document.getElementById('shortcut-instructions');
            const instructionText = document.getElementById('instruction-text');
            
            statusElement.innerHTML = '<span style="color: #007bff;">âš™ï¸ æ­£åœ¨åˆ›å»ºå¿«æ·æ–¹å¼...</span>';
            
            try {
                if (deviceType === 'mobile') {
                    await createMobileShortcut();
                } else if (deviceType === 'tablet') {
                    await createTabletShortcut();
                } else {
                    await createDesktopPwaShortcut();
                }
            } catch (error) {
                console.error('åˆ›å»ºå¿«æ·æ–¹å¼å¤±è´¥:', error);
                statusElement.innerHTML = '<span style="color: #dc3545;">âŒ åˆ›å»ºå¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ·»åŠ </span>';
                showManualInstructions(deviceType);
            }
        }
        
        // åˆ›å»ºç§»åŠ¨ç«¯å¿«æ·æ–¹å¼
        async function createMobileShortcut() {
            const statusElement = document.getElementById('shortcut-status');
            
            // æ£€æŸ¥æ˜¯å¦æ”¯æŒPWA
            if ('serviceWorker' in navigator && 'PushManager' in window) {
                // å°è¯•å®‰è£…PWA
                if ('beforeinstallprompt' in window) {
                    statusElement.innerHTML = '<span style="color: #28a745;">âœ… è¯·ç‚¹å‡»æµè§ˆå™¨èœå•ä¸­çš„"æ·»åŠ åˆ°ä¸»å±å¹•"</span>';
                    showMobileInstructions();
                } else {
                    showManualMobileInstructions();
                }
            } else {
                showManualMobileInstructions();
            }
        }
        
        // åˆ›å»ºå¹³æ¿å¿«æ·æ–¹å¼
        async function createTabletShortcut() {
            await createMobileShortcut();
        }
        
        // åˆ›å»ºæ¡Œé¢PWAå¿«æ·æ–¹å¼
        async function createDesktopPwaShortcut() {
            const statusElement = document.getElementById('shortcut-status');
            
            // æ£€æŸ¥æ˜¯å¦æ”¯æŒPWAå®‰è£…
            if ('beforeinstallprompt' in window) {
                // è§¦å‘å®‰è£…æç¤º
                window.deferredPrompt.prompt();
                const { outcome } = await window.deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    statusElement.innerHTML = '<span style="color: #28a745;">âœ… æ¡Œé¢åº”ç”¨å®‰è£…æˆåŠŸï¼</span>';
                    window.deferredPrompt = null;
                } else {
                    showManualDesktopInstructions();
                }
            } else {
                // ä¸æ”¯æŒPWAï¼Œæ˜¾ç¤ºæ‰‹åŠ¨æ“ä½œè¯´æ˜
                showManualDesktopInstructions();
            }
        }
        
        // æ˜¾ç¤ºç§»åŠ¨ç«¯æ“ä½œè¯´æ˜
        function showMobileInstructions() {
            const instructionsElement = document.getElementById('shortcut-instructions');
            const instructionText = document.getElementById('instruction-text');
            
            instructionText.innerHTML = `
                <div style="text-align: left; line-height: 1.8;">
                    <p><strong>ğŸ“± å®‰å“æ‰‹æœºï¼š</strong></p>
                    <ol style="margin-left: 20px; color: #666;">
                        <li>ç‚¹å‡»æµè§ˆå™¨å³ä¸Šè§’çš„èœå•æŒ‰é’®ï¼ˆä¸‰ä¸ªç‚¹ï¼‰</li>
                        <li>é€‰æ‹©"æ·»åŠ åˆ°ä¸»å±å¹•"æˆ–"å®‰è£…åº”ç”¨"</li>
                        <li>ç¡®è®¤æ·»åŠ å³å¯å®Œæˆ</li>
                    </ol>
                    
                    <p style="margin-top: 15px;"><strong>ğŸ iPhone/iPadï¼š</strong></p>
                    <ol style="margin-left: 20px; color: #666;">
                        <li>ç‚¹å‡»åº•éƒ¨ä¸­é—´çš„åˆ†äº«æŒ‰é’®ï¼ˆæ–¹æ¡†å‘ä¸Šç®­å¤´ï¼‰</li>
                        <li>æ»‘åŠ¨æ‰¾åˆ°"æ·»åŠ åˆ°ä¸»å±å¹•"</li>
                        <li>ç‚¹å‡»æ·»åŠ å¹¶ç¡®è®¤åç§°</li>
                    </ol>
                </div>
            `;
            
            instructionsElement.style.display = 'block';
        }
        
        // æ˜¾ç¤ºæ‰‹åŠ¨ç§»åŠ¨ç«¯è¯´æ˜
        function showManualMobileInstructions() {
            const statusElement = document.getElementById('shortcut-status');
            statusElement.innerHTML = '<span style="color: #ff8800;">ğŸ“± è¯·æŒ‰ç…§ä¸‹æ–¹è¯´æ˜æ‰‹åŠ¨æ·»åŠ å¿«æ·æ–¹å¼</span>';
            showMobileInstructions();
        }
        
        // æ˜¾ç¤ºæ‰‹åŠ¨æ¡Œé¢è¯´æ˜
        function showManualDesktopInstructions() {
            const statusElement = document.getElementById('shortcut-status');
            const instructionsElement = document.getElementById('shortcut-instructions');
            const instructionText = document.getElementById('instruction-text');
            
            statusElement.innerHTML = '<span style="color: #ff8800;">ğŸ–¥ï¸ è¯·æŒ‰ç…§ä¸‹æ–¹è¯´æ˜æ‰‹åŠ¨æ·»åŠ å¿«æ·æ–¹å¼</span>';
            
            instructionText.innerHTML = `
                <div style="text-align: left; line-height: 1.8;">
                    <p><strong>ğŸŒ Chrome æµè§ˆå™¨ï¼š</strong></p>
                    <ol style="margin-left: 20px; color: #666;">
                        <li>ç‚¹å‡»åœ°å€æ å³ä¾§çš„å®‰è£…å›¾æ ‡ï¼ˆâŠ•ï¼‰</li>
                        <li>ç‚¹å‡»"å®‰è£…åº”ç”¨ç¨‹åº"</li>
                        <li>ç¡®è®¤å®‰è£…å³å¯åœ¨æ¡Œé¢æ‰¾åˆ°åº”ç”¨</li>
                    </ol>
                    
                    <p style="margin-top: 15px;"><strong>ğŸŒ Edge æµè§ˆå™¨ï¼š</strong></p>
                    <ol style="margin-left: 20px; color: #666;">
                        <li>ç‚¹å‡»åœ°å€æ å³ä¾§çš„åº”ç”¨å›¾æ ‡</li>
                        <li>é€‰æ‹©"å°†æ­¤ç«™ç‚¹å®‰è£…ä¸ºåº”ç”¨"</li>
                        <li>ç¡®è®¤å®‰è£…å®Œæˆ</li>
                    </ol>
                    
                    <p style="margin-top: 15px;"><strong>ğŸŒ Firefox æµè§ˆå™¨ï¼š</strong></p>
                    <ol style="margin-left: 20px; color: #666;">
                        <li>ç‚¹å‡»åœ°å€æ å³ä¾§çš„"+"å›¾æ ‡</li>
                        <li>é€‰æ‹©"å®‰è£…ç«™ç‚¹"</li>
                        <li>ç¡®è®¤å®‰è£…</li>
                    </ol>
                </div>
            `;
            
            instructionsElement.style.display = 'block';
        }
        
        // æ˜¾ç¤ºé€šç”¨æ‰‹åŠ¨è¯´æ˜
        function showManualInstructions(deviceType) {
            if (deviceType === 'mobile' || deviceType === 'tablet') {
                showManualMobileInstructions();
            } else {
                showManualDesktopInstructions();
            }
        }
        
        // ä¸‹è½½æ¡Œé¢å¿«æ·æ–¹å¼æ–‡ä»¶ï¼ˆWindowsï¼‰
        function downloadDesktopShortcut() {
            const shortcutContent = `[InternetShortcut]
URL=${window.location.href}
IDList=
IconFile=${window.location.origin}/favicon.ico
IconIndex=0
HotKey=0
[{000214A0-0000-0000-C000-000000000046}]
Prop3=19,2`;
            
            const blob = new Blob([shortcutContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'æ¹˜Mä¿¡æ¯å‘å¸ƒå¹³å°.url';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // PWAå®‰è£…äº‹ä»¶ç›‘å¬
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            // é˜»æ­¢é»˜è®¤å®‰è£…æç¤º
            e.preventDefault();
            // ä¿å­˜äº‹ä»¶ä»¥ä¾¿åç»­ä½¿ç”¨
            deferredPrompt = e;
            
            // æ˜¾ç¤ºå®‰è£…æŒ‰é’®ï¼ˆå¦‚æœéœ€è¦ï¼‰
            const installBtn = document.getElementById('create-shortcut-btn');
            if (installBtn) {
                installBtn.style.background = 'linear-gradient(135deg, #28a745, #20c997)';
                installBtn.innerHTML = 'ğŸ“± å®‰è£…åˆ°æ¡Œé¢';
            }
        });
        
        // ç›‘å¬PWAå®‰è£…å®Œæˆ
        window.addEventListener('appinstalled', () => {
            const statusElement = document.getElementById('shortcut-status');
            statusElement.innerHTML = '<span style="color: #28a745;">ğŸ‰ åº”ç”¨å®‰è£…æˆåŠŸï¼ç°åœ¨å¯ä»¥åœ¨æ¡Œé¢æ‰¾åˆ°æ¹˜Mä¿¡æ¯å‘å¸ƒå¹³å°</span>';
            
            const installBtn = document.getElementById('create-shortcut-btn');
            if (installBtn) {
                installBtn.innerHTML = 'âœ… å·²å®‰è£…';
                installBtn.disabled = true;
            }
        });
        
        // åˆå§‹åŒ–è®¾å¤‡æ£€æµ‹
        function initializeDeviceDetection() {
            const deviceType = detectDeviceType();
            const deviceInfo = document.getElementById('device-info');
            const shortcutBtn = document.getElementById('create-shortcut-btn');
            
            let deviceText = '';
            switch(deviceType) {
                case 'mobile':
                    deviceText = 'ğŸ“± æ£€æµ‹åˆ°æ‰‹æœºè®¾å¤‡';
                    shortcutBtn.innerHTML = 'ğŸ“± åˆ›å»ºæ‰‹æœºå¿«æ·æ–¹å¼';
                    break;
                case 'tablet':
                    deviceText = 'ğŸ“± æ£€æµ‹åˆ°å¹³æ¿è®¾å¤‡';
                    shortcutBtn.innerHTML = 'ğŸ“± åˆ›å»ºå¹³æ¿å¿«æ·æ–¹å¼';
                    break;
                default:
                    deviceText = 'ğŸ–¥ï¸ æ£€æµ‹åˆ°ç”µè„‘è®¾å¤‡';
                    shortcutBtn.innerHTML = 'ğŸ–¥ï¸ åˆ›å»ºæ¡Œé¢åº”ç”¨';
            }
            
            if (deviceInfo) {
                deviceInfo.textContent = deviceText;
            }
        }
    </script>
</body>
</html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¹˜Mä¿¡æ¯å‘å¸ƒå¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: #ff5100;
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 5px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .announcement-bar {
            background: linear-gradient(135deg, #ff8a00, #ff5100);
            color: white;
            padding: 10px 0;
            margin-bottom: 20px;
            overflow: hidden;
            border-radius: 25px;
            box-shadow: 0 2px 10px rgba(255, 81, 0, 0.3);
        }
        
        .announcement-content {
            display: flex;
            align-items: center;
            white-space: nowrap;
            animation: scroll-left 20s linear infinite;
        }
        
        .announcement-content:hover {
            animation-play-state: paused;
        }
        
        .announcement-icon {
            margin-right: 15px;
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .announcement-text {
            font-size: 1rem;
            font-weight: 500;
            padding-right: 50px;
        }
        
        .edit-announcement-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            cursor: pointer;
            margin-left: auto;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        
        .edit-announcement-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .announcement-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        .announcement-modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .announcement-modal h3 {
            color: #ff5100;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .announcement-textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
            resize: vertical;
            margin-bottom: 15px;
        }
        
        .announcement-textarea:focus {
            outline: none;
            border-color: #ff5100;
            box-shadow: 0 0 0 3px rgba(255, 81, 0, 0.1);
        }
        
        @keyframes scroll-left {
            0% {
                transform: translateX(100%);
            }
            100% {
                transform: translateX(-100%);
            }
        }
        
        .tabs {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            gap: 5px;
        }
        
        .tab {
            padding: 10px 16px;
            cursor: pointer;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 2px solid #dee2e6;
            border-bottom: none;
            border-radius: 12px 12px 0 0;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        
        .tab:hover {
            background: linear-gradient(135deg, #fff5f0, #ffe8d6);
            border-color: #ffccbc;
            transform: translateY(-1px);
        }
        
        .tab.active {
            background: linear-gradient(135deg, #ff5100, #ff6b35);
            color: white;
            border-color: #ff5100;
            margin-bottom: -2px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(255, 81, 0, 0.3);
        }
        
        .tab-content {
            display: none;
            background-color: white;
            padding: 20px;
            border-radius: 0 5px 5px 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .tab-content.active {
            display: block;
        }
        
        form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        button {
            background: linear-gradient(135deg, #ff6b35, #ff5100);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 81, 0, 0.3);
        }
        
        button:hover {
            background: linear-gradient(135deg, #ff5100, #e64a00);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 81, 0, 0.4);
        }
        
        .search-form {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
        }
        
        .search-form input {
            flex: 1;
            padding: 12px 16px;
            font-size: 1rem;
            border: 2px solid #ddd;
            border-radius: 25px;
            transition: border-color 0.3s ease;
            min-width: 300px;
        }
        
        .search-form input:focus {
            outline: none;
            border-color: #ff5100;
            box-shadow: 0 0 0 3px rgba(255, 81, 0, 0.1);
        }
        
        .search-form button {
            padding: 12px 24px;
            font-size: 0.95rem;
            white-space: nowrap;
            min-width: auto;
            flex-shrink: 0;
        }
        
        .rides-list {
            display: grid;
            gap: 15px;
        }
        
        .ride-card {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .ride-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .no-rides {
            text-align: center;
            padding: 40px;
            color: #777;
        }
        
        footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 20px 0;
            margin-top: 40px;
            border-top: 3px solid #ff5100;
        }
        
        footer p {
            margin: 0;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* ç”¨æˆ·ç³»ç»Ÿæ ·å¼ */
        .user-info {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px 15px;
            border-radius: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-info.guest {
            background: #f8f9fa;
        }

        .user-info.logged-in {
            background: linear-gradient(135deg, #ff5100, #ff6b35);
            color: white;
        }

        .user-btn {
            background: #ff5100;
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .user-btn:hover {
            background: #e64a00;
            transform: scale(1.05);
        }

        .user-btn.logout {
            background: #dc3545;
            margin-left: 5px;
        }

        .user-btn.logout:hover {
            background: #c82333;
        }

        /* ä»˜è´¹æŸ¥çœ‹åŠŸèƒ½æ ·å¼ */
        .phone-hidden {
            color: #999;
            font-style: italic;
        }

        .reveal-phone-btn {
            background: linear-gradient(135deg, #20c997, #1ea085);
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-left: 10px;
            transition: all 0.3s ease;
        }

        .reveal-phone-btn:hover {
            background: linear-gradient(135deg, #1ea085, #1a8c77);
            transform: translateY(-1px);
        }

        .payment-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .payment-modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
        }

        .payment-modal h3 {
            color: #ff5100;
            margin-bottom: 20px;
        }

        .payment-price {
            font-size: 2rem;
            color: #ff5100;
            font-weight: bold;
            margin: 15px 0;
        }

        .payment-btn {
            background: linear-gradient(135deg, #20c997, #1ea085);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .payment-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(32, 201, 151, 0.3);
        }

        .cancel-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            margin-top: 10px;
        }

        /* ç”¨æˆ·æ³¨å†Œ/ç™»å½•è¡¨å•æ ·å¼ */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .auth-modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .auth-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-bottom: none;
        }

        .auth-tab.active {
            background: #ff5100;
            color: white;
            border-color: #ff5100;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        /* ç®¡ç†å‘˜åŠŸèƒ½æ ·å¼ */
        .admin-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            padding: 20px;
            z-index: 999;
            display: none;
            min-width: 350px;
            max-height: 600px;
            overflow-y: auto;
        }

        .admin-panel.show {
            display: block;
        }

        .admin-header {
            background: linear-gradient(135deg, #ff5100, #ff6b35);
            color: white;
            padding: 15px;
            border-radius: 10px 10px 0 0;
            margin: -20px -20px 20px -20px;
            text-align: center;
        }

        .admin-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .admin-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .admin-section h4 {
            color: #ff5100;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .recharge-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .recharge-form input, .recharge-form select {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .recharge-form input:focus, .recharge-form select:focus {
            outline: none;
            border-color: #ff5100;
        }

        .admin-btn {
            background: linear-gradient(135deg, #20c997, #1ea085);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .admin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(32, 201, 151, 0.3);
        }

        .admin-btn.danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }

        .user-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .user-item {
            padding: 8px 12px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
        }

        .user-item:last-child {
            border-bottom: none;
        }

        .user-item:hover {
            background: white;
        }

        .balance-info {
            color: #20c997;
            font-weight: 600;
        }

        /* åˆ†äº«åŠŸèƒ½æ ·å¼ */
        .share-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .share-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .share-amount {
            color: #28a745;
            font-size: 1.2rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .share-status {
            font-size: 0.85rem;
            color: #666;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ -->
    <div class="user-info" id="user-info">
        <span id="user-status">æ¸¸å®¢æ¨¡å¼</span>
        <button class="user-btn" onclick="showAuthModal()">ç™»å½•/æ³¨å†Œ</button>
    </div>

    <!-- ç®¡ç†å‘˜é¢æ¿ -->
    <div class="admin-panel" id="admin-panel">
        <div class="admin-header">
            <h3>ğŸ”§ ç®¡ç†å‘˜æ§åˆ¶å°</h3>
        </div>
        
        <!-- ç”¨æˆ·å……å€¼ç®¡ç† -->
        <div class="admin-section">
            <h4>ğŸ’° ç”¨æˆ·å……å€¼ç®¡ç†</h4>
            <div class="recharge-form">
                <select id="recharge-username" placeholder="é€‰æ‹©ç”¨æˆ·">
                    <option value="">è¯·é€‰æ‹©ç”¨æˆ·</option>
                </select>
                <input type="number" id="recharge-amount" placeholder="å……å€¼é‡‘é¢ï¼ˆå…ƒï¼‰" min="0.01" step="0.01">
                <input type="text" id="recharge-note" placeholder="å……å€¼å¤‡æ³¨ï¼ˆå¦‚ï¼šçº¿ä¸‹æ‰“æ¬¾ï¼‰">
                <button class="admin-btn" onclick="adminRecharge()">ç¡®è®¤å……å€¼</button>
            </div>
        </div>

        <!-- ç”¨æˆ·ä½™é¢æŸ¥çœ‹ -->
        <div class="admin-section">
            <h4>ğŸ‘¥ ç”¨æˆ·ä½™é¢æŸ¥çœ‹</h4>
            <div class="user-list" id="admin-user-list">
                <!-- ç”¨æˆ·åˆ—è¡¨å°†åŠ¨æ€åŠ è½½ -->
            </div>
        </div>

        <!-- åˆ†äº«å¥–åŠ±è®°å½• -->
        <div class="admin-section">
            <h4>ğŸ“± åˆ†äº«å¥–åŠ±è®°å½•</h4>
            <div class="user-list" id="share-records">
                <!-- åˆ†äº«è®°å½•å°†åŠ¨æ€åŠ è½½ -->
            </div>
        </div>

        <!-- å…³é—­é¢æ¿ -->
        <div style="text-align: center; margin-top: 20px;">
            <button class="admin-btn danger" onclick="hideAdminPanel()">å…³é—­é¢æ¿</button>
        </div>
    </div>


        

        
        <div id="publish" class="tab-content">
            <h2>å‘å¸ƒè½¦æ‰¾äººä¿¡æ¯</h2>
            <p>å‘å¸ƒæ‚¨çš„é¡ºé£è½¦ä¿¡æ¯ï¼Œå¯»æ‰¾åŒè¡Œçš„ä¹˜å®¢ã€‚</p>
            <form onsubmit="publishRide(event)">
                <div class="form-group">
                    <label for="departure">å‡ºå‘åœ°</label>
                    <input type="text" id="departure" placeholder="ä¾‹å¦‚: ç‹å®¶æ‘æ‘å§”ä¼š" required>
                </div>
                
                <div class="form-group">
                    <label for="destination">ç›®çš„åœ°</label>
                    <input type="text" id="destination" placeholder="ä¾‹å¦‚: å¿åŸæ±½è½¦ç«™" required>
                </div>
                
                <div class="form-group">
                    <label for="date">å‡ºå‘æ—¥æœŸ</label>
                    <input type="date" id="date" required>
                </div>
                
                <div class="form-group">
                    <label for="time">å‡ºå‘æ—¶é—´</label>
                    <input type="time" id="time" required>
                </div>
                
                <div class="form-group">
                    <label for="seats">å¯ç”¨åº§ä½</label>
                    <select id="seats" required>
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="1">1ä¸ªåº§ä½</option>
                        <option value="2">2ä¸ªåº§ä½</option>
                        <option value="3">3ä¸ªåº§ä½</option>
                        <option value="4">4ä¸ªåº§ä½</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="price">æ¯äººè´¹ç”¨</label>
                    <input type="number" id="price" placeholder="ä¾‹å¦‚: 10" required>
                </div>
                
                <div class="form-group full-width">
                    <label for="notes">å¤‡æ³¨ä¿¡æ¯</label>
                    <textarea id="notes" rows="3" placeholder="ä¾‹å¦‚: åå¤‡ç®±ç©ºé—´æœ‰é™ï¼Œå¤§ä»¶è¡Œæè¯·æå‰å‘ŠçŸ¥"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="name">è”ç³»äºº</label>
                    <input type="text" id="name" placeholder="æ‚¨çš„å§“å" required>
                </div>
                
                <div class="form-group">
                    <label for="phone">è”ç³»ç”µè¯</label>
                    <input type="tel" id="phone" placeholder="æ‚¨çš„æ‰‹æœºå·ç " required>
                </div>
                
                <div class="form-group full-width">
                    <button type="submit">å‘å¸ƒè½¦æ‰¾äººä¿¡æ¯</button>
                </div>
            </form>
        </div>
        
        <div id="find-car" class="tab-content">
            <h2>å‘å¸ƒäººæ‰¾è½¦ä¿¡æ¯</h2>
            <p>å‘å¸ƒæ‚¨çš„ä¹˜è½¦éœ€æ±‚ï¼Œå¯»æ‰¾åˆé€‚çš„é¡ºé£è½¦ã€‚</p>
            <form onsubmit="publishPassenger(event)">
                <div class="form-group">
                    <label for="passenger-departure">å‡ºå‘åœ°</label>
                    <input type="text" id="passenger-departure" placeholder="ä¾‹å¦‚: æå®¶æ‘å°å­¦" required>
                </div>
                
                <div class="form-group">
                    <label for="passenger-destination">ç›®çš„åœ°</label>
                    <input type="text" id="passenger-destination" placeholder="ä¾‹å¦‚: å¿åŸåŒ»é™¢" required>
                </div>
                
                <div class="form-group">
                    <label for="passenger-date">å‡ºå‘æ—¥æœŸ</label>
                    <input type="date" id="passenger-date" required>
                </div>
                
                <div class="form-group">
                    <label for="passenger-time">å‡ºå‘æ—¶é—´</label>
                    <input type="time" id="passenger-time" required>
                </div>
                
                <div class="form-group">
                    <label for="passenger-count">ä¹˜è½¦äººæ•°</label>
                    <select id="passenger-count" required>
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="1">1äºº</option>
                        <option value="2">2äºº</option>
                        <option value="3">3äºº</option>
                        <option value="4">4äºº</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="passenger-budget">é¢„ç®—è´¹ç”¨</label>
                    <input type="number" id="passenger-budget" placeholder="ä¾‹å¦‚: 15" required>
                </div>
                
                <div class="form-group full-width">
                    <label for="passenger-notes">ç‰¹åˆ«éœ€æ±‚</label>
                    <textarea id="passenger-notes" rows="3" placeholder="ä¾‹å¦‚: æœ‰å„¿ç«¥åº§æ¤…éœ€æ±‚ï¼Œæœ‰å¤§ä»¶è¡Œæ"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="passenger-name">è”ç³»äºº</label>
                    <input type="text" id="passenger-name" placeholder="æ‚¨çš„å§“å" required>
                </div>
                
                <div class="form-group">
                    <label for="passenger-phone">è”ç³»ç”µè¯</label>
                    <input type="tel" id="passenger-phone" placeholder="æ‚¨çš„æ‰‹æœºå·ç " required>
                </div>
                
                <div class="form-group full-width">
                    <button type="submit">å‘å¸ƒäººæ‰¾è½¦ä¿¡æ¯</button>
                </div>
            </form>
        </div>
        
        <div id="find" class="tab-content active">
            <h2>ğŸ  æ¹˜Mä¿¡æ¯å‘å¸ƒå¹³å°é¦–é¡µ</h2>
            <p style="color: #666; margin-bottom: 20px;">æ±‡èšä¹¡é•‡å‡ºè¡Œä¿¡æ¯ã€å†œå‰¯äº§å“ã€å•†ä¸šæœºä¼šï¼Œä¾¿æ°‘æœåŠ¡å¹³å°</p>
            
            <div class="search-form">
                <input type="text" id="search-input" placeholder="ğŸ” æœç´¢å‡ºå‘åœ°ã€ç›®çš„åœ°ã€äº§å“ã€å•†æœº..." onkeypress="if(event.keyCode==13) searchAll()">
                <button onclick="searchAll()">ğŸ” æœç´¢</button>
            </div>
            
            <!-- ä¿¡æ¯åˆ†ç±»æ˜¾ç¤º -->
            <div style="margin: 30px 0;">
                <h3 style="color: #ff5100; margin-bottom: 20px; border-bottom: 2px solid #ff5100; padding-bottom: 5px;">
                    ğŸš— é¡ºé£è½¦å‡ºè¡Œä¿¡æ¯
                </h3>
                <div id="rides-container">
                    <div class="no-rides">
                        <p style="font-size: 2rem; margin-bottom: 10px;">ğŸš—</p>
                        <p>æš‚æ— é¡ºé£è½¦ä¿¡æ¯</p>
                    </div>
                </div>
            </div>
            
            <div style="margin: 30px 0;">
                <h3 style="color: #28a745; margin-bottom: 20px; border-bottom: 2px solid #28a745; padding-bottom: 5px;">
                    ğŸŒ¾ å†œå‰¯äº§å“ä¿¡æ¯
                </h3>
                <div id="products-container">
                    <div class="no-rides">
                        <p style="font-size: 2rem; margin-bottom: 10px;">ğŸŒ¾</p>
                        <p>æš‚æ— å†œå‰¯äº§å“ä¿¡æ¯</p>
                    </div>
                </div>
            </div>
            
            <div style="margin: 30px 0;">
                <h3 style="color: #007bff; margin-bottom: 20px; border-bottom: 2px solid #007bff; padding-bottom: 5px;">
                    ğŸ’¼ å•†æœºåˆä½œä¿¡æ¯
                </h3>
                <div id="businesses-container">
                    <div class="no-rides">
                        <p style="font-size: 2rem; margin-bottom: 10px;">ğŸ’¼</p>
                        <p>æš‚æ— å•†æœºä¿¡æ¯</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="products" class="tab-content">
            <h2>ğŸŒ¾ å†œå‰¯äº§å“å‘å¸ƒ</h2>
            <p>å‘å¸ƒæ‚¨çš„å†œå‰¯äº§å“ä¿¡æ¯ï¼Œæ‹“å±•é”€å”®æ¸ é“ï¼Œä¿ƒè¿›å†œäº§å“æµé€šã€‚</p>
            <form onsubmit="publishProduct(event)">
                <div class="form-group">
                    <label for="product-name">äº§å“åç§°</label>
                    <input type="text" id="product-name" placeholder="ä¾‹å¦‚: åœŸé¸¡è›‹ã€æ–°é²œè”¬èœã€æ‰‹å·¥è±†è…" required>
                </div>
                
                <div class="form-group">
                    <label for="product-category">äº§å“ç±»åˆ«</label>
                    <select id="product-category" required>
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="vegetables">æ–°é²œè”¬èœ</option>
                        <option value="fruits">æ—¶ä»¤æ°´æœ</option>
                        <option value="grains">ç²®é£Ÿæ‚ç²®</option>
                        <option value="livestock">ç¦½ç•œäº§å“</option>
                        <option value="aquatic">æ°´äº§æµ·é²œ</option>
                        <option value="processed">åŠ å·¥é£Ÿå“</option>
                        <option value="handmade">æ‰‹å·¥åˆ¶å“</option>
                        <option value="other">å…¶ä»–äº§å“</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="product-quantity">ä¾›åº”æ•°é‡</label>
                    <input type="text" id="product-quantity" placeholder="ä¾‹å¦‚: 50æ–¤ã€20ä¸ªã€100å…¬æ–¤" required>
                </div>
                
                <div class="form-group">
                    <label for="product-price">é¢„æœŸä»·æ ¼</label>
                    <input type="text" id="product-price" placeholder="ä¾‹å¦‚: 5å…ƒ/æ–¤ã€120å…ƒ/ç®±" required>
                </div>
                
                <div class="form-group">
                    <label for="product-location">äº§å“äº§åœ°</label>
                    <input type="text" id="product-location" placeholder="ä¾‹å¦‚: ç‹å®¶æ‘ç”Ÿæ€å†œåœº" required>
                </div>
                
                <div class="form-group">
                    <label for="product-harvest">é‡‡æ”¶æ—¶é—´</label>
                    <input type="date" id="product-harvest" required>
                </div>
                
                <div class="form-group">
                    <label for="product-quality">å“è´¨ç­‰çº§</label>
                    <select id="product-quality" required>
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="organic">æœ‰æœºè®¤è¯</option>
                        <option value="green">ç»¿è‰²æ— å…¬å®³</option>
                        <option value="ecological">ç”Ÿæ€ç§æ¤</option>
                        <option value="traditional">ä¼ ç»Ÿç§æ¤</option>
                        <option value="standard">å¸¸è§„æ ‡å‡†</option>
                    </select>
                </div>
                
                <div class="form-group full-width">
                    <label for="product-description">äº§å“æè¿°</label>
                    <textarea id="product-description" rows="3" placeholder="è¯·è¯¦ç»†æè¿°äº§å“ç‰¹ç‚¹ã€ç§æ¤æ–¹å¼ã€è¥å…»ä»·å€¼ç­‰ä¿¡æ¯..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="product-contact">è”ç³»äºº</label>
                    <input type="text" id="product-contact" placeholder="æ‚¨çš„å§“å" required>
                </div>
                
                <div class="form-group">
                    <label for="product-phone">è”ç³»ç”µè¯</label>
                    <input type="tel" id="product-phone" placeholder="æ‚¨çš„æ‰‹æœºå·ç " required>
                </div>
                
                <div class="form-group">
                    <label for="product-wechat">å¾®ä¿¡å·ï¼ˆé€‰å¡«ï¼‰</label>
                    <input type="text" id="product-wechat" placeholder="ä¾¿äºå®¢æˆ·å¾®ä¿¡è”ç³»">
                </div>
                
                <div class="form-group full-width">
                    <button type="submit">ğŸŒ¾ å‘å¸ƒå†œå‰¯äº§å“</button>
                </div>
            </form>
        </div>
        
        <div id="business" class="tab-content">
            <h2>ğŸ’¼ å•†æœºå‘å¸ƒ</h2>
            <p>å‘å¸ƒå•†ä¸šåˆä½œä¿¡æ¯ã€æ‹›å•†ä¿¡æ¯ã€æ±‚èŒæ‹›è˜ç­‰å•†ä¸šæœºä¼šã€‚</p>
            <form onsubmit="publishBusiness(event)">
                <div class="form-group">
                    <label for="business-title">å•†æœºæ ‡é¢˜</label>
                    <input type="text" id="business-title" placeholder="ä¾‹å¦‚: å¯»æ‰¾åˆä½œä¼™ä¼´ã€åº—é“ºè½¬è®©ã€è®¾å¤‡è½¬è®©" required>
                </div>
                
                <div class="form-group">
                    <label for="business-type">å•†æœºç±»å‹</label>
                    <select id="business-type" required>
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="cooperation">å•†ä¸šåˆä½œ</option>
                        <option value="investment">æŠ•èµ„æ‹›å•†</option>
                        <option value="transfer">åº—é“ºè½¬è®©</option>
                        <option value="equipment">è®¾å¤‡è½¬è®©</option>
                        <option value="recruitment">æ‹›è˜æ±‚èŒ</option>
                        <option value="procurement">é‡‡è´­éœ€æ±‚</option>
                        <option value="service">æœåŠ¡æä¾›</option>
                        <option value="other">å…¶ä»–å•†æœº</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="business-investment">æŠ•èµ„é‡‘é¢</label>
                    <select id="business-investment" required>
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="small">1ä¸‡å…ƒä»¥ä¸‹</option>
                        <option value="medium">1-5ä¸‡å…ƒ</option>
                        <option value="large">5-10ä¸‡å…ƒ</option>
                        <option value="xlarge">10ä¸‡å…ƒä»¥ä¸Š</option>
                        <option value="negotiable">é¢è®®</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="business-location">æ‰€åœ¨åœ°åŒº</label>
                    <input type="text" id="business-location" placeholder="ä¾‹å¦‚: æŸæŸä¹¡é•‡ã€æŸæŸå¿åŸ" required>
                </div>
                
                <div class="form-group">
                    <label for="business-expiry">æœ‰æ•ˆæœŸé™</label>
                    <input type="date" id="business-expiry" required>
                </div>
                
                <div class="form-group">
                    <label for="business-urgency">ç´§æ€¥ç¨‹åº¦</label>
                    <select id="business-urgency" required>
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="urgent">ç´§æ€¥</option>
                        <option value="normal">ä¸€èˆ¬</option>
                        <option value="relaxed">ä¸æ€¥</option>
                    </select>
                </div>
                
                <div class="form-group full-width">
                    <label for="business-description">è¯¦ç»†è¯´æ˜</label>
                    <textarea id="business-description" rows="4" placeholder="è¯·è¯¦ç»†æè¿°å•†æœºå†…å®¹ã€åˆä½œæ¡ä»¶ã€å…·ä½“è¦æ±‚ç­‰ä¿¡æ¯..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="business-contact">è”ç³»äºº</label>
                    <input type="text" id="business-contact" placeholder="æ‚¨çš„å§“åæˆ–å…¬å¸åç§°" required>
                </div>
                
                <div class="form-group">
                    <label for="business-phone">è”ç³»ç”µè¯</label>
                    <input type="tel" id="business-phone" placeholder="æ‚¨çš„æ‰‹æœºå·ç " required>
                </div>
                
                <div class="form-group">
                    <label for="business-email">é‚®ç®±åœ°å€</label>
                    <input type="email" id="business-email" placeholder="ä¾¿äºå‘é€è¯¦ç»†èµ„æ–™">
                </div>
                
                <div class="form-group full-width">
                    <button type="submit">ğŸ’¼ å‘å¸ƒå•†æœºä¿¡æ¯</button>
                </div>
            </form>
        </div>
        
        <div id="my-rides" class="tab-content">
            <h2>æˆ‘çš„å‘å¸ƒ</h2>
            <p style="color: #666; margin-bottom: 20px;">æŸ¥çœ‹æ‚¨å‘å¸ƒçš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬é¡ºé£è½¦ã€å†œå‰¯äº§å“å’Œå•†æœºä¿¡æ¯</p>
            <div id="my-rides-container">
                <div class="no-rides">
                    <p style="font-size: 3rem; margin-bottom: 15px;">ğŸ“</p>
                    <p>æ‚¨è¿˜æ²¡æœ‰å‘å¸ƒè¿‡ä»»ä½•ä¿¡æ¯</p>
                </div>
            </div>
        </div>

        <div id="share" class="tab-content">
            <h2>ğŸ“± åˆ†äº«èµšå¥–åŠ±</h2>
            <p>åˆ†äº«å¹³å°åˆ°å¾®ä¿¡ç¾¤æˆ–æœ‹å‹åœˆï¼Œæ¯æ—¥å‰5æ¬¡åˆ†äº«å¯è·å¾—å¥–åŠ±ï¼</p>
            
            <div class="share-section">
                <div style="font-size: 1.2rem; margin-bottom: 20px; color: #333;">
                    <strong>ğŸŒŸ åˆ†äº«å¥–åŠ±è§„åˆ™</strong><br>
                    <span style="font-size: 0.9rem; color: #666;">
                        â€¢ åˆ†äº«åˆ°å¾®ä¿¡ç¾¤ï¼šå¥–åŠ± Â¥0.10<br>
                        â€¢ åˆ†äº«åˆ°æœ‹å‹åœˆï¼šå¥–åŠ± Â¥0.10<br>
                        â€¢ æ¯æ—¥å‰5æ¬¡åˆ†äº«æœ‰æ•ˆè®¡è´¹<br>
                        â€¢ æ¯æ—¥æœ€å¤šå¯è·å¾— Â¥0.50 å¥–åŠ±<br>
                        â€¢ è¶…è¿‡5æ¬¡ååˆ†äº«æ— å¥–åŠ±
                    </span>
                </div>
                
                <div style="margin: 20px 0;">
                    <button class="share-btn" onclick="shareToWechat()">
                        ğŸ“‹ å¤åˆ¶é“¾æ¥åˆ†äº«åˆ°å¾®ä¿¡ç¾¤
                    </button>
                    <button class="share-btn" onclick="shareToMoments()">
                        ğŸ“· åˆ†äº«åˆ°æœ‹å‹åœˆ
                    </button>
                </div>
                
                <div class="share-amount">
                    ä»Šæ—¥å·²èµšï¼šÂ¥<span id="today-share-amount">0.00</span>
                </div>
                
                <div style="font-size: 0.9rem; color: #666; margin: 10px 0;">
                    åˆ†äº«æ¬¡æ•°ï¼š<span id="today-share-count">0/5</span>ï¼ˆå‰5æ¬¡æœ‰æ•ˆï¼‰
                </div>
                
                <div class="share-status" id="share-status">
                    åˆ†äº«æˆåŠŸåå¥–åŠ±å°†è‡ªåŠ¨åˆ°è´¦
                </div>
            </div>
        </div>
    </div>
    
 

    <!-- å¯†ç éªŒè¯æ¨¡æ€æ¡† -->
    <div class="announcement-modal" id="password-modal">
        <div class="announcement-modal-content">
            <h3>ğŸ” ç®¡ç†å‘˜éªŒè¯</h3>
            <p style="margin-bottom: 15px; text-align: center; color: #666;">è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ä»¥ç¼–è¾‘å…¬å‘Š</p>
            <input type="password" class="announcement-textarea" id="password-input" placeholder="è¯·è¾“å…¥å¯†ç ..." style="min-height: auto;" onkeypress="if(event.keyCode==13) verifyPassword()">
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button onclick="hidePasswordModal()" style="background: #6c757d;">å–æ¶ˆ</button>
                <button onclick="verifyPassword()">éªŒè¯</button>
            </div>
        </div>
    </div>

    <!-- ç”¨æˆ·è®¤è¯æ¨¡æ€æ¡† -->
    <div class="auth-modal" id="auth-modal">
        <div class="auth-modal-content">
            <h3>ğŸ‘¤ ç”¨æˆ·ä¸­å¿ƒ</h3>
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="switchAuthTab('login')">ç™»å½•</div>
                <div class="auth-tab" onclick="switchAuthTab('register')">æ³¨å†Œ</div>
            </div>
            
            <!-- ç™»å½•è¡¨å• -->
            <div class="auth-form active" id="login-form">
                <div class="form-group">
                    <label for="login-username">ç”¨æˆ·å</label>
                    <input type="text" id="login-username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required>
                </div>
                <div class="form-group">
                    <label for="login-password">å¯†ç </label>
                    <input type="password" id="login-password" placeholder="è¯·è¾“å…¥å¯†ç " required>
                </div>
                <div class="form-group">
                    <button type="button" class="user-btn" onclick="login()">ç™»å½•</button>
                </div>
            </div>
            
            <!-- æ³¨å†Œè¡¨å• -->
            <div class="auth-form" id="register-form">
                <div class="form-group">
                    <label for="register-username">ç”¨æˆ·å</label>
                    <input type="text" id="register-username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required>
                </div>
                <div class="form-group">
                    <label for="register-password">å¯†ç </label>
                    <input type="password" id="register-password" placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰" required>
                </div>
                <div class="form-group">
                    <label for="register-phone">æ‰‹æœºå·</label>
                    <input type="tel" id="register-phone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" required>
                </div>
                <div class="form-group">
                    <button type="button" class="user-btn" onclick="register()">æ³¨å†Œ</button>
                </div>
            </div>
            
            <div style="margin-top: 15px; text-align: center;">
                <button class="cancel-btn" onclick="hideAuthModal()">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- ä»˜è´¹æŸ¥çœ‹æ¨¡æ€æ¡† -->
    <div class="payment-modal" id="payment-modal">
        <div class="payment-modal-content">
            <h3>ğŸ’° æŸ¥çœ‹è”ç³»æ–¹å¼</h3>
            <p>æŸ¥çœ‹è”ç³»æ–¹å¼éœ€è¦æ”¯ä»˜è´¹ç”¨</p>
            <div class="payment-price">Â¥0.20</div>
            <p style="color: #666; font-size: 0.9rem;">æ”¯ä»˜åå¯æŸ¥çœ‹å®Œæ•´ç”µè¯å·ç å¹¶ç›´æ¥æ‹¨æ‰“</p>
            
            <div style="margin: 20px 0;">
                <button class="payment-btn" onclick="simulatePayment()">ç«‹å³æ”¯ä»˜</button>
            </div>
            
            <button class="cancel-btn" onclick="hidePaymentModal()">å–æ¶ˆ</button>
        </div>
    </div>

    <!-- å…¬å‘Šç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="announcement-modal" id="announcement-modal">
        <div class="announcement-modal-content">
            <h3>ğŸ“¢ ç¼–è¾‘å…¬å‘Šå†…å®¹</h3>
            <textarea class="announcement-textarea" id="announcement-textarea" placeholder="è¯·è¾“å…¥å…¬å‘Šå†…å®¹..."></textarea>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button onclick="hideAnnouncementModal()" style="background: #6c757d;">å–æ¶ˆ</button>
                <button onclick="saveAnnouncement()">ä¿å­˜å…¬å‘Š</button>
            </div>
        </div>
    </div>

    <script>
        // åŸæœ‰çš„æœ¬åœ°å­˜å‚¨åŠ è½½å‡½æ•°ä½œä¸ºå¤‡ç”¨
        function loadFromLocalStorage() {
            try {
                var savedRides = localStorage.getItem('rides');
                var savedPassengers = localStorage.getItem('passengers');
                var savedProducts = localStorage.getItem('products');
                var savedBusinesses = localStorage.getItem('businesses');
                var savedUsers = localStorage.getItem('users');
                
                rides = savedRides ? JSON.parse(savedRides) : [];
                passengers = savedPassengers ? JSON.parse(savedPassengers) : [];
                products = savedProducts ? JSON.parse(savedProducts) : [];
                businesses = savedBusinesses ? JSON.parse(savedBusinesses) : [];
                users = savedUsers ? JSON.parse(savedUsers) : [];
                
                console.log('ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®å®Œæˆ');
            } catch (e) {
                console.error('ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®å¤±è´¥:', e);
                rides = [];
                passengers = [];
                products = [];
                businesses = [];
                users = [];
            }
        }
        
        // å½“å‰è¦æŸ¥çœ‹çš„è”ç³»æ–¹å¼
        var currentViewingRide = null;
        var currentViewingType = null;
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabId) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            var tabContents = document.querySelectorAll('.tab-content');
            for (var i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            // å–æ¶ˆæ‰€æœ‰æ ‡ç­¾çš„æ´»åŠ¨çŠ¶æ€
            var tabs = document.querySelectorAll('.tab');
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾å†…å®¹
            var targetContent = document.getElementById(tabId);
            if (targetContent) {
                targetContent.classList.add('active');
            }
            
            // è®¾ç½®é€‰ä¸­æ ‡ç­¾çš„æ´»åŠ¨çŠ¶æ€
            for (var i = 0; i < tabs.length; i++) {
                var onclick = tabs[i].getAttribute('onclick');
                if (onclick && onclick.indexOf("switchTab('" + tabId + "')") !== -1) {
                    tabs[i].classList.add('active');
                    break;
                }
            }
            
            // å¦‚æœæ˜¯é¦–é¡µæ ‡ç­¾ï¼Œåˆ·æ–°æ‰€æœ‰ä¿¡æ¯åˆ—è¡¨
            if (tabId === 'find') {
                displayAllInfo();
            }
            
            // å¦‚æœæ˜¯æˆ‘çš„å‘å¸ƒæ ‡ç­¾ï¼Œåˆ·æ–°åˆ—è¡¨
            if (tabId === 'my-rides') {
                displayMyRides();
            }
        }
        
        // æ˜¾ç¤ºäº§å“åˆ—è¡¨
        function displayProducts() {
            var productsContainer = document.getElementById('products-container');
            
            if (products.length === 0) {
                productsContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸŒ¾</p><p>æš‚æ— å†œå‰¯äº§å“ä¿¡æ¯</p></div>';
                return;
            }
            
            var html = '<h3 style="color: #28a745; margin-bottom: 15px;">ğŸŒ¾ æ‰€æœ‰å†œå‰¯äº§å“ï¼ˆå…± ' + products.length + ' æ¡ï¼‰</h3>';
            for (var i = 0; i < products.length; i++) {
                var product = products[i];
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: #28a745; margin: 0;">' + product.name + '</h3>';
                html += '</div>';
                
                if (product.category) {
                    html += '<p><strong>ç±»åˆ«ï¼š</strong>' + product.category + '</p>';
                }
                
                if (product.quantity) {
                    html += '<p><strong>æ•°é‡ï¼š</strong>' + product.quantity + '</p>';
                }
                
                if (product.price) {
                    html += '<p><strong>ä»·æ ¼ï¼š</strong>' + product.price + '</p>';
                }
                
                if (product.location) {
                    html += '<p><strong>äº§åœ°ï¼š</strong>' + product.location + '</p>';
                }
                
                if (product.harvest) {
                    html += '<p><strong>é‡‡æ”¶æ—¶é—´ï¼š</strong>' + product.harvest + '</p>';
                }
                
                if (product.quality) {
                    html += '<p><strong>å“è´¨ç­‰çº§ï¼š</strong>' + product.quality + '</p>';
                }
                
                if (product.description) {
                    html += '<p><strong>æè¿°ï¼š</strong>' + product.description + '</p>';
                }
                
                if (product.contact && product.phone) {
                    html += '<p><strong>è”ç³»äººï¼š</strong>' + product.contact + ' (' + formatProductPhone(product, i) + ')</p>';
                }
                
                if (product.wechat) {
                    html += '<p><strong>å¾®ä¿¡ï¼š</strong>' + product.wechat + '</p>';
                }
                
                if (product.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + product.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            productsContainer.innerHTML = html;
        }
        
        // æ˜¾ç¤ºå•†æœºåˆ—è¡¨
        function displayBusinesses() {
            var businessesContainer = document.getElementById('businesses-container');
            
            if (businesses.length === 0) {
                businessesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸ’¼</p><p>æš‚æ— å•†æœºä¿¡æ¯</p></div>';
                return;
            }
            
            var html = '<h3 style="color: #007bff; margin-bottom: 15px;">ğŸ’¼ æ‰€æœ‰å•†æœºä¿¡æ¯ï¼ˆå…± ' + businesses.length + ' æ¡ï¼‰</h3>';
            for (var i = 0; i < businesses.length; i++) {
                var business = businesses[i];
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: #007bff; margin: 0;">' + business.title + '</h3>';
                html += '</div>';
                
                if (business.type) {
                    html += '<p><strong>ç±»å‹ï¼š</strong>' + business.type + '</p>';
                }
                
                if (business.investment) {
                    html += '<p><strong>æŠ•èµ„é‡‘é¢ï¼š</strong>' + business.investment + '</p>';
                }
                
                if (business.location) {
                    html += '<p><strong>åœ°åŒºï¼š</strong>' + business.location + '</p>';
                }
                
                if (business.expiry) {
                    html += '<p><strong>æœ‰æ•ˆæœŸï¼š</strong>' + business.expiry + '</p>';
                }
                
                if (business.urgency) {
                    html += '<p><strong>ç´§æ€¥ç¨‹åº¦ï¼š</strong>' + business.urgency + '</p>';
                }
                
                if (business.description) {
                    html += '<p><strong>è¯´æ˜ï¼š</strong>' + business.description + '</p>';
                }
                
                if (business.contact && business.phone) {
                    html += '<p><strong>è”ç³»äººï¼š</strong>' + business.contact + ' (' + formatBusinessPhone(business, i) + ')</p>';
                }
                
                if (business.email) {
                    html += '<p><strong>é‚®ç®±åœ°å€ï¼š</strong>' + business.email + '</p>';
                }
                
                if (business.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + business.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            businessesContainer.innerHTML = html;
        }
        
        // æ˜¾ç¤ºè¡Œç¨‹åˆ—è¡¨
        function displayRides() {
            var ridesContainer = document.getElementById('rides-container');
            
            // åˆå¹¶æ‰€æœ‰è¡Œç¨‹æ•°æ®
            var allRides = [];
            if (rides.length > 0) {
                allRides = allRides.concat(rides);
            }
            if (passengers.length > 0) {
                allRides = allRides.concat(passengers);
            }
            
            if (allRides.length === 0) {
                ridesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸš—</p><p>æš‚æ— å¯ç”¨è¡Œç¨‹ï¼Œè¯·ç¨åå†è¯•æˆ–å‘å¸ƒæ‚¨çš„è¡Œç¨‹</p></div>';
                return;
            }
            
            // æ˜¾ç¤ºæ‰€æœ‰è¡Œç¨‹
            var html = '<h3 style="color: #ff5100; margin-bottom: 15px;">ğŸš— æ‰€æœ‰å¯ç”¨è¡Œç¨‹ï¼ˆå…± ' + allRides.length + ' æ¡ï¼‰</h3>';
            for (var i = 0; i < allRides.length; i++) {
                var ride = allRides[i];
                var typeIcon = ride.type === 'car-find-passenger' ? 'ğŸš—' : 'ğŸš¶';
                var typeName = ride.type === 'car-find-passenger' ? 'è½¦æ‰¾äºº' : 'äººæ‰¾è½¦';
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: #ff5100; margin: 0;">' + typeIcon + ' ' + typeName + '</h3>';
                html += '</div>';
                
                if (ride.departure && ride.destination) {
                    html += '<p><strong>è·¯çº¿ï¼š</strong>' + ride.departure + ' â†’ ' + ride.destination + '</p>';
                }
                
                if (ride.date && ride.time) {
                    html += '<p><strong>æ—¶é—´ï¼š</strong>' + ride.date + ' ' + ride.time + '</p>';
                }
                
                if (ride.seats) {
                    html += '<p><strong>åº§ä½ï¼š</strong>' + ride.seats + 'ä¸ª</p>';
                }
                
                if (ride.count) {
                    html += '<p><strong>äººæ•°ï¼š</strong>' + ride.count + 'äºº</p>';
                }
                
                if (ride.price) {
                    html += '<p><strong>è´¹ç”¨ï¼š</strong>' + ride.price + 'å…ƒ</p>';
                }
                
                if (ride.budget) {
                    html += '<p><strong>é¢„ç®—ï¼š</strong>' + ride.budget + 'å…ƒ</p>';
                }
                
                if (ride.name && ride.phone) {
                    // åœ¨"æˆ‘çš„è¡Œç¨‹"ä¸­æ˜¾ç¤ºå®Œæ•´å·ç ï¼Œå› ä¸ºæ˜¯è‡ªå·±å‘å¸ƒçš„
                    var isOwnRide = currentUser && ride.publisher === currentUser.username;
                    if (isOwnRide) {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + ride.name + ' (' + ride.phone + ')</p>';
                    } else {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + ride.name + ' (' + formatPhone(ride, i, 'my') + ')</p>';
                    }
                }
                
                if (ride.notes) {
                    html += '<p><strong>å¤‡æ³¨ï¼š</strong>' + ride.notes + '</p>';
                }
                
                if (ride.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + ride.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            ridesContainer.innerHTML = html;
        }
        
        // æ˜¾ç¤ºæˆ‘çš„è¡Œç¨‹
        function displayMyRides() {
            var myRidesContainer = document.getElementById('my-rides-container');
            
            if (!currentUser) {
                myRidesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸ”’</p><p>è¯·å…ˆç™»å½•æŸ¥çœ‹æ‚¨çš„å‘å¸ƒä¿¡æ¯</p></div>';
                return;
            }
            
            // è·å–å½“å‰ç”¨æˆ·å‘å¸ƒçš„æ‰€æœ‰ä¿¡æ¯
            var myRides = rides.filter(ride => ride.publisher === currentUser.username);
            var myPassengers = passengers.filter(passenger => passenger.publisher === currentUser.username);
            var myProducts = products.filter(product => product.publisher === currentUser.username);
            var myBusinesses = businesses.filter(business => business.publisher === currentUser.username);
            
            // åˆå¹¶æ‰€æœ‰ä¿¡æ¯
            var allMyInfo = [];
            allMyInfo = allMyInfo.concat(myRides.map(r => ({...r, type: 'è½¦æ‰¾äºº', icon: 'ğŸš—', color: '#ff5100'})));
            allMyInfo = allMyInfo.concat(myPassengers.map(p => ({...p, type: 'äººæ‰¾è½¦', icon: 'ğŸš¶', color: '#ff5100'})));
            allMyInfo = allMyInfo.concat(myProducts.map(p => ({...p, type: 'å†œå‰¯äº§å“', icon: 'ğŸŒ¾', color: '#28a745'})));
            allMyInfo = allMyInfo.concat(myBusinesses.map(b => ({...b, type: 'å•†æœºä¿¡æ¯', icon: 'ğŸ’¼', color: '#007bff'})));
            
            if (allMyInfo.length === 0) {
                myRidesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸ“</p><p>æ‚¨è¿˜æ²¡æœ‰å‘å¸ƒè¿‡ä»»ä½•ä¿¡æ¯</p></div>';
                return;
            }
            
            var html = '<h3 style="color: #ff5100; margin-bottom: 20px;">ğŸ“‹ æˆ‘çš„å‘å¸ƒä¿¡æ¯ï¼ˆå…± ' + allMyInfo.length + ' æ¡ï¼‰</h3>';
            
            for (var i = 0; i < allMyInfo.length; i++) {
                var info = allMyInfo[i];
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: ' + info.color + '; margin: 0;">' + info.icon + ' ' + info.type;
                
                if (info.departure && info.destination) {
                    html += ' - ' + info.departure + ' â†’ ' + info.destination;
                } else if (info.name) {
                    html += ' - ' + info.name;
                } else if (info.title) {
                    html += ' - ' + info.title;
                }
                
                html += '</h3>';
                html += '<button onclick="deleteMyInfo(\'' + info.type + '\', \'' + info.id + '\')" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 0.8rem;">åˆ é™¤</button>';
                html += '</div>';
                
                // æ ¹æ®ç±»å‹æ˜¾ç¤ºä¸åŒçš„ä¿¡æ¯
                if (info.type === 'è½¦æ‰¾äºº' || info.type === 'äººæ‰¾è½¦') {
                    if (info.date && info.time) {
                        html += '<p><strong>æ—¶é—´ï¼š</strong>' + info.date + ' ' + info.time + '</p>';
                    }
                    if (info.seats) {
                        html += '<p><strong>åº§ä½ï¼š</strong>' + info.seats + 'ä¸ª</p>';
                    }
                    if (info.count) {
                        html += '<p><strong>äººæ•°ï¼š</strong>' + info.count + 'äºº</p>';
                    }
                    if (info.price) {
                        html += '<p><strong>è´¹ç”¨ï¼š</strong>' + info.price + 'å…ƒ</p>';
                    }
                    if (info.budget) {
                        html += '<p><strong>é¢„ç®—ï¼š</strong>' + info.budget + 'å…ƒ</p>';
                    }
                    if (info.notes) {
                        html += '<p><strong>å¤‡æ³¨ï¼š</strong>' + info.notes + '</p>';
                    }
                } else if (info.type === 'å†œå‰¯äº§å“') {
                    if (info.category) {
                        html += '<p><strong>ç±»åˆ«ï¼š</strong>' + info.category + '</p>';
                    }
                    if (info.quantity) {
                        html += '<p><strong>æ•°é‡ï¼š</strong>' + info.quantity + '</p>';
                    }
                    if (info.price) {
                        html += '<p><strong>ä»·æ ¼ï¼š</strong>' + info.price + '</p>';
                    }
                    if (info.location) {
                        html += '<p><strong>äº§åœ°ï¼š</strong>' + info.location + '</p>';
                    }
                    if (info.harvest) {
                        html += '<p><strong>é‡‡æ”¶æ—¶é—´ï¼š</strong>' + info.harvest + '</p>';
                    }
                    if (info.quality) {
                        html += '<p><strong>å“è´¨ç­‰çº§ï¼š</strong>' + info.quality + '</p>';
                    }
                    if (info.description) {
                        html += '<p><strong>æè¿°ï¼š</strong>' + info.description + '</p>';
                    }
                } else if (info.type === 'å•†æœºä¿¡æ¯') {
                    if (info.businessType) {
                        html += '<p><strong>ç±»å‹ï¼š</strong>' + info.businessType + '</p>';
                    }
                    if (info.investment) {
                        html += '<p><strong>æŠ•èµ„é‡‘é¢ï¼š</strong>' + info.investment + '</p>';
                    }
                    if (info.location) {
                        html += '<p><strong>åœ°åŒºï¼š</strong>' + info.location + '</p>';
                    }
                    if (info.expiry) {
                        html += '<p><strong>æœ‰æ•ˆæœŸï¼š</strong>' + info.expiry + '</p>';
                    }
                    if (info.urgency) {
                        html += '<p><strong>ç´§æ€¥ç¨‹åº¦ï¼š</strong>' + info.urgency + '</p>';
                    }
                    if (info.description) {
                        html += '<p><strong>è¯´æ˜ï¼š</strong>' + info.description + '</p>';
                    }
                }
                
                if (info.contact && info.phone) {
                    html += '<p><strong>è”ç³»äººï¼š</strong>' + info.contact + ' (' + info.phone + ')</p>';
                }
                
                if (info.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + info.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            myRidesContainer.innerHTML = html;
        }
        
        // åˆ é™¤æˆ‘çš„ä¿¡æ¯
        function deleteMyInfo(type, id) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡ä¿¡æ¯å—ï¼Ÿ')) {
                return;
            }
            
            // æ ¹æ®ç±»å‹åˆ é™¤å¯¹åº”çš„æ•°æ®
            if (type === 'è½¦æ‰¾äºº') {
                rides = rides.filter(ride => ride.id !== id);
                localStorage.setItem('rides', JSON.stringify(rides));
            } else if (type === 'äººæ‰¾è½¦') {
                passengers = passengers.filter(passenger => passenger.id !== id);
                localStorage.setItem('passengers', JSON.stringify(passengers));
            } else if (type === 'å†œå‰¯äº§å“') {
                products = products.filter(product => product.id !== id);
                localStorage.setItem('products', JSON.stringify(products));
            } else if (type === 'å•†æœºä¿¡æ¯') {
                businesses = businesses.filter(business => business.id !== id);
                localStorage.setItem('businesses', JSON.stringify(businesses));
            }
            
            // åˆ·æ–°æ˜¾ç¤º
            displayMyRides();
            displayAllInfo();
            
            alert('åˆ é™¤æˆåŠŸï¼');
        }
        
        // æ˜¾ç¤ºäº§å“åˆ—è¡¨
        function displayProducts() {
            var productsContainer = document.getElementById('products-container');
            
            if (products.length === 0) {
                productsContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸŒ¾</p><p>æš‚æ— å†œå‰¯äº§å“ä¿¡æ¯</p></div>';
                return;
            }
            
            var html = '<h3 style="color: #28a745; margin-bottom: 15px;">ğŸŒ¾ æ‰€æœ‰å†œå‰¯äº§å“ï¼ˆå…± ' + products.length + ' æ¡ï¼‰</h3>';
            for (var i = 0; i < products.length; i++) {
                var product = products[i];
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: #28a745; margin: 0;">' + product.name + '</h3>';
                html += '</div>';
                
                if (product.category) {
                    html += '<p><strong>ç±»åˆ«ï¼š</strong>' + product.category + '</p>';
                }
                
                if (product.quantity) {
                    html += '<p><strong>æ•°é‡ï¼š</strong>' + product.quantity + '</p>';
                }
                
                if (product.price) {
                    html += '<p><strong>ä»·æ ¼ï¼š</strong>' + product.price + '</p>';
                }
                
                if (product.location) {
                    html += '<p><strong>äº§åœ°ï¼š</strong>' + product.location + '</p>';
                }
                
                if (product.harvest) {
                    html += '<p><strong>é‡‡æ”¶æ—¶é—´ï¼š</strong>' + product.harvest + '</p>';
                }
                
                if (product.quality) {
                    html += '<p><strong>å“è´¨ç­‰çº§ï¼š</strong>' + product.quality + '</p>';
                }
                
                if (product.description) {
                    html += '<p><strong>æè¿°ï¼š</strong>' + product.description + '</p>';
                }
                
                if (product.contact && product.phone) {
                    html += '<p><strong>è”ç³»äººï¼š</strong>' + product.contact + ' (' + formatProductPhone(product, i) + ')</p>';
                }
                
                if (product.wechat) {
                    html += '<p><strong>å¾®ä¿¡ï¼š</strong>' + product.wechat + '</p>';
                }
                
                if (product.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + product.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            productsContainer.innerHTML = html;
        }
        
        // æ˜¾ç¤ºå•†æœºåˆ—è¡¨
        function displayBusinesses() {
            var businessesContainer = document.getElementById('businesses-container');
            
            if (businesses.length === 0) {
                businessesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸ’¼</p><p>æš‚æ— å•†æœºä¿¡æ¯</p></div>';
                return;
            }
            
            var html = '<h3 style="color: #007bff; margin-bottom: 15px;">ğŸ’¼ æ‰€æœ‰å•†æœºä¿¡æ¯ï¼ˆå…± ' + businesses.length + ' æ¡ï¼‰</h3>';
            for (var i = 0; i < businesses.length; i++) {
                var business = businesses[i];
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: #007bff; margin: 0;">' + business.title + '</h3>';
                html += '</div>';
                
                if (business.type) {
                    html += '<p><strong>ç±»å‹ï¼š</strong>' + business.type + '</p>';
                }
                
                if (business.investment) {
                    html += '<p><strong>æŠ•èµ„é‡‘é¢ï¼š</strong>' + business.investment + '</p>';
                }
                
                if (business.location) {
                    html += '<p><strong>åœ°åŒºï¼š</strong>' + business.location + '</p>';
                }
                
                if (business.expiry) {
                    html += '<p><strong>æœ‰æ•ˆæœŸï¼š</strong>' + business.expiry + '</p>';
                }
                
                if (business.urgency) {
                    html += '<p><strong>ç´§æ€¥ç¨‹åº¦ï¼š</strong>' + business.urgency + '</p>';
                }
                
                if (business.description) {
                    html += '<p><strong>è¯´æ˜ï¼š</strong>' + business.description + '</p>';
                }
                
                if (business.contact && business.phone) {
                    html += '<p><strong>è”ç³»äººï¼š</strong>' + business.contact + ' (' + formatBusinessPhone(business, i) + ')</p>';
                }
                
                if (business.email) {
                    html += '<p><strong>é‚®ç®±åœ°å€ï¼š</strong>' + business.email + '</p>';
                }
                
                if (business.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + business.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            businessesContainer.innerHTML = html;
        }
        
        // æ˜¾ç¤ºè¡Œç¨‹åˆ—è¡¨
        function displayRides() {
            var ridesContainer = document.getElementById('rides-container');
            
            // åˆå¹¶æ‰€æœ‰è¡Œç¨‹æ•°æ®
            var allRides = [];
            if (rides.length > 0) {
                allRides = allRides.concat(rides);
            }
            if (passengers.length > 0) {
                allRides = allRides.concat(passengers);
            }
            
            if (allRides.length === 0) {
                ridesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸš—</p><p>æš‚æ— å¯ç”¨è¡Œç¨‹ï¼Œè¯·ç¨åå†è¯•æˆ–å‘å¸ƒæ‚¨çš„è¡Œç¨‹</p></div>';
                return;
            }
            
            // æ˜¾ç¤ºæ‰€æœ‰è¡Œç¨‹
            var html = '<h3 style="color: #ff5100; margin-bottom: 15px;">ğŸš— æ‰€æœ‰å¯ç”¨è¡Œç¨‹ï¼ˆå…± ' + allRides.length + ' æ¡ï¼‰</h3>';
            for (var i = 0; i < allRides.length; i++) {
                var ride = allRides[i];
                var typeIcon = ride.type === 'car-find-passenger' ? 'ğŸš—' : 'ğŸš¶';
                var typeName = ride.type === 'car-find-passenger' ? 'è½¦æ‰¾äºº' : 'äººæ‰¾è½¦';
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: #ff5100; margin: 0;">' + typeIcon + ' ' + typeName + '</h3>';
                html += '</div>';
                
                if (ride.departure && ride.destination) {
                    html += '<p><strong>è·¯çº¿ï¼š</strong>' + ride.departure + ' â†’ ' + ride.destination + '</p>';
                }
                
                if (ride.date && ride.time) {
                    html += '<p><strong>æ—¶é—´ï¼š</strong>' + ride.date + ' ' + ride.time + '</p>';
                }
                
                if (ride.seats) {
                    html += '<p><strong>åº§ä½ï¼š</strong>' + ride.seats + 'ä¸ª</p>';
                }
                
                if (ride.count) {
                    html += '<p><strong>äººæ•°ï¼š</strong>' + ride.count + 'äºº</p>';
                }
                
                if (ride.price) {
                    html += '<p><strong>è´¹ç”¨ï¼š</strong>' + ride.price + 'å…ƒ</p>';
                }
                
                if (ride.budget) {
                    html += '<p><strong>é¢„ç®—ï¼š</strong>' + ride.budget + 'å…ƒ</p>';
                }
                
                if (ride.name && ride.phone) {
                    // åœ¨"æˆ‘çš„è¡Œç¨‹"ä¸­æ˜¾ç¤ºå®Œæ•´å·ç ï¼Œå› ä¸ºæ˜¯è‡ªå·±å‘å¸ƒçš„
                    var isOwnRide = currentUser && ride.publisher === currentUser.username;
                    if (isOwnRide) {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + ride.name + ' (' + ride.phone + ')</p>';
                    } else {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + ride.name + ' (' + formatPhone(ride, i, 'my') + ')</p>';
                    }
                }
                
                if (ride.notes) {
                    html += '<p><strong>å¤‡æ³¨ï¼š</strong>' + ride.notes + '</p>';
                }
                
                if (ride.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + ride.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            ridesContainer.innerHTML = html;
        }
        
        // æ˜¾ç¤ºæˆ‘çš„è¡Œç¨‹
        function displayMyRides() {
            var myRidesContainer = document.getElementById('my-rides-container');
            
            if (!currentUser) {
                myRidesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸ”’</p><p>è¯·å…ˆç™»å½•æŸ¥çœ‹æ‚¨çš„å‘å¸ƒä¿¡æ¯</p></div>';
                return;
            }
            
            // è·å–å½“å‰ç”¨æˆ·å‘å¸ƒçš„æ‰€æœ‰ä¿¡æ¯
            var myRides = rides.filter(ride => ride.publisher === currentUser.username);
            var myPassengers = passengers.filter(passenger => passenger.publisher === currentUser.username);
            var myProducts = products.filter(product => product.publisher === currentUser.username);
            var myBusinesses = businesses.filter(business => business.publisher === currentUser.username);
            
            // åˆå¹¶æ‰€æœ‰ä¿¡æ¯
            var allMyInfo = [];
            allMyInfo = allMyInfo.concat(myRides.map(r => ({...r, type: 'è½¦æ‰¾äºº', icon: 'ğŸš—', color: '#ff5100'})));
            allMyInfo = allMyInfo.concat(myPassengers.map(p => ({...p, type: 'äººæ‰¾è½¦', icon: 'ğŸš¶', color: '#ff5100'})));
            allMyInfo = allMyInfo.concat(myProducts.map(p => ({...p, type: 'å†œå‰¯äº§å“', icon: 'ğŸŒ¾', color: '#28a745'})));
            allMyInfo = allMyInfo.concat(myBusinesses.map(b => ({...b, type: 'å•†æœºä¿¡æ¯', icon: 'ğŸ’¼', color: '#007bff'})));
            
            if (allMyInfo.length === 0) {
                myRidesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸ“</p><p>æ‚¨è¿˜æ²¡æœ‰å‘å¸ƒè¿‡ä»»ä½•ä¿¡æ¯</p></div>';
                return;
            }
            
            var html = '<h3 style="color: #ff5100; margin-bottom: 20px;">ğŸ“‹ æˆ‘çš„å‘å¸ƒä¿¡æ¯ï¼ˆå…± ' + allMyInfo.length + ' æ¡ï¼‰</h3>';
            
            for (var i = 0; i < allMyInfo.length; i++) {
                var info = allMyInfo[i];
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: ' + info.color + '; margin: 0;">' + info.icon + ' ' + info.type;
                
                if (info.departure && info.destination) {
                    html += ' - ' + info.departure + ' â†’ ' + info.destination;
                } else if (info.name) {
                    html += ' - ' + info.name;
                } else if (info.title) {
                    html += ' - ' + info.title;
                }
                
                html += '</h3>';
                html += '<button onclick="deleteMyInfo(\'' + info.type + '\', \'' + info.id + '\')" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 0.8rem;">åˆ é™¤</button>';
                html += '</div>';
                
                // æ ¹æ®ç±»å‹æ˜¾ç¤ºä¸åŒçš„ä¿¡æ¯
                if (info.type === 'è½¦æ‰¾äºº' || info.type === 'äººæ‰¾è½¦') {
                    if (info.date && info.time) {
                        html += '<p><strong>æ—¶é—´ï¼š</strong>' + info.date + ' ' + info.time + '</p>';
                    }
                    if (info.seats) {
                        html += '<p><strong>åº§ä½ï¼š</strong>' + info.seats + 'ä¸ª</p>';
                    }
                    if (info.count) {
                        html += '<p><strong>äººæ•°ï¼š</strong>' + info.count + 'äºº</p>';
                    }
                    if (info.price) {
                        html += '<p><strong>è´¹ç”¨ï¼š</strong>' + info.price + 'å…ƒ</p>';
                    }
                    if (info.budget) {
                        html += '<p><strong>é¢„ç®—ï¼š</strong>' + info.budget + 'å…ƒ</p>';
                    }
                    if (info.notes) {
                        html += '<p><strong>å¤‡æ³¨ï¼š</strong>' + info.notes + '</p>';
                    }
                } else if (info.type === 'å†œå‰¯äº§å“') {
                    if (info.category) {
                        html += '<p><strong>ç±»åˆ«ï¼š</strong>' + info.category + '</p>';
                    }
                    if (info.quantity) {
                        html += '<p><strong>æ•°é‡ï¼š</strong>' + info.quantity + '</p>';
                    }
                    if (info.price) {
                        html += '<p><strong>ä»·æ ¼ï¼š</strong>' + info.price + '</p>';
                    }
                    if (info.location) {
                        html += '<p><strong>äº§åœ°ï¼š</strong>' + info.location + '</p>';
                    }
                    if (info.harvest) {
                        html += '<p><strong>é‡‡æ”¶æ—¶é—´ï¼š</strong>' + info.harvest + '</p>';
                    }
                    if (info.quality) {
                        html += '<p><strong>å“è´¨ç­‰çº§ï¼š</strong>' + info.quality + '</p>';
                    }
                    if (info.description) {
                        html += '<p><strong>æè¿°ï¼š</strong>' + info.description + '</p>';
                    }
                } else if (info.type === 'å•†æœºä¿¡æ¯') {
                    if (info.businessType) {
                        html += '<p><strong>ç±»å‹ï¼š</strong>' + info.businessType + '</p>';
                    }
                    if (info.investment) {
                        html += '<p><strong>æŠ•èµ„é‡‘é¢ï¼š</strong>' + info.investment + '</p>';
                    }
                    if (info.location) {
                        html += '<p><strong>åœ°åŒºï¼š</strong>' + info.location + '</p>';
                    }
                    if (info.expiry) {
                        html += '<p><strong>æœ‰æ•ˆæœŸï¼š</strong>' + info.expiry + '</p>';
                    }
                    if (info.urgency) {
                        html += '<p><strong>ç´§æ€¥ç¨‹åº¦ï¼š</strong>' + info.urgency + '</p>';
                    }
                    if (info.description) {
                        html += '<p><strong>è¯´æ˜ï¼š</strong>' + info.description + '</p>';
                    }
                }
                
                if (info.contact && info.phone) {
                    html += '<p><strong>è”ç³»äººï¼š</strong>' + info.contact + ' (' + info.phone + ')</p>';
                }
                
                if (info.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + info.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            myRidesContainer.innerHTML = html;
        }
        
        // åˆ é™¤æˆ‘çš„ä¿¡æ¯
        function deleteMyInfo(type, id) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡ä¿¡æ¯å—ï¼Ÿ')) {
                return;
            }
            
            // æ ¹æ®ç±»å‹åˆ é™¤å¯¹åº”çš„æ•°æ®
            if (type === 'è½¦æ‰¾äºº') {
                rides = rides.filter(ride => ride.id !== id);
                localStorage.setItem('rides', JSON.stringify(rides));
            } else if (type === 'äººæ‰¾è½¦') {
                passengers = passengers.filter(passenger => passenger.id !== id);
                localStorage.setItem('passengers', JSON.stringify(passengers));
            } else if (type === 'å†œå‰¯äº§å“') {
                products = products.filter(product => product.id !== id);
                localStorage.setItem('products', JSON.stringify(products));
            } else if (type === 'å•†æœºä¿¡æ¯') {
                businesses = businesses.filter(business => business.id !== id);
                localStorage.setItem('businesses', JSON.stringify(businesses));
            }
            
            // åˆ·æ–°æ˜¾ç¤º
            displayMyRides();
            displayAllInfo();
            
            alert('åˆ é™¤æˆåŠŸï¼');
        }
        
        // å‘å¸ƒè½¦æ‰¾äººä¿¡æ¯
        async function publishRide(event) {
            event.preventDefault();
            
            // æ£€æŸ¥ç”¨æˆ·æƒé™
            if (!currentUser) {
                alert('ğŸ”’ è¯·å…ˆç™»å½•åå†å‘å¸ƒè¡Œç¨‹ä¿¡æ¯ï¼');
                showAuthModal();
                return;
            }
            
            // è·å–è¡¨å•æ•°æ®
            var rideData = {
                type: 'car-find-passenger',
                departure: document.getElementById('departure').value,
                destination: document.getElementById('destination').value,
                date: document.getElementById('date').value,
                time: document.getElementById('time').value,
                seats: document.getElementById('seats').value,
                price: document.getElementById('price').value,
                notes: document.getElementById('notes').value,
                name: document.getElementById('name').value,
                phone: document.getElementById('phone').value,
                publishTime: new Date().toLocaleString(),
                publisher: currentUser.username,
                userId: currentUser.id || currentUser.username
            };
            
            try {
                // ä½¿ç”¨Firebaseæ•°æ®åº“ä¿å­˜
                await databaseService.saveData('rides', rideData);
                alert('ğŸš— è½¦æ‰¾äººä¿¡æ¯å‘å¸ƒæˆåŠŸï¼');
                
                // æ¸…ç©ºè¡¨å•
                event.target.reset();
                
                // åˆ·æ–°æ˜¾ç¤º
                await displayMyRides();
                await displayAllInfo();
            } catch (error) {
                console.error('å‘å¸ƒå¤±è´¥:', error);
                alert('å‘å¸ƒå¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
            }
        }
        
        // å‘å¸ƒäººæ‰¾è½¦ä¿¡æ¯
        function publishPassenger(event) {
            event.preventDefault();
            
            // æ£€æŸ¥ç”¨æˆ·æƒé™
            if (!currentUser) {
                alert('ğŸ”’ è¯·å…ˆç™»å½•åå†å‘å¸ƒè¡Œç¨‹ä¿¡æ¯ï¼');
                showAuthModal();
                return;
            }
            
            // è·å–è¡¨å•æ•°æ®
            var passengerData = {
                type: 'passenger-find-car',
                departure: document.getElementById('passenger-departure').value,
                destination: document.getElementById('passenger-destination').value,
                date: document.getElementById('passenger-date').value,
                time: document.getElementById('passenger-time').value,
                count: document.getElementById('passenger-count').value,
                budget: document.getElementById('passenger-budget').value,
                notes: document.getElementById('passenger-notes').value,
                name: document.getElementById('passenger-name').value,
                phone: document.getElementById('passenger-phone').value,
                publishTime: new Date().toLocaleString(),
                publisher: currentUser.username
            };
            
            // ä¿å­˜æ•°æ®
            passengers.push(passengerData);
            try {
                localStorage.setItem('passengers', JSON.stringify(passengers));
                console.log('äººæ‰¾è½¦ä¿¡æ¯å·²ä¿å­˜ï¼Œå½“å‰æ€»æ•°ï¼š' + passengers.length);
            } catch (e) {
                console.error('ä¿å­˜äººæ‰¾è½¦ä¿¡æ¯å¤±è´¥:', e);
                alert('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
                return;
            }
            
            alert('ğŸš¶ äººæ‰¾è½¦ä¿¡æ¯å‘å¸ƒæˆåŠŸï¼');
            
            // æ¸…ç©ºè¡¨å•
            event.target.reset();
            
            // åˆ·æ–°æ˜¾ç¤º
            displayMyRides();
            displayAllInfo();
        }
        
        // å‘å¸ƒå†œå‰¯äº§å“
        async function publishProduct(event) {
            event.preventDefault();
            
            // æ£€æŸ¥ç”¨æˆ·æƒé™
            if (!currentUser) {
                alert('ğŸ”’ è¯·å…ˆç™»å½•åå†å‘å¸ƒäº§å“ä¿¡æ¯ï¼');
                showAuthModal();
                return;
            }
            
            // è·å–è¡¨å•æ•°æ®
            var productData = {
                name: document.getElementById('product-name').value,
                category: document.getElementById('product-category').value,
                quantity: document.getElementById('product-quantity').value,
                price: document.getElementById('product-price').value,
                location: document.getElementById('product-location').value,
                harvest: document.getElementById('product-harvest').value,
                quality: document.getElementById('product-quality').value,
                description: document.getElementById('product-description').value,
                contact: document.getElementById('product-contact').value,
                phone: document.getElementById('product-phone').value,
                wechat: document.getElementById('product-wechat').value,
                publishTime: new Date().toLocaleString(),
                publisher: currentUser.username,
                userId: currentUser.id || currentUser.username
            };
            
            try {
                // ä½¿ç”¨Firebaseæ•°æ®åº“ä¿å­˜
                await databaseService.saveData('products', productData);
                alert('ğŸŒ¾ å†œå‰¯äº§å“å‘å¸ƒæˆåŠŸï¼');
                
                // æ¸…ç©ºè¡¨å•
                event.target.reset();
                
                // åˆ·æ–°æ˜¾ç¤º
                await displayAllInfo();
            } catch (error) {
                console.error('å‘å¸ƒå¤±è´¥:', error);
                alert('å‘å¸ƒå¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
            }
        }
        
        // å‘å¸ƒå•†æœºä¿¡æ¯
        function publishBusiness(event) {
            event.preventDefault();
            
            // è·å–è¡¨å•æ•°æ®
            var businessData = {
                title: document.getElementById('business-title').value,
                type: document.getElementById('business-type').value,
                investment: document.getElementById('business-investment').value,
                location: document.getElementById('business-location').value,
                expiry: document.getElementById('business-expiry').value,
                urgency: document.getElementById('business-urgency').value,
                description: document.getElementById('business-description').value,
                contact: document.getElementById('business-contact').value,
                phone: document.getElementById('business-phone').value,
                email: document.getElementById('business-email').value,
                publishTime: new Date().toLocaleString()
            };
            
            // ä¿å­˜æ•°æ®
            businesses.push(businessData);
            try {
                localStorage.setItem('businesses', JSON.stringify(businesses));
                console.log('å•†æœºä¿¡æ¯å·²ä¿å­˜ï¼Œå½“å‰æ€»æ•°ï¼š' + businesses.length);
            } catch (e) {
                console.error('ä¿å­˜å•†æœºä¿¡æ¯å¤±è´¥:', e);
                alert('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
                return;
            }
            
            alert('ğŸ’¼ å•†æœºä¿¡æ¯å‘å¸ƒæˆåŠŸï¼ä¿¡æ¯å·²ä¿å­˜åˆ°ç³»ç»Ÿã€‚');
            
            // æ¸…ç©ºè¡¨å•
            event.target.reset();
            
            // åˆ·æ–°é¦–é¡µæ˜¾ç¤º
            displayAllInfo();
        }
        
        // æœç´¢è¡Œç¨‹
        function searchRides() {
            var searchTerm = document.getElementById('search-input').value.toLowerCase();
            var ridesContainer = document.getElementById('rides-container');
            
            if (!searchTerm) {
                displayRides();
                return;
            }
            
            // åˆå¹¶æ‰€æœ‰è¡Œç¨‹æ•°æ®
            var allRides = [];
            if (rides.length > 0) {
                allRides = allRides.concat(rides);
            }
            if (passengers.length > 0) {
                allRides = allRides.concat(passengers);
            }
            
            // æœç´¢åŒ¹é…çš„è¡Œç¨‹
            var searchResults = [];
            for (var i = 0; i < allRides.length; i++) {
                var ride = allRides[i];
                var searchIn = [
                    ride.departure || '',
                    ride.destination || '',
                    ride.name || '',
                    ride.phone || '',
                    ride.notes || ''
                ].join(' ').toLowerCase();
                
                if (searchIn.indexOf(searchTerm) !== -1) {
                    searchResults.push(ride);
                }
            }
            
            // æ˜¾ç¤ºæœç´¢ç»“æœ
            if (searchResults.length === 0) {
                ridesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸ”</p><p>æœªæ‰¾åˆ°åŒ¹é…çš„è¡Œç¨‹ï¼Œè¯·å°è¯•å…¶ä»–å…³é”®è¯</p></div>';
                return;
            }
            
            // ç”Ÿæˆæœç´¢ç»“æœHTML
            var html = '<h3 style="color: #ff5100; margin-bottom: 15px;">ğŸ” æœç´¢ç»“æœï¼šæ‰¾åˆ° ' + searchResults.length + ' ä¸ªåŒ¹é…è¡Œç¨‹</h3>';
            for (var i = 0; i < searchResults.length; i++) {
                var ride = searchResults[i];
                var typeIcon = ride.type === 'car-find-passenger' ? 'ğŸš—' : 'ğŸš¶';
                var typeName = ride.type === 'car-find-passenger' ? 'è½¦æ‰¾äºº' : 'äººæ‰¾è½¦';
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: #ff5100; margin: 0;">' + typeIcon + ' ' + typeName + '</h3>';
                html += '</div>';
                
                if (ride.departure && ride.destination) {
                    html += '<p><strong>è·¯çº¿ï¼š</strong>' + ride.departure + ' â†’ ' + ride.destination + '</p>';
                }
                
                if (ride.date && ride.time) {
                    html += '<p><strong>æ—¶é—´ï¼š</strong>' + ride.date + ' ' + ride.time + '</p>';
                }
                
                if (ride.seats) {
                    html += '<p><strong>åº§ä½ï¼š</strong>' + ride.seats + 'ä¸ª</p>';
                }
                
                if (ride.count) {
                    html += '<p><strong>äººæ•°ï¼š</strong>' + ride.count + 'äºº</p>';
                }
                
                if (ride.price) {
                    html += '<p><strong>è´¹ç”¨ï¼š</strong>' + ride.price + 'å…ƒ</p>';
                }
                
                if (ride.budget) {
                    html += '<p><strong>é¢„ç®—ï¼š</strong>' + ride.budget + 'å…ƒ</p>';
                }
                
                if (ride.name && ride.phone) {
                    // åœ¨"æˆ‘çš„è¡Œç¨‹"ä¸­æ˜¾ç¤ºå®Œæ•´å·ç ï¼Œå› ä¸ºæ˜¯è‡ªå·±å‘å¸ƒçš„
                    var isOwnRide = currentUser && ride.publisher === currentUser.username;
                    if (isOwnRide) {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + ride.name + ' (' + ride.phone + ')</p>';
                    } else {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + ride.name + ' (' + formatPhone(ride, i, 'my') + ')</p>';
                    }
                }
                
                if (ride.notes) {
                    html += '<p><strong>å¤‡æ³¨ï¼š</strong>' + ride.notes + '</p>';
                }
                
                if (ride.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + ride.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            ridesContainer.innerHTML = html;
        }
        
        // æ˜¾ç¤ºé¦–é¡µæ‰€æœ‰ä¿¡æ¯
        function displayAllInfo() {
            displayRides();
            displayProducts();
            displayBusinesses();
        }
        
        // æ˜¾ç¤ºå†œå‰¯äº§å“ä¿¡æ¯
        function displayProducts() {
            var productsContainer = document.getElementById('products-container');
            
            if (products.length === 0) {
                productsContainer.innerHTML = '<div class="no-rides"><p style="font-size: 2rem; margin-bottom: 10px;">ğŸŒ¾</p><p>æš‚æ— å†œå‰¯äº§å“ä¿¡æ¯</p></div>';
                return;
            }
            
            var html = '';
            for (var i = 0; i < products.length; i++) {
                var product = products[i];
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: #28a745; margin: 0;">ğŸŒ¾ ' + product.name + '</h3>';
                html += '<span style="background: #28a745; color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.8rem;">' + getCategoryName(product.category) + '</span>';
                html += '</div>';
                
                html += '<p><strong>ä¾›åº”æ•°é‡ï¼š</strong>' + product.quantity + '</p>';
                html += '<p><strong>é¢„æœŸä»·æ ¼ï¼š</strong>' + product.price + '</p>';
                html += '<p><strong>äº§å“äº§åœ°ï¼š</strong>' + product.location + '</p>';
                
                if (product.harvest) {
                    html += '<p><strong>é‡‡æ”¶æ—¶é—´ï¼š</strong>' + product.harvest + '</p>';
                }
                
                if (product.quality) {
                    html += '<p><strong>å“è´¨ç­‰çº§ï¼š</strong>' + getQualityName(product.quality) + '</p>';
                }
                
                if (product.description) {
                    html += '<p><strong>äº§å“æè¿°ï¼š</strong>' + product.description + '</p>';
                }
                
                if (product.contact && product.phone) {
                    html += '<p><strong>è”ç³»äººï¼š</strong>' + product.contact + ' (' + formatProductPhone(product, i) + ')</p>';
                }
                
                if (product.wechat) {
                    html += '<p><strong>å¾®ä¿¡å·ï¼š</strong>' + product.wechat + '</p>';
                }
                
                if (product.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + product.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            productsContainer.innerHTML = html;
        }
        
        // æ˜¾ç¤ºå•†æœºä¿¡æ¯
        function displayBusinesses() {
            var businessesContainer = document.getElementById('businesses-container');
            
            if (businesses.length === 0) {
                businessesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 2rem; margin-bottom: 10px;">ğŸ’¼</p><p>æš‚æ— å•†æœºä¿¡æ¯</p></div>';
                return;
            }
            
            var html = '';
            for (var i = 0; i < businesses.length; i++) {
                var business = businesses[i];
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: #007bff; margin: 0;">ğŸ’¼ ' + business.title + '</h3>';
                html += '<span style="background: #007bff; color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.8rem;">' + getBusinessTypeName(business.type) + '</span>';
                html += '</div>';
                
                html += '<p><strong>æŠ•èµ„é‡‘é¢ï¼š</strong>' + getInvestmentName(business.investment) + '</p>';
                html += '<p><strong>æ‰€åœ¨åœ°åŒºï¼š</strong>' + business.location + '</p>';
                
                if (business.expiry) {
                    html += '<p><strong>æœ‰æ•ˆæœŸé™ï¼š</strong>' + business.expiry + '</p>';
                }
                
                if (business.urgency) {
                    html += '<p><strong>ç´§æ€¥ç¨‹åº¦ï¼š</strong>' + getUrgencyName(business.urgency) + '</p>';
                }
                
                if (business.description) {
                    html += '<p><strong>è¯¦ç»†è¯´æ˜ï¼š</strong>' + business.description + '</p>';
                }
                
                if (business.contact && business.phone) {
                    html += '<p><strong>è”ç³»äººï¼š</strong>' + business.contact + ' (' + formatBusinessPhone(business, i) + ')</p>';
                }
                
                if (business.email) {
                    html += '<p><strong>é‚®ç®±åœ°å€ï¼š</strong>' + business.email + '</p>';
                }
                
                if (business.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + business.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            businessesContainer.innerHTML = html;
        }
        
        // æ˜¾ç¤ºè¡Œç¨‹åˆ—è¡¨
        function displayRides() {
            var ridesContainer = document.getElementById('rides-container');
            
            // åˆå¹¶æ‰€æœ‰è¡Œç¨‹æ•°æ®
            var allRides = [];
            if (rides.length > 0) {
                allRides = allRides.concat(rides);
            }
            if (passengers.length > 0) {
                allRides = allRides.concat(passengers);
            }
            
            if (allRides.length === 0) {
                ridesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸš—</p><p>æš‚æ— å¯ç”¨è¡Œç¨‹ï¼Œè¯·ç¨åå†è¯•æˆ–å‘å¸ƒæ‚¨çš„è¡Œç¨‹</p></div>';
                return;
            }
            
            // æ˜¾ç¤ºæ‰€æœ‰è¡Œç¨‹
            var html = '<h3 style="color: #ff5100; margin-bottom: 15px;">ğŸš— æ‰€æœ‰å¯ç”¨è¡Œç¨‹ï¼ˆå…± ' + allRides.length + ' æ¡ï¼‰</h3>';
            for (var i = 0; i < allRides.length; i++) {
                var ride = allRides[i];
                var typeIcon = ride.type === 'car-find-passenger' ? 'ğŸš—' : 'ğŸš¶';
                var typeName = ride.type === 'car-find-passenger' ? 'è½¦æ‰¾äºº' : 'äººæ‰¾è½¦';
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: #ff5100; margin: 0;">' + typeIcon + ' ' + typeName + '</h3>';
                html += '</div>';
                
                if (ride.departure && ride.destination) {
                    html += '<p><strong>è·¯çº¿ï¼š</strong>' + ride.departure + ' â†’ ' + ride.destination + '</p>';
                }
                
                if (ride.date && ride.time) {
                    html += '<p><strong>æ—¶é—´ï¼š</strong>' + ride.date + ' ' + ride.time + '</p>';
                }
                
                if (ride.seats) {
                    html += '<p><strong>åº§ä½ï¼š</strong>' + ride.seats + 'ä¸ª</p>';
                }
                
                if (ride.count) {
                    html += '<p><strong>äººæ•°ï¼š</strong>' + ride.count + 'äºº</p>';
                }
                
                if (ride.price) {
                    html += '<p><strong>è´¹ç”¨ï¼š</strong>' + ride.price + 'å…ƒ</p>';
                }
                
                if (ride.budget) {
                    html += '<p><strong>é¢„ç®—ï¼š</strong>' + ride.budget + 'å…ƒ</p>';
                }
                
                if (ride.name && ride.phone) {
                    // åœ¨"æˆ‘çš„è¡Œç¨‹"ä¸­æ˜¾ç¤ºå®Œæ•´å·ç ï¼Œå› ä¸ºæ˜¯è‡ªå·±å‘å¸ƒçš„
                    var isOwnRide = currentUser && ride.publisher === currentUser.username;
                    if (isOwnRide) {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + ride.name + ' (' + ride.phone + ')</p>';
                    } else {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + ride.name + ' (' + formatPhone(ride, i, 'my') + ')</p>';
                    }
                }
                
                if (ride.notes) {
                    html += '<p><strong>å¤‡æ³¨ï¼š</strong>' + ride.notes + '</p>';
                }
                
                if (ride.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + ride.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            ridesContainer.innerHTML = html;
        }
        
        // æ˜¾ç¤ºæˆ‘çš„è¡Œç¨‹
        function displayMyRides() {
            var myRidesContainer = document.getElementById('my-rides-container');
            var html = '';
            
            // æ˜¾ç¤ºé¡ºé£è½¦ä¿¡æ¯
            var allRides = [];
            if (rides.length > 0) {
                allRides = allRides.concat(rides);
            }
            if (passengers.length > 0) {
                allRides = allRides.concat(passengers);
            }
            
            if (allRides.length > 0) {
                html += '<h3 style="color: #ff5100; margin-bottom: 15px; border-bottom: 2px solid #ff5100; padding-bottom: 5px;">ğŸš— æˆ‘çš„é¡ºé£è½¦ä¿¡æ¯</h3>';
                for (var i = 0; i < allRides.length; i++) {
                    var ride = allRides[i];
                    var typeIcon = ride.type === 'car-find-passenger' ? 'ğŸš—' : 'ğŸš¶';
                    var typeName = ride.type === 'car-find-passenger' ? 'è½¦æ‰¾äºº' : 'äººæ‰¾è½¦';
                    
                    html += '<div class="ride-card">';
                    html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                    html += '<h4 style="color: #ff5100; margin: 0;">' + typeIcon + ' ' + typeName + '</h4>';
                    html += '<button onclick="deleteRide(\'' + ride.type + '\', ' + i + ')" style="background: #dc3545; color: white; padding: 5px 10px; border-radius: 5px; font-size: 0.8rem; border: none; cursor: pointer;">åˆ é™¤</button>';
                    html += '</div>';
                    
                    if (ride.departure && ride.destination) {
                        html += '<p><strong>è·¯çº¿ï¼š</strong>' + ride.departure + ' â†’ ' + ride.destination + '</p>';
                    }
                    
                    if (ride.date && ride.time) {
                        html += '<p><strong>æ—¶é—´ï¼š</strong>' + ride.date + ' ' + ride.time + '</p>';
                    }
                    
                    if (ride.price || ride.budget) {
                        html += '<p><strong>è´¹ç”¨ï¼š</strong>' + (ride.price || ride.budget) + 'å…ƒ</p>';
                    }
                    
                    if (ride.name && ride.phone) {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + ride.name + ' (' + ride.phone + ')</p>';
                    }
                    
                    if (ride.publishTime) {
                        html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + ride.publishTime + '</p>';
                    }
                    
                    html += '</div>';
                }
            }
            
            // æ˜¾ç¤ºå†œå‰¯äº§å“ä¿¡æ¯
            if (products.length > 0) {
                html += '<h3 style="color: #28a745; margin: 30px 0 15px 0; border-bottom: 2px solid #28a745; padding-bottom: 5px;">ğŸŒ¾ æˆ‘çš„å†œå‰¯äº§å“</h3>';
                for (var i = 0; i < products.length; i++) {
                    var product = products[i];
                    
                    html += '<div class="ride-card">';
                    html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                    html += '<h4 style="color: #28a745; margin: 0;">ğŸŒ¾ ' + product.name + '</h4>';
                    html += '<button onclick="deleteProduct(' + i + ')" style="background: #dc3545; color: white; padding: 5px 10px; border-radius: 5px; font-size: 0.8rem; border: none; cursor: pointer;">åˆ é™¤</button>';
                    html += '</div>';
                    
                    html += '<p><strong>ä¾›åº”æ•°é‡ï¼š</strong>' + product.quantity + '</p>';
                    html += '<p><strong>é¢„æœŸä»·æ ¼ï¼š</strong>' + product.price + '</p>';
                    html += '<p><strong>äº§å“äº§åœ°ï¼š</strong>' + product.location + '</p>';
                    
                    if (product.contact && product.phone) {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + product.contact + ' (' + product.phone + ')</p>';
                    }
                    
                    if (product.publishTime) {
                        html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + product.publishTime + '</p>';
                    }
                    
                    html += '</div>';
                }
            }
            
            // æ˜¾ç¤ºå•†æœºä¿¡æ¯
            if (businesses.length > 0) {
                html += '<h3 style="color: #007bff; margin: 30px 0 15px 0; border-bottom: 2px solid #007bff; padding-bottom: 5px;">ğŸ’¼ æˆ‘çš„å•†æœºä¿¡æ¯</h3>';
                for (var i = 0; i < businesses.length; i++) {
                    var business = businesses[i];
                    
                    html += '<div class="ride-card">';
                    html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                    html += '<h4 style="color: #007bff; margin: 0;">ğŸ’¼ ' + business.title + '</h4>';
                    html += '<button onclick="deleteBusiness(' + i + ')" style="background: #dc3545; color: white; padding: 5px 10px; border-radius: 5px; font-size: 0.8rem; border: none; cursor: pointer;">åˆ é™¤</button>';
                    html += '</div>';
                    
                    html += '<p><strong>å•†æœºç±»å‹ï¼š</strong>' + getBusinessTypeName(business.type) + '</p>';
                    html += '<p><strong>æŠ•èµ„é‡‘é¢ï¼š</strong>' + getInvestmentName(business.investment) + '</p>';
                    html += '<p><strong>æ‰€åœ¨åœ°åŒºï¼š</strong>' + business.location + '</p>';
                    
                    if (business.contact && business.phone) {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + business.contact + ' (' + business.phone + ')</p>';
                    }
                    
                    if (business.publishTime) {
                        html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + business.publishTime + '</p>';
                    }
                    
                    html += '</div>';
                }
            }
            
            if (html === '') {
                myRidesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸ“</p><p>æ‚¨è¿˜æ²¡æœ‰å‘å¸ƒè¿‡ä»»ä½•ä¿¡æ¯</p></div>';
            } else {
                myRidesContainer.innerHTML = html;
            }
        }
        
        // ä¿®æ”¹åçš„åˆ é™¤å‡½æ•°
        async function deleteRide(type, index) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè¡Œç¨‹å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ï¼')) return;
            
            try {
                let rideToDelete;
                if (type === 'car-find-passenger') {
                    rideToDelete = rides[index];
                    rides.splice(index, 1);
                } else if (type === 'passenger-find-car') {
                    rideToDelete = passengers[index];
                    passengers.splice(index, 1);
                }
                
                if (rideToDelete) {
                    await databaseService.deleteData('rides', rideToDelete.id);
                }
                
                alert('è¡Œç¨‹å·²åˆ é™¤ï¼');
                await displayMyRides();
                await displayAllInfo();
            } catch (error) {
                console.error('åˆ é™¤å¤±è´¥:', error);
                alert('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
            }
        }
        
        // åˆ é™¤å†œå‰¯äº§å“
        function deleteProduct(index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå†œå‰¯äº§å“ä¿¡æ¯å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ï¼')) {
                try {
                    products.splice(index, 1);
                    localStorage.setItem('products', JSON.stringify(products));
                    console.log('å†œå‰¯äº§å“ä¿¡æ¯å·²åˆ é™¤ï¼Œå‰©ä½™ï¼š' + products.length + ' æ¡');
                    
                    // åˆ·æ–°æ˜¾ç¤º
                    displayMyRides();
                    displayAllInfo();
                    alert('å†œå‰¯äº§å“ä¿¡æ¯å·²åˆ é™¤ï¼');
                } catch (e) {
                    console.error('åˆ é™¤å†œå‰¯äº§å“å¤±è´¥:', e);
                    alert('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
                }
            }
        }
        
        // åˆ é™¤å•†æœºä¿¡æ¯
        function deleteBusiness(index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå•†æœºä¿¡æ¯å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ï¼')) {
                try {
                    businesses.splice(index, 1);
                    localStorage.setItem('businesses', JSON.stringify(businesses));
                    console.log('å•†æœºä¿¡æ¯å·²åˆ é™¤ï¼Œå‰©ä½™ï¼š' + businesses.length + ' æ¡');
                    
                    // åˆ·æ–°æ˜¾ç¤º
                    displayMyRides();
                    displayAllInfo();
                    alert('å•†æœºä¿¡æ¯å·²åˆ é™¤ï¼');
                } catch (e) {
                    console.error('åˆ é™¤å•†æœºä¿¡æ¯å¤±è´¥:', e);
                    alert('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
                }
            }
        }
        
        // æ˜¾ç¤ºå¯†ç éªŒè¯æ¨¡æ€æ¡†
        function showPasswordModal() {
            var modal = document.getElementById('password-modal');
            var passwordInput = document.getElementById('password-input');
            passwordInput.value = '';
            modal.style.display = 'flex';
        }
        
        // éšè—å¯†ç éªŒè¯æ¨¡æ€æ¡†
        function hidePasswordModal() {
            var modal = document.getElementById('password-modal');
            modal.style.display = 'none';
        }
        
        // éªŒè¯å¯†ç 
        function verifyPassword() {
            var passwordInput = document.getElementById('password-input');
            var password = passwordInput.value.trim();
            
            // é»˜è®¤å¯†ç ï¼šadmin123
            if (password === 'admin123') {
                hidePasswordModal();
                showAnnouncementModal();
            } else {
                alert('å¯†ç é”™è¯¯ï¼è¯·è”ç³»ç®¡ç†å‘˜è·å–æ­£ç¡®å¯†ç ã€‚');
                passwordInput.value = '';
                passwordInput.focus();
            }
        }
        
        // æ˜¾ç¤ºå…¬å‘Šç¼–è¾‘æ¨¡æ€æ¡†
        function showAnnouncementModal() {
            var modal = document.getElementById('announcement-modal');
            var textarea = document.getElementById('announcement-textarea');
            var currentText = document.getElementById('announcement-text').textContent;
            
            textarea.value = currentText;
            modal.style.display = 'flex';
        }
        
        // éšè—å…¬å‘Šç¼–è¾‘æ¨¡æ€æ¡†
        function hideAnnouncementModal() {
            var modal = document.getElementById('announcement-modal');
            modal.style.display = 'none';
        }
        
        // ä¿å­˜å…¬å‘Š
        function saveAnnouncement() {
            var textarea = document.getElementById('announcement-textarea');
            var announcementText = textarea.value.trim();
            
            if (announcementText) {
                document.getElementById('announcement-text').textContent = announcementText;
                alert('å…¬å‘Šæ›´æ–°æˆåŠŸï¼');
                hideAnnouncementModal();
                
                // ä¿å­˜åˆ°localStorageä»¥ä¾¿æŒä¹…åŒ–
                localStorage.setItem('announcementText', announcementText);
            } else {
                alert('è¯·è¾“å…¥å…¬å‘Šå†…å®¹ï¼');
            }
        }
        
        // ç”¨æˆ·ç³»ç»Ÿç›¸å…³å‡½æ•°
        
        // æ ¼å¼åŒ–ç”µè¯å·ç æ˜¾ç¤º
        function formatPhone(ride, index, context) {
            // æ£€æŸ¥æ˜¯å¦å·²ä»˜è´¹
            var contactId = ride.type + '_' + index;
            var hasPaid = paidContacts.some(function(paid) { 
                return paid.id === contactId && paid.username === (currentUser ? currentUser.username : 'guest');
            });
            
            // å¦‚æœæ˜¯è‡ªå·±çš„è¡Œç¨‹æˆ–è€…å·²ä»˜è´¹ï¼Œæ˜¾ç¤ºå®Œæ•´å·ç 
            var isOwnRide = currentUser && ride.publisher === currentUser.username;
            if (isOwnRide || hasPaid) {
                return '<span style="color: #28a745;">' + ride.phone + '</span>';
            }
            
            // å¦åˆ™æ˜¾ç¤ºéšè—å·ç å’Œä»˜è´¹æŒ‰é’®
            var hiddenPhone = ride.phone.substring(0, 3) + '****' + ride.phone.substring(7);
            return '<span class="phone-hidden">' + hiddenPhone + '</span>' + 
                   '<button class="reveal-phone-btn" onclick="showPaymentModal(\'' + ride.type + '\', ' + index + ')">æŸ¥çœ‹å·ç </button>';
        }
        
        // æ˜¾ç¤ºè®¤è¯æ¨¡æ€æ¡†
        function showAuthModal() {
            var modal = document.getElementById('auth-modal');
            modal.style.display = 'flex';
        }
        
        // éšè—è®¤è¯æ¨¡æ€æ¡†
        function hideAuthModal() {
            var modal = document.getElementById('auth-modal');
            modal.style.display = 'none';
        }
        
        // åˆ‡æ¢è®¤è¯æ ‡ç­¾
        function switchAuthTab(tab) {
            var loginTab = document.querySelector('.auth-tab:first-child');
            var registerTab = document.querySelector('.auth-tab:last-child');
            var loginForm = document.getElementById('login-form');
            var registerForm = document.getElementById('register-form');
            
            if (tab === 'login') {
                loginTab.classList.add('active');
                registerTab.classList.remove('active');
                loginForm.classList.add('active');
                registerForm.classList.remove('active');
            } else {
                loginTab.classList.remove('active');
                registerTab.classList.add('active');
                loginForm.classList.remove('active');
                registerForm.classList.add('active');
            }
        }
        
        // ç”¨æˆ·æ³¨å†Œ
        function register() {
            var username = document.getElementById('register-username').value.trim();
            var password = document.getElementById('register-password').value.trim();
            var phone = document.getElementById('register-phone').value.trim();
            
            if (!username || !password || !phone) {
                alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯ï¼');
                return;
            }
            
            if (password.length < 6) {
                alert('å¯†ç è‡³å°‘éœ€è¦6ä½ï¼');
                return;
            }
            
            // æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
            if (users.some(function(user) { return user.username === username; })) {
                alert('ç”¨æˆ·åå·²å­˜åœ¨ï¼');
                return;
            }
            
            // åˆ›å»ºæ–°ç”¨æˆ·
            var newUser = {
                username: username,
                password: password,
                phone: phone,
                registerTime: new Date().toLocaleString(),
                balance: 0 // åˆå§‹ä½™é¢
            };
            
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            alert('ğŸ‰ æ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•ã€‚');
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('register-form').reset();
            
            // åˆ‡æ¢åˆ°ç™»å½•æ ‡ç­¾
            switchAuthTab('login');
        }
        
        // ç”¨æˆ·ç™»å½•
        function login() {
            var username = document.getElementById('login-username').value.trim();
            var password = document.getElementById('login-password').value.trim();
            
            if (!username || !password) {
                alert('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼');
                return;
            }
            
            // æŸ¥æ‰¾ç”¨æˆ·
            var user = users.find(function(u) { 
                return u.username === username && u.password === password; 
            });
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateUserDisplay();
                hideAuthModal();
                alert('ğŸ‰ ç™»å½•æˆåŠŸï¼æ¬¢è¿å›æ¥ï¼Œ' + user.username + 'ï¼');
                
                // æ¸…ç©ºç™»å½•è¡¨å•
                document.getElementById('login-form').reset();
                
                // åˆ·æ–°æ˜¾ç¤º
                displayRides();
                displayMyRides();
            } else {
                alert('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼');
            }
        }
        
        // ç”¨æˆ·é€€å‡ºç™»å½•
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                currentUser = null;
                localStorage.removeItem('currentUser');
                updateUserDisplay();
                alert('ğŸ‘‹ å·²é€€å‡ºç™»å½•');
                
                // åˆ·æ–°æ˜¾ç¤º
                displayRides();
                displayMyRides();
            }
        }
        
        // æ›´æ–°ç”¨æˆ·æ˜¾ç¤º
        function updateUserDisplay() {
            var userInfo = document.getElementById('user-info');
            var userStatus = document.getElementById('user-status');
            
            if (currentUser) {
                var isAdmin = adminUsers.includes(currentUser.username);
                var statusText = currentUser.username + ' (Â¥' + (currentUser.balance || 0).toFixed(2) + ')';
                
                userInfo.classList.add('logged-in');
                userInfo.classList.remove('guest');
                
                // æ„å»ºç”¨æˆ·ä¿¡æ¯HTML
                var userHTML = '<span id="user-status">' + statusText + '</span>';
                
                // å¦‚æœæ˜¯ç®¡ç†å‘˜ï¼Œæ·»åŠ ç®¡ç†å‘˜æŒ‰é’®
                if (isAdmin) {
                    userHTML += '<button class="user-btn" onclick="showAdminPanel()">ç®¡ç†</button>';
                }
                
                userHTML += '<button class="user-btn logout" onclick="logout()">é€€å‡º</button>';
                
                userInfo.innerHTML = userHTML;
            } else {
                userInfo.classList.add('guest');
                userInfo.classList.remove('logged-in');
                
                // æ›´æ–°æŒ‰é’®
                userInfo.innerHTML = '<span id="user-status">æ¸¸å®¢æ¨¡å¼</span>' +
                                 '<button class="user-btn" onclick="showAuthModal()">ç™»å½•/æ³¨å†Œ</button>';
            }
        }
        
        // æ˜¾ç¤ºä»˜è´¹æ¨¡æ€æ¡†
        function showPaymentModal(type, index) {
            currentViewingRide = index;
            currentViewingType = type;
            
            // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
            if (!currentUser) {
                alert('ğŸ”’ è¯·å…ˆç™»å½•åå†æŸ¥çœ‹è”ç³»æ–¹å¼ï¼');
                showAuthModal();
                return;
            }
            
            // æ£€æŸ¥ä½™é¢
            if ((currentUser.balance || 0) < 0.2) {
                alert('ğŸ’° ä½™é¢ä¸è¶³ï¼è¯·å……å€¼åå†æŸ¥çœ‹è”ç³»æ–¹å¼ã€‚\nå½“å‰ä½™é¢ï¼šÂ¥' + (currentUser.balance || 0).toFixed(2));
                return;
            }
            
            var modal = document.getElementById('payment-modal');
            modal.style.display = 'flex';
        }
        
        // éšè—ä»˜è´¹æ¨¡æ€æ¡†
        function hidePaymentModal() {
            var modal = document.getElementById('payment-modal');
            modal.style.display = 'none';
        }
        
        // æ¨¡æ‹Ÿæ”¯ä»˜
        function simulatePayment() {
            if (!currentUser || currentViewingRide === null) {
                alert('å‚æ•°é”™è¯¯ï¼');
                return;
            }
            
            // æ‰£é™¤è´¹ç”¨
            currentUser.balance = (currentUser.balance || 0) - 0.2;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            // æ›´æ–°ç”¨æˆ·åˆ—è¡¨ä¸­çš„ä½™é¢
            var userIndex = users.findIndex(function(u) { return u.username === currentUser.username; });
            if (userIndex !== -1) {
                users[userIndex].balance = currentUser.balance;
                localStorage.setItem('users', JSON.stringify(users));
            }
            
            // è®°å½•å·²ä»˜è´¹æŸ¥çœ‹
            var contactId = currentViewingType + '_' + currentViewingRide;
            paidContacts.push({
                id: contactId,
                username: currentUser.username,
                paymentTime: new Date().toLocaleString(),
                amount: 0.2
            });
            localStorage.setItem('paidContacts', JSON.stringify(paidContacts));
            
            // æ›´æ–°æ˜¾ç¤º
            updateUserDisplay();
            hidePaymentModal();
            alert('ğŸ’° æ”¯ä»˜æˆåŠŸï¼ç°åœ¨å¯ä»¥æŸ¥çœ‹è”ç³»æ–¹å¼äº†ã€‚');
            
            // åˆ·æ–°æ˜¾ç¤º
            if (document.getElementById('find').classList.contains('active')) {
                searchRides();
            } else if (document.getElementById('my-rides').classList.contains('active')) {
                displayMyRides();
            } else {
                displayRides();
            }
        }

        // ç®¡ç†å‘˜åŠŸèƒ½ç›¸å…³å‡½æ•°
        
        // æ˜¾ç¤ºç®¡ç†å‘˜é¢æ¿
        function showAdminPanel() {
            if (!currentUser || !adminUsers.includes(currentUser.username)) {
                alert('ğŸ”’ æ‚¨æ²¡æœ‰ç®¡ç†å‘˜æƒé™ï¼');
                return;
            }
            
            var panel = document.getElementById('admin-panel');
            panel.classList.add('show');
            
            // åŠ è½½ç”¨æˆ·åˆ—è¡¨
            loadAdminUserList();
            
            // åŠ è½½åˆ†äº«è®°å½•
            loadShareRecords();
        }
        
        // éšè—ç®¡ç†å‘˜é¢æ¿
        function hideAdminPanel() {
            var panel = document.getElementById('admin-panel');
            panel.classList.remove('show');
        }
        
        // åŠ è½½ç®¡ç†å‘˜ç”¨æˆ·åˆ—è¡¨
        function loadAdminUserList() {
            var userList = document.getElementById('admin-user-list');
            var usernameSelect = document.getElementById('recharge-username');
            
            // æ¸…ç©ºç°æœ‰å†…å®¹
            userList.innerHTML = '';
            usernameSelect.innerHTML = '<option value="">è¯·é€‰æ‹©ç”¨æˆ·</option>';
            
            if (users.length === 0) {
                userList.innerHTML = '<div class="user-item">æš‚æ— ç”¨æˆ·</div>';
                return;
            }
            
            // æ·»åŠ ç”¨æˆ·åˆ°åˆ—è¡¨å’Œé€‰æ‹©æ¡†
            users.forEach(function(user) {
                // æ·»åŠ åˆ°ç”¨æˆ·åˆ—è¡¨
                var userItem = document.createElement('div');
                userItem.className = 'user-item';
                userItem.innerHTML = '<span>' + user.username + '</span>' +
                                    '<span class="balance-info">Â¥' + (user.balance || 0).toFixed(2) + '</span>';
                userList.appendChild(userItem);
                
                // æ·»åŠ åˆ°é€‰æ‹©æ¡†
                var option = document.createElement('option');
                option.value = user.username;
                option.textContent = user.username + ' (ä½™é¢: Â¥' + (user.balance || 0).toFixed(2) + ')';
                usernameSelect.appendChild(option);
            });
        }
        
        // ç®¡ç†å‘˜å……å€¼
        function adminRecharge() {
            var username = document.getElementById('recharge-username').value;
            var amount = parseFloat(document.getElementById('recharge-amount').value);
            var note = document.getElementById('recharge-note').value.trim();
            
            if (!username) {
                alert('è¯·é€‰æ‹©è¦å……å€¼çš„ç”¨æˆ·ï¼');
                return;
            }
            
            if (!amount || amount <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„å……å€¼é‡‘é¢ï¼');
                return;
            }
            
            // æŸ¥æ‰¾ç”¨æˆ·
            var userIndex = users.findIndex(function(u) { return u.username === username; });
            if (userIndex === -1) {
                alert('ç”¨æˆ·ä¸å­˜åœ¨ï¼');
                return;
            }
            
            // æ›´æ–°ç”¨æˆ·ä½™é¢
            users[userIndex].balance = (users[userIndex].balance || 0) + amount;
            
            // è®°å½•å……å€¼è®°å½•
            var rechargeRecord = {
                username: username,
                amount: amount,
                note: note || 'ç®¡ç†å‘˜å……å€¼',
                admin: currentUser.username,
                timestamp: new Date().toLocaleString()
            };
            
            // ä¿å­˜å……å€¼è®°å½•
            if (!users[userIndex].rechargeRecords) {
                users[userIndex].rechargeRecords = [];
            }
            users[userIndex].rechargeRecords.push(rechargeRecord);
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('users', JSON.stringify(users));
            
            // å¦‚æœæ˜¯å½“å‰ç™»å½•ç”¨æˆ·ï¼ŒåŒæ—¶æ›´æ–°currentUser
            if (currentUser && currentUser.username === username) {
                currentUser.balance = users[userIndex].balance;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateUserDisplay();
            }
            
            // åˆ·æ–°ç®¡ç†é¢æ¿
            loadAdminUserList();
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('recharge-amount').value = '';
            document.getElementById('recharge-note').value = '';
            document.getElementById('recharge-username').value = '';
            
            alert('âœ… å……å€¼æˆåŠŸï¼\nç”¨æˆ·ï¼š' + username + '\né‡‘é¢ï¼šÂ¥' + amount.toFixed(2) + '\nå¤‡æ³¨ï¼š' + note);
        }
        
        // åŠ è½½åˆ†äº«è®°å½•
        function loadShareRecords() {
            var recordsContainer = document.getElementById('share-records');
            
            if (shareRecords.length === 0) {
                recordsContainer.innerHTML = '<div class="user-item">æš‚æ— åˆ†äº«è®°å½•</div>';
                return;
            }
            
            recordsContainer.innerHTML = '';
            
            // æŒ‰æ—¶é—´å€’åºæ’åˆ—
            var sortedRecords = shareRecords.slice().sort(function(a, b) {
                return new Date(b.timestamp) - new Date(a.timestamp);
            });
            
            // åªæ˜¾ç¤ºæœ€è¿‘20æ¡è®°å½•
            var recentRecords = sortedRecords.slice(0, 20);
            
            recentRecords.forEach(function(record) {
                var recordItem = document.createElement('div');
                recordItem.className = 'user-item';
                recordItem.innerHTML = '<span>' + record.username + ' (' + record.type + ')</span>' +
                                    '<span style="color: #28a745;">Â¥0.10</span>';
                recordItem.title = 'æ—¶é—´ï¼š' + record.timestamp;
                recordsContainer.appendChild(recordItem);
            });
        }

        // åˆ†äº«åŠŸèƒ½ç›¸å…³å‡½æ•°
        
        // åˆ†äº«åˆ°å¾®ä¿¡ç¾¤
        function shareToWechat() {
            if (!currentUser) {
                alert('ğŸ”’ è¯·å…ˆç™»å½•åå†åˆ†äº«ï¼');
                showAuthModal();
                return;
            }
            
            // å¤åˆ¶é“¾æ¥åˆ°å‰ªè´´æ¿
            var shareUrl = window.location.href;
            var shareText = 'ã€æ¹˜Mé¡ºé£è½¦ã€‘ç»¿è‰²å‡ºè¡Œï¼Œä¾¿æ°‘åˆ©æ°‘ï¼è½¦æ‰¾äººã€äººæ‰¾è½¦ï¼Œè¿˜æœ‰å†œå‰¯äº§å“å•†æœºå‘å¸ƒï¼Œèµ¶å¿«åŠ å…¥å§ï¼\n' + shareUrl;
            
            copyToClipboard(shareText);
            
            // éªŒè¯åˆ†äº«
            verifyShare('å¾®ä¿¡ç¾¤');
        }
        
        // åˆ†äº«åˆ°æœ‹å‹åœˆ
        function shareToMoments() {
            if (!currentUser) {
                alert('ğŸ”’ è¯·å…ˆç™»å½•åå†åˆ†äº«ï¼');
                showAuthModal();
                return;
            }
            
            // ç›´æ¥å¤åˆ¶é“¾æ¥å¹¶éªŒè¯
            var shareUrl = window.location.href;
            var shareText = 'ã€æ¹˜Mé¡ºé£è½¦ã€‘ç»¿è‰²å‡ºè¡Œï¼Œä¾¿æ°‘åˆ©æ°‘ï¼è½¦æ‰¾äººã€äººæ‰¾è½¦ï¼Œè¿˜æœ‰å†œå‰¯äº§å“å•†æœºå‘å¸ƒï¼Œèµ¶å¿«åŠ å…¥å§ï¼\n' + shareUrl;
            
            copyToClipboard(shareText);
            
            // ç®€åŒ–éªŒè¯ï¼šç‚¹å‡»å³è§†ä¸ºåˆ†äº«æˆåŠŸ
            verifyShare('æœ‹å‹åœˆ');
        }
        
        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard(text) {
            var textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                document.execCommand('copy');
                showShareStatus('âœ… é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            } catch (err) {
                showShareStatus('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ï¼š\n' + text);
            }
            
            document.body.removeChild(textarea);
        }
        
        // éªŒè¯åˆ†äº«å¹¶å‘æ”¾å¥–åŠ±
        function verifyShare(shareType) {
            if (!currentUser) return;
            
            // è·å–ä»Šæ—¥æ—¥æœŸ
            var today = new Date().toDateString();
            
            // è·å–ä»Šæ—¥åˆ†äº«è®°å½•ï¼ˆåŒ…æ‹¬ä¸è®¡è´¹çš„ï¼‰
            var todayAllRecords = shareRecords.filter(function(record) {
                return record.username === currentUser.username && 
                       record.timestamp.startsWith(today.substring(0, 10));
            });
            
            // è·å–ä»Šæ—¥å·²è®¡è´¹æ¬¡æ•°
            var todayPaidRecords = todayAllRecords.filter(function(record) {
                return record.amount > 0;
            });
            
            // æ£€æŸ¥ä»Šæ—¥å·²åˆ†äº«æ¬¡æ•°
            var totalShareCount = todayAllRecords.length;
            var paidShareCount = todayPaidRecords.length;
            
            // è®°å½•åˆ†äº«ï¼ˆå§‹ç»ˆè®°å½•ï¼Œä½†ä¸ä¸€å®šç»™å¥–åŠ±ï¼‰
            var shareRecord = {
                username: currentUser.username,
                type: shareType,
                amount: 0, // é»˜è®¤æ— å¥–åŠ±
                timestamp: new Date().toLocaleString()
            };
            
            var shouldGiveReward = false;
            var message = '';
            
            if (paidShareCount >= 5) {
                // å‰5æ¬¡å·²ç»è·å¾—å¥–åŠ±ï¼Œæœ¬æ¬¡ä¸ç»™å¥–åŠ±
                message = 'ğŸ“± åˆ†äº«å·²è®°å½•ï¼ä»Šæ—¥å‰5æ¬¡åˆ†äº«å·²è·å¾—å¥–åŠ±ï¼Œåç»­åˆ†äº«æ— å¥–åŠ±ã€‚';
            } else {
                // å‰5æ¬¡å†…ï¼Œç»™å¥–åŠ±
                shareRecord.amount = 0.10;
                shouldGiveReward = true;
                message = 'ğŸ‰ åˆ†äº«æˆåŠŸï¼è·å¾— Â¥0.10 å¥–åŠ±ï¼Œå·²è‡ªåŠ¨åˆ°è´¦ï¼';
            }
            
            // ä¿å­˜åˆ†äº«è®°å½•
            shareRecords.push(shareRecord);
            localStorage.setItem('shareRecords', JSON.stringify(shareRecords));
            
            // å¦‚æœéœ€è¦ç»™å¥–åŠ±
            if (shouldGiveReward) {
                currentUser.balance = (currentUser.balance || 0) + 0.10;
                
                // æ›´æ–°ç”¨æˆ·åˆ—è¡¨
                var userIndex = users.findIndex(function(u) { return u.username === currentUser.username; });
                if (userIndex !== -1) {
                    users[userIndex].balance = currentUser.balance;
                    localStorage.setItem('users', JSON.stringify(users));
                }
                
                // ä¿å­˜å½“å‰ç”¨æˆ·
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
            }
            
            // æ›´æ–°æ˜¾ç¤º
            updateUserDisplay();
            updateTodayShareAmount();
            updateShareCountDisplay(totalShareCount + 1, paidShareCount + (shouldGiveReward ? 1 : 0));
            
            showShareStatus(message);
        }
        
        // æ˜¾ç¤ºåˆ†äº«çŠ¶æ€
        function showShareStatus(message) {
            var statusElement = document.getElementById('share-status');
            statusElement.textContent = message;
            statusElement.style.color = message.includes('æˆåŠŸ') ? '#28a745' : '#dc3545';
            
            // 3ç§’åæ¢å¤é»˜è®¤çŠ¶æ€
            setTimeout(function() {
                statusElement.textContent = 'åˆ†äº«æˆåŠŸåå¥–åŠ±å°†è‡ªåŠ¨åˆ°è´¦';
                statusElement.style.color = '#666';
            }, 3000);
        }
        
        // æ›´æ–°ä»Šæ—¥åˆ†äº«é‡‘é¢
        function updateTodayShareAmount() {
            if (!currentUser) {
                document.getElementById('today-share-amount').textContent = '0.00';
                return;
            }
            
            var today = new Date().toDateString();
            var todayPaidRecords = shareRecords.filter(function(record) {
                return record.username === currentUser.username && 
                       record.timestamp.startsWith(today.substring(0, 10)) &&
                       record.amount > 0;
            });
            
            var todayAmount = todayPaidRecords.length * 0.10;
            document.getElementById('today-share-amount').textContent = todayAmount.toFixed(2);
        }
        
        // æ›´æ–°åˆ†äº«æ¬¡æ•°æ˜¾ç¤º
        function updateShareCountDisplay(totalCount, paidCount) {
            if (!currentUser) return;
            
            var countElement = document.getElementById('today-share-count');
            if (countElement) {
                countElement.textContent = paidCount + '/5';
            }
        }
        
        // åˆå§‹åŒ–åˆ†äº«æ¬¡æ•°æ˜¾ç¤º
        function initShareCountDisplay() {
            if (!currentUser) {
                var countElement = document.getElementById('today-share-count');
                if (countElement) {
                    countElement.textContent = '0/5';
                }
                return;
            }
            
            var today = new Date().toDateString();
            var todayAllRecords = shareRecords.filter(function(record) {
                return record.username === currentUser.username && 
                       record.timestamp.startsWith(today.substring(0, 10));
            });
            
            var todayPaidRecords = todayAllRecords.filter(function(record) {
                return record.amount > 0;
            });
            
            updateShareCountDisplay(todayAllRecords.length, todayPaidRecords.length);
        }
        
        // ä¿®æ”¹åçš„é¡µé¢åŠ è½½å‡½æ•°
        window.onload = async function() {
            console.log('æ¹˜Mé¡ºé£è½¦å¹³å°åŠ è½½å®Œæˆï¼');
            
            // æ•°æ®åŠ è½½ä¿æŠ¤å‡½æ•°
            function safeLoadData(key, defaultEmptyArray = false) {
                try {
                    var savedData = localStorage.getItem(key);
                    if (savedData) {
                        var parsed = JSON.parse(savedData);
                        return Array.isArray(parsed) ? parsed : [];
                    }
                    return defaultEmptyArray ? [] : null;
                } catch (e) {
                    console.warn('åŠ è½½æ•°æ®å¤±è´¥ [' + key + ']:', e);
                    return defaultEmptyArray ? [] : null;
                }
            }
            
            // ä¼˜å…ˆä»FirebaseåŠ è½½æ•°æ®
            await loadAllData();
            
            // åŠ è½½å½“å‰ç™»å½•ç”¨æˆ·
            var savedCurrentUser = localStorage.getItem('currentUser');
            if (savedCurrentUser) {
                try {
                    currentUser = JSON.parse(savedCurrentUser);
                } catch (e) {
                    console.warn('åŠ è½½å½“å‰ç”¨æˆ·å¤±è´¥:', e);
                    currentUser = null;
                }
            }
            
            // æ›´æ–°ç”¨æˆ·æ˜¾ç¤º
            updateUserDisplay();
            updateTodayShareAmount();
            initShareCountDisplay();
            
            // é»˜è®¤æ˜¾ç¤ºé¦–é¡µ
            switchTab('find');
            await displayAllInfo();
            
            // å¯åŠ¨æ•°æ®åŒæ­¥ï¼ˆæ¯30ç§’æ£€æŸ¥ä¸€æ¬¡ï¼‰
            setInterval(() => {
                if (databaseService.isOnline) {
                    databaseService.syncOfflineData();
                }
            }, 30000);
        };
        
        // æ•°æ®å¤‡ä»½åŠŸèƒ½ - åˆ›å»ºè‡ªåŠ¨å¤‡ä»½
        function createDataBackup() {
            try {
                var backupData = {
                    timestamp: new Date().toISOString(),
                    rides: rides,
                    passengers: passengers,
                    products: products,
                    businesses: businesses,
                    users: users,
                    shareRecords: shareRecords,
                    paidContacts: paidContacts
                };
                
                var backupKey = 'backup_' + new Date().getTime();
                localStorage.setItem(backupKey, JSON.stringify(backupData));
                
                // ä¿ç•™æœ€è¿‘10ä¸ªå¤‡ä»½
                var allKeys = Object.keys(localStorage).filter(function(key) {
                    return key.startsWith('backup_');
                });
                
                if (allKeys.length > 10) {
                    allKeys.sort();
                    for (var i = 0; i < allKeys.length - 10; i++) {
                        localStorage.removeItem(allKeys[i]);
                    }
                }
                
                console.log('æ•°æ®å¤‡ä»½å·²åˆ›å»ºï¼š' + backupKey);
            } catch (e) {
                console.error('åˆ›å»ºæ•°æ®å¤‡ä»½å¤±è´¥:', e);
            }
        }
        
        // å®šæœŸåˆ›å»ºå¤‡ä»½ï¼ˆæ¯5åˆ†é’Ÿï¼‰
        setInterval(function() {
            if (currentUser) {
                createDataBackup();
            }
        }, 5 * 60 * 1000);
        
        // è·å–äº§å“ç±»åˆ«åç§°
        function getCategoryName(category) {
            var categories = {
                'vegetables': 'æ–°é²œè”¬èœ',
                'fruits': 'æ—¶ä»¤æ°´æœ',
                'grains': 'ç²®é£Ÿæ‚ç²®',
                'livestock': 'ç¦½ç•œäº§å“',
                'aquatic': 'æ°´äº§æµ·é²œ',
                'processed': 'åŠ å·¥é£Ÿå“',
                'handmade': 'æ‰‹å·¥åˆ¶å“',
                'other': 'å…¶ä»–äº§å“'
            };
            return categories[category] || category;
        }
        
        // è·å–å“è´¨ç­‰çº§åç§°
        function getQualityName(quality) {
            var qualities = {
                'organic': 'æœ‰æœºè®¤è¯',
                'green': 'ç»¿è‰²æ— å…¬å®³',
                'ecological': 'ç”Ÿæ€ç§æ¤',
                'traditional': 'ä¼ ç»Ÿç§æ¤',
                'standard': 'å¸¸è§„æ ‡å‡†'
            };
            return qualities[quality] || quality;
        }
        
        // è·å–å•†æœºç±»å‹åç§°
        function getBusinessTypeName(type) {
            var types = {
                'cooperation': 'å•†ä¸šåˆä½œ',
                'investment': 'æŠ•èµ„æ‹›å•†',
                'transfer': 'åº—é“ºè½¬è®©',
                'equipment': 'è®¾å¤‡è½¬è®©',
                'recruitment': 'æ‹›è˜æ±‚èŒ',
                'procurement': 'é‡‡è´­éœ€æ±‚',
                'service': 'æœåŠ¡æä¾›',
                'other': 'å…¶ä»–å•†æœº'
            };
            return types[type] || type;
        }
        
        // è·å–æŠ•èµ„é‡‘é¢åç§°
        function getInvestmentName(investment) {
            var investments = {
                'small': '1ä¸‡å…ƒä»¥ä¸‹',
                'medium': '1-5ä¸‡å…ƒ',
                'large': '5-10ä¸‡å…ƒ',
                'xlarge': '10ä¸‡å…ƒä»¥ä¸Š',
                'negotiable': 'é¢è®®'
            };
            return investments[investment] || investment;
        }
        
        // è·å–ç´§æ€¥ç¨‹åº¦åç§°
        function getUrgencyName(urgency) {
            var urgencies = {
                'urgent': 'ç´§æ€¥',
                'normal': 'ä¸€èˆ¬',
                'relaxed': 'ä¸æ€¥'
            };
            return urgencies[urgency] || urgency;
        }
        
        // æ ¼å¼åŒ–äº§å“ç”µè¯å·ç æ˜¾ç¤º
        function formatProductPhone(product, index) {
            var isOwnProduct = currentUser && product.contact === currentUser.username;
            if (isOwnProduct) {
                return product.phone;
            }
            
            var contactKey = 'product_' + index;
            var hasPaid = paidContacts.some(function(contact) {
                return contact.key === contactKey && contact.username === currentUser.username;
            });
            
            if (hasPaid || !currentUser) {
                return product.phone;
            } else {
                return product.phone.substring(0, 3) + '****' + product.phone.substring(7) + 
                       ' <button class="reveal-phone-btn" onclick="showPaymentModal(\'product\', ' + index + ')">æŸ¥çœ‹</button>';
            }
        }
        
        // æ ¼å¼åŒ–å•†æœºç”µè¯å·ç æ˜¾ç¤º
        function formatBusinessPhone(business, index) {
            var isOwnBusiness = currentUser && business.contact === currentUser.username;
            if (isOwnBusiness) {
                return business.phone;
            }
            
            var contactKey = 'business_' + index;
            var hasPaid = paidContacts.some(function(contact) {
                return contact.key === contactKey && contact.username === currentUser.username;
            });
            
            if (hasPaid || !currentUser) {
                return business.phone;
            } else {
                return business.phone.substring(0, 3) + '****' + business.phone.substring(7) + 
                       ' <button class="reveal-phone-btn" onclick="showPaymentModal(\'business\', ' + index + ')">æŸ¥çœ‹</button>';
            }
        }
        
        // æ˜¾ç¤ºä»˜è´¹æŸ¥çœ‹æ¨¡æ€æ¡†
        function showPaymentModal(type, index) {
            currentViewingType = type;
            currentViewingIndex = index;
            document.getElementById('payment-modal').style.display = 'flex';
        }
        
        // æ¨¡æ‹Ÿæ”¯ä»˜åŠŸèƒ½
        function simulatePayment() {
            if (!currentUser) {
                alert('è¯·å…ˆç™»å½•åå†æŸ¥çœ‹è”ç³»æ–¹å¼ï¼');
                hidePaymentModal();
                showAuthModal();
                return;
            }
            
            var user = users.find(function(u) { return u.username === currentUser.username; });
            if (!user) {
                alert('ç”¨æˆ·ä¿¡æ¯é”™è¯¯ï¼Œè¯·é‡æ–°ç™»å½•ï¼');
                return;
            }
            
            if (user.balance < 0.20) {
                alert('ä½™é¢ä¸è¶³ï¼è¯·è”ç³»ç®¡ç†å‘˜å……å€¼ã€‚');
                hidePaymentModal();
                return;
            }
            
            // æ‰£é™¤è´¹ç”¨
            user.balance -= 0.20;
            localStorage.setItem('users', JSON.stringify(users));
            
            // è®°å½•ä»˜è´¹æŸ¥çœ‹
            var contactKey = currentViewingType + '_' + currentViewingIndex;
            paidContacts.push({
                username: currentUser.username,
                key: contactKey,
                time: new Date().toLocaleString(),
                amount: 0.20
            });
            localStorage.setItem('paidContacts', JSON.stringify(paidContacts));
            
            alert('æ”¯ä»˜æˆåŠŸï¼è”ç³»æ–¹å¼å·²æ˜¾ç¤ºã€‚');
            hidePaymentModal();
            
            // åˆ·æ–°æ˜¾ç¤º
            displayAllInfo();
        }
        
        // æœç´¢æ‰€æœ‰ä¿¡æ¯
        function searchAll() {
            var searchTerm = document.getElementById('search-input').value.toLowerCase();
            
            if (!searchTerm) {
                displayAllInfo();
                return;
            }
            
            // æœç´¢å¹¶æ˜¾ç¤ºç»“æœ
            searchAndDisplayRides(searchTerm);
            searchAndDisplayProducts(searchTerm);
            searchAndDisplayBusinesses(searchTerm);
        }
        
        // æœç´¢å¹¶æ˜¾ç¤ºè¡Œç¨‹
        function searchAndDisplayRides(searchTerm) {
            var ridesContainer = document.getElementById('rides-container');
            var allRides = [];
            
            if (rides.length > 0) {
                allRides = allRides.concat(rides);
            }
            if (passengers.length > 0) {
                allRides = allRides.concat(passengers);
            }
            
            var searchResults = allRides.filter(function(ride) {
                return [ride.departure, ride.destination, ride.name, ride.notes].some(function(field) {
                    return field && field.toLowerCase().includes(searchTerm);
                });
            });
            
            displaySearchResults(ridesContainer, searchResults, 'é¡ºé£è½¦', 'ğŸš—');
        }
        
        // æœç´¢å¹¶æ˜¾ç¤ºäº§å“
        function searchAndDisplayProducts(searchTerm) {
            var productsContainer = document.getElementById('products-container');
            var searchResults = products.filter(function(product) {
                return [product.name, product.location, product.description, product.contact].some(function(field) {
                    return field && field.toLowerCase().includes(searchTerm);
                });
            });
            
            displaySearchResults(productsContainer, searchResults, 'å†œå‰¯äº§å“', 'ğŸŒ¾');
        }
        
        // æœç´¢å¹¶æ˜¾ç¤ºå•†æœº
        function searchAndDisplayBusinesses(searchTerm) {
            var businessesContainer = document.getElementById('businesses-container');
            var searchResults = businesses.filter(function(business) {
                return [business.title, business.location, business.description, business.contact].some(function(field) {
                    return field && field.toLowerCase().includes(searchTerm);
                });
            });
            
            displaySearchResults(businessesContainer, searchResults, 'å•†æœºä¿¡æ¯', 'ğŸ’¼');
        }
        
        // æ˜¾ç¤ºæœç´¢ç»“æœ
        function displaySearchResults(container, results, typeName, icon) {
            if (results.length === 0) {
                container.innerHTML = '<div class="no-rides"><p style="font-size: 2rem; margin-bottom: 10px;">' + icon + '</p><p>æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„' + typeName + 'ä¿¡æ¯</p></div>';
                return;
            }
            
            // è°ƒç”¨ç›¸åº”çš„æ˜¾ç¤ºå‡½æ•°æ¥æ˜¾ç¤ºç»“æœ
            if (container.id === 'rides-container') {
                // ä¸´æ—¶ä¿å­˜åŸå§‹æ•°æ®å¹¶æ˜¾ç¤ºæœç´¢ç»“æœ
                var originalRides = rides;
                var originalPassengers = passengers;
                rides = results.filter(function(r) { return r.type === 'car-find-passenger'; });
                passengers = results.filter(function(r) { return r.type === 'passenger-find-car'; });
                displayRides();
                rides = originalRides;
                passengers = originalPassengers;
            } else if (container.id === 'products-container') {
                var originalProducts = products;
                products = results;
                displayProducts();
                products = originalProducts;
            } else if (container.id === 'businesses-container') {
                var originalBusinesses = businesses;
                businesses = results;
                displayBusinesses();
                businesses = originalBusinesses;
            }
        }
    </script>
</body>
</html>
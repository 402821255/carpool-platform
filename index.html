<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¹˜Mä¿¡æ¯å‘å¸ƒå¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: #ff5100;
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 5px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .announcement-bar {
            background: linear-gradient(135deg, #ff8a00, #ff5100);
            color: white;
            padding: 10px 0;
            margin-bottom: 20px;
            overflow: hidden;
            border-radius: 25px;
            box-shadow: 0 2px 10px rgba(255, 81, 0, 0.3);
        }
        
        .announcement-content {
            display: flex;
            align-items: center;
            white-space: nowrap;
            animation: scroll-left 20s linear infinite;
        }
        
        .announcement-content:hover {
            animation-play-state: paused;
        }
        
        .announcement-icon {
            margin-right: 15px;
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .announcement-text {
            font-size: 1rem;
            font-weight: 500;
            padding-right: 50px;
        }
        
        .edit-announcement-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            cursor: pointer;
            margin-left: auto;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        
        .edit-announcement-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .announcement-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        .announcement-modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .announcement-modal h3 {
            color: #ff5100;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .announcement-textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
            resize: vertical;
            margin-bottom: 15px;
        }
        
        .announcement-textarea:focus {
            outline: none;
            border-color: #ff5100;
            box-shadow: 0 0 0 3px rgba(255, 81, 0, 0.1);
        }
        
        @keyframes scroll-left {
            0% {
                transform: translateX(100%);
            }
            100% {
                transform: translateX(-100%);
            }
        }
        
        .tabs {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            gap: 5px;
        }
        
        .tab {
            padding: 10px 16px;
            cursor: pointer;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 2px solid #dee2e6;
            border-bottom: none;
            border-radius: 12px 12px 0 0;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        
        .tab:hover {
            background: linear-gradient(135deg, #fff5f0, #ffe8d6);
            border-color: #ffccbc;
            transform: translateY(-1px);
        }
        
        .tab.active {
            background: linear-gradient(135deg, #ff5100, #ff6b35);
            color: white;
            border-color: #ff5100;
            margin-bottom: -2px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(255, 81, 0, 0.3);
        }
        
        .tab-content {
            display: none;
            background-color: white;
            padding: 20px;
            border-radius: 0 5px 5px 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .tab-content.active {
            display: block;
        }
        
        form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        button {
            background: linear-gradient(135deg, #ff6b35, #ff5100);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 81, 0, 0.3);
        }
        
        button:hover {
            background: linear-gradient(135deg, #ff5100, #e64a00);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 81, 0, 0.4);
        }
        
        .search-form {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
        }
        
        .search-form input {
            flex: 1;
            padding: 12px 16px;
            font-size: 1rem;
            border: 2px solid #ddd;
            border-radius: 25px;
            transition: border-color 0.3s ease;
            min-width: 300px;
        }
        
        .search-form input:focus {
            outline: none;
            border-color: #ff5100;
            box-shadow: 0 0 0 3px rgba(255, 81, 0, 0.1);
        }
        
        .search-form button {
            padding: 12px 24px;
            font-size: 0.95rem;
            white-space: nowrap;
            min-width: auto;
            flex-shrink: 0;
        }
        
        .rides-list {
            display: grid;
            gap: 15px;
        }
        
        .ride-card {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .ride-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .no-rides {
            text-align: center;
            padding: 40px;
            color: #777;
        }
        
        footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 20px 0;
            margin-top: 40px;
            border-top: 3px solid #ff5100;
        }
        
        footer p {
            margin: 0;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* ç”¨æˆ·ç³»ç»Ÿæ ·å¼ */
        .user-info {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px 15px;
            border-radius: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-info.guest {
            background: #f8f9fa;
        }

        .user-info.logged-in {
            background: linear-gradient(135deg, #ff5100, #ff6b35);
            color: white;
        }

        .user-btn {
            background: #ff5100;
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .user-btn:hover {
            background: #e64a00;
            transform: scale(1.05);
        }

        .user-btn.logout {
            background: #dc3545;
            margin-left: 5px;
        }

        .user-btn.logout:hover {
            background: #c82333;
        }

        /* ä»˜è´¹æŸ¥çœ‹åŠŸèƒ½æ ·å¼ */
        .phone-hidden {
            color: #999;
            font-style: italic;
        }

        .reveal-phone-btn {
            background: linear-gradient(135deg, #20c997, #1ea085);
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-left: 10px;
            transition: all 0.3s ease;
        }

        .reveal-phone-btn:hover {
            background: linear-gradient(135deg, #1ea085, #1a8c77);
            transform: translateY(-1px);
        }

        .payment-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .payment-modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
        }

        .payment-modal h3 {
            color: #ff5100;
            margin-bottom: 20px;
        }

        .payment-price {
            font-size: 2rem;
            color: #ff5100;
            font-weight: bold;
            margin: 15px 0;
        }

        .payment-btn {
            background: linear-gradient(135deg, #20c997, #1ea085);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .payment-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(32, 201, 151, 0.3);
        }

        .cancel-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            margin-top: 10px;
        }

        /* ç”¨æˆ·æ³¨å†Œ/ç™»å½•è¡¨å•æ ·å¼ */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .auth-modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .auth-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-bottom: none;
        }

        .auth-tab.active {
            background: #ff5100;
            color: white;
            border-color: #ff5100;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        /* ç®¡ç†å‘˜åŠŸèƒ½æ ·å¼ */
        .admin-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            padding: 20px;
            z-index: 999;
            display: none;
            min-width: 350px;
            max-height: 600px;
            overflow-y: auto;
        }

        .admin-panel.show {
            display: block;
        }

        .admin-header {
            background: linear-gradient(135deg, #ff5100, #ff6b35);
            color: white;
            padding: 15px;
            border-radius: 10px 10px 0 0;
            margin: -20px -20px 20px -20px;
            text-align: center;
        }

        .admin-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .admin-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .admin-section h4 {
            color: #ff5100;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .recharge-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .recharge-form input, .recharge-form select {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .recharge-form input:focus, .recharge-form select:focus {
            outline: none;
            border-color: #ff5100;
        }

        .admin-btn {
            background: linear-gradient(135deg, #20c997, #1ea085);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .admin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(32, 201, 151, 0.3);
        }

        .admin-btn.danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }

        .user-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .user-item {
            padding: 8px 12px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
        }

        .user-item:last-child {
            border-bottom: none;
        }

        .user-item:hover {
            background: white;
        }

        .balance-info {
            color: #20c997;
            font-weight: 600;
        }

        /* åˆ†äº«åŠŸèƒ½æ ·å¼ */
        .share-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .share-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .share-amount {
            color: #28a745;
            font-size: 1.2rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .share-status {
            font-size: 0.85rem;
            color: #666;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ -->
    <div class="user-info" id="user-info">
        <span id="user-status">æ¸¸å®¢æ¨¡å¼</span>
        <button class="user-btn" onclick="showAuthModal()">ç™»å½•/æ³¨å†Œ</button>
    </div>

    <!-- ç®¡ç†å‘˜é¢æ¿ -->
    <div class="admin-panel" id="admin-panel">
        <div class="admin-header">
            <h3>ğŸ”§ ç®¡ç†å‘˜æ§åˆ¶å°</h3>
        </div>
        
        <!-- ç”¨æˆ·å……å€¼ç®¡ç† -->
        <div class="admin-section">
            <h4>ğŸ’° ç”¨æˆ·å……å€¼ç®¡ç†</h4>
            <div class="recharge-form">
                <select id="recharge-username" placeholder="é€‰æ‹©ç”¨æˆ·">
                    <option value="">è¯·é€‰æ‹©ç”¨æˆ·</option>
                </select>
                <input type="number" id="recharge-amount" placeholder="å……å€¼é‡‘é¢ï¼ˆå…ƒï¼‰" min="0.01" step="0.01">
                <input type="text" id="recharge-note" placeholder="å……å€¼å¤‡æ³¨ï¼ˆå¦‚ï¼šçº¿ä¸‹æ‰“æ¬¾ï¼‰">
                <button class="admin-btn" onclick="adminRecharge()">ç¡®è®¤å……å€¼</button>
            </div>
        </div>

        <!-- ç”¨æˆ·ä½™é¢æŸ¥çœ‹ -->
        <div class="admin-section">
            <h4>ğŸ‘¥ ç”¨æˆ·ä½™é¢æŸ¥çœ‹</h4>
            <div class="user-list" id="admin-user-list">
                <!-- ç”¨æˆ·åˆ—è¡¨å°†åŠ¨æ€åŠ è½½ -->
            </div>
        </div>

        <!-- åˆ†äº«å¥–åŠ±è®°å½• -->
        <div class="admin-section">
            <h4>ğŸ“± åˆ†äº«å¥–åŠ±è®°å½•</h4>
            <div class="user-list" id="share-records">
                <!-- åˆ†äº«è®°å½•å°†åŠ¨æ€åŠ è½½ -->
            </div>
        </div>

        <!-- å…³é—­é¢æ¿ -->
        <div style="text-align: center; margin-top: 20px;">
            <button class="admin-btn danger" onclick="hideAdminPanel()">å…³é—­é¢æ¿</button>
        </div>
    </div>
    
    <div class="container">
        <header>
            <h1>æ¹˜Mä¿¡æ¯å‘å¸ƒå¹³å°</h1>
            <p class="subtitle">ç»¿è‰²å‡ºè¡Œ Â· å†œäº§æµé€š Â· å•†æœºå¯¹æ¥ Â· ä¾¿åˆ©ç”Ÿæ´»</p>
        </header>
        
        <div class="announcement-bar">
            <div class="announcement-content">
                <span class="announcement-icon">ğŸ“¢</span>
                <span class="announcement-text" id="announcement-text">æ¬¢è¿ä½¿ç”¨æ¹˜Mä¿¡æ¯å‘å¸ƒå¹³å°ï¼è½¦æ‰¾äººã€äººæ‰¾è½¦ï¼Œä¾¿æ·å‡ºè¡Œï¼Œç»¿è‰²ç¯ä¿ï¼</span>
                <button class="edit-announcement-btn" onclick="showPasswordModal()">
                    <i>âœï¸</i> ç¼–è¾‘å…¬å‘Š
                </button>
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab" onclick="switchTab('publish')">è½¦æ‰¾äºº</div>
            <div class="tab" onclick="switchTab('find-car')">äººæ‰¾è½¦</div>
            <div class="tab active" onclick="switchTab('find')">æŸ¥æ‰¾è¡Œç¨‹</div>
            <div class="tab" onclick="switchTab('products')">å†œå‰¯äº§å“</div>
            <div class="tab" onclick="switchTab('business')">å•†æœºå‘å¸ƒ</div>
            <div class="tab" onclick="switchTab('my-rides')">æˆ‘çš„è¡Œç¨‹</div>
            <div class="tab" onclick="switchTab('share')">åˆ†äº«èµšå¥–åŠ±</div>
        </div>
        
        <div id="publish" class="tab-content">
            <h2>å‘å¸ƒè½¦æ‰¾äººä¿¡æ¯</h2>
            <p>å‘å¸ƒæ‚¨çš„é¡ºé£è½¦ä¿¡æ¯ï¼Œå¯»æ‰¾åŒè¡Œçš„ä¹˜å®¢ã€‚</p>
            <form onsubmit="publishRide(event)">
                <div class="form-group">
                    <label for="departure">å‡ºå‘åœ°</label>
                    <input type="text" id="departure" placeholder="ä¾‹å¦‚: ç‹å®¶æ‘æ‘å§”ä¼š" required>
                </div>
                
                <div class="form-group">
                    <label for="destination">ç›®çš„åœ°</label>
                    <input type="text" id="destination" placeholder="ä¾‹å¦‚: å¿åŸæ±½è½¦ç«™" required>
                </div>
                
                <div class="form-group">
                    <label for="date">å‡ºå‘æ—¥æœŸ</label>
                    <input type="date" id="date" required>
                </div>
                
                <div class="form-group">
                    <label for="time">å‡ºå‘æ—¶é—´</label>
                    <input type="time" id="time" required>
                </div>
                
                <div class="form-group">
                    <label for="seats">å¯ç”¨åº§ä½</label>
                    <select id="seats" required>
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="1">1ä¸ªåº§ä½</option>
                        <option value="2">2ä¸ªåº§ä½</option>
                        <option value="3">3ä¸ªåº§ä½</option>
                        <option value="4">4ä¸ªåº§ä½</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="price">æ¯äººè´¹ç”¨</label>
                    <input type="number" id="price" placeholder="ä¾‹å¦‚: 10" required>
                </div>
                
                <div class="form-group full-width">
                    <label for="notes">å¤‡æ³¨ä¿¡æ¯</label>
                    <textarea id="notes" rows="3" placeholder="ä¾‹å¦‚: åå¤‡ç®±ç©ºé—´æœ‰é™ï¼Œå¤§ä»¶è¡Œæè¯·æå‰å‘ŠçŸ¥"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="name">è”ç³»äºº</label>
                    <input type="text" id="name" placeholder="æ‚¨çš„å§“å" required>
                </div>
                
                <div class="form-group">
                    <label for="phone">è”ç³»ç”µè¯</label>
                    <input type="tel" id="phone" placeholder="æ‚¨çš„æ‰‹æœºå·ç " required>
                </div>
                
                <div class="form-group full-width">
                    <button type="submit">å‘å¸ƒè½¦æ‰¾äººä¿¡æ¯</button>
                </div>
            </form>
        </div>
        
        <div id="find-car" class="tab-content">
            <h2>å‘å¸ƒäººæ‰¾è½¦ä¿¡æ¯</h2>
            <p>å‘å¸ƒæ‚¨çš„ä¹˜è½¦éœ€æ±‚ï¼Œå¯»æ‰¾åˆé€‚çš„é¡ºé£è½¦ã€‚</p>
            <form onsubmit="publishPassenger(event)">
                <div class="form-group">
                    <label for="passenger-departure">å‡ºå‘åœ°</label>
                    <input type="text" id="passenger-departure" placeholder="ä¾‹å¦‚: æå®¶æ‘å°å­¦" required>
                </div>
                
                <div class="form-group">
                    <label for="passenger-destination">ç›®çš„åœ°</label>
                    <input type="text" id="passenger-destination" placeholder="ä¾‹å¦‚: å¿åŸåŒ»é™¢" required>
                </div>
                
                <div class="form-group">
                    <label for="passenger-date">å‡ºå‘æ—¥æœŸ</label>
                    <input type="date" id="passenger-date" required>
                </div>
                
                <div class="form-group">
                    <label for="passenger-time">å‡ºå‘æ—¶é—´</label>
                    <input type="time" id="passenger-time" required>
                </div>
                
                <div class="form-group">
                    <label for="passenger-count">ä¹˜è½¦äººæ•°</label>
                    <select id="passenger-count" required>
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="1">1äºº</option>
                        <option value="2">2äºº</option>
                        <option value="3">3äºº</option>
                        <option value="4">4äºº</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="passenger-budget">é¢„ç®—è´¹ç”¨</label>
                    <input type="number" id="passenger-budget" placeholder="ä¾‹å¦‚: 15" required>
                </div>
                
                <div class="form-group full-width">
                    <label for="passenger-notes">ç‰¹åˆ«éœ€æ±‚</label>
                    <textarea id="passenger-notes" rows="3" placeholder="ä¾‹å¦‚: æœ‰å„¿ç«¥åº§æ¤…éœ€æ±‚ï¼Œæœ‰å¤§ä»¶è¡Œæ"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="passenger-name">è”ç³»äºº</label>
                    <input type="text" id="passenger-name" placeholder="æ‚¨çš„å§“å" required>
                </div>
                
                <div class="form-group">
                    <label for="passenger-phone">è”ç³»ç”µè¯</label>
                    <input type="tel" id="passenger-phone" placeholder="æ‚¨çš„æ‰‹æœºå·ç " required>
                </div>
                
                <div class="form-group full-width">
                    <button type="submit">å‘å¸ƒäººæ‰¾è½¦ä¿¡æ¯</button>
                </div>
            </form>
        </div>
        
        <div id="find" class="tab-content active">
            <h2>æŸ¥æ‰¾é¡ºé£è½¦</h2>
            
            <div class="search-form">
                <input type="text" id="search-input" placeholder="æœç´¢å‡ºå‘åœ°æˆ–ç›®çš„åœ°..." onkeypress="if(event.keyCode==13) searchRides()">
                <button onclick="searchRides()">ğŸ” æœç´¢</button>
            </div>
            
            <div id="rides-container">
                <div class="no-rides">
                    <p style="font-size: 3rem; margin-bottom: 15px;">ğŸš—</p>
                    <p>æš‚æ— å¯ç”¨è¡Œç¨‹ï¼Œè¯·ç¨åå†è¯•æˆ–å‘å¸ƒæ‚¨çš„è¡Œç¨‹</p>
                </div>
            </div>
        </div>
        
        <div id="products" class="tab-content">
            <h2>ğŸŒ¾ å†œå‰¯äº§å“å‘å¸ƒ</h2>
            <p>å‘å¸ƒæ‚¨çš„å†œå‰¯äº§å“ä¿¡æ¯ï¼Œæ‹“å±•é”€å”®æ¸ é“ï¼Œä¿ƒè¿›å†œäº§å“æµé€šã€‚</p>
            <form onsubmit="publishProduct(event)">
                <div class="form-group">
                    <label for="product-name">äº§å“åç§°</label>
                    <input type="text" id="product-name" placeholder="ä¾‹å¦‚: åœŸé¸¡è›‹ã€æ–°é²œè”¬èœã€æ‰‹å·¥è±†è…" required>
                </div>
                
                <div class="form-group">
                    <label for="product-category">äº§å“ç±»åˆ«</label>
                    <select id="product-category" required>
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="vegetables">æ–°é²œè”¬èœ</option>
                        <option value="fruits">æ—¶ä»¤æ°´æœ</option>
                        <option value="grains">ç²®é£Ÿæ‚ç²®</option>
                        <option value="livestock">ç¦½ç•œäº§å“</option>
                        <option value="aquatic">æ°´äº§æµ·é²œ</option>
                        <option value="processed">åŠ å·¥é£Ÿå“</option>
                        <option value="handmade">æ‰‹å·¥åˆ¶å“</option>
                        <option value="other">å…¶ä»–äº§å“</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="product-quantity">ä¾›åº”æ•°é‡</label>
                    <input type="text" id="product-quantity" placeholder="ä¾‹å¦‚: 50æ–¤ã€20ä¸ªã€100å…¬æ–¤" required>
                </div>
                
                <div class="form-group">
                    <label for="product-price">é¢„æœŸä»·æ ¼</label>
                    <input type="text" id="product-price" placeholder="ä¾‹å¦‚: 5å…ƒ/æ–¤ã€120å…ƒ/ç®±" required>
                </div>
                
                <div class="form-group">
                    <label for="product-location">äº§å“äº§åœ°</label>
                    <input type="text" id="product-location" placeholder="ä¾‹å¦‚: ç‹å®¶æ‘ç”Ÿæ€å†œåœº" required>
                </div>
                
                <div class="form-group">
                    <label for="product-harvest">é‡‡æ”¶æ—¶é—´</label>
                    <input type="date" id="product-harvest" required>
                </div>
                
                <div class="form-group">
                    <label for="product-quality">å“è´¨ç­‰çº§</label>
                    <select id="product-quality" required>
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="organic">æœ‰æœºè®¤è¯</option>
                        <option value="green">ç»¿è‰²æ— å…¬å®³</option>
                        <option value="ecological">ç”Ÿæ€ç§æ¤</option>
                        <option value="traditional">ä¼ ç»Ÿç§æ¤</option>
                        <option value="standard">å¸¸è§„æ ‡å‡†</option>
                    </select>
                </div>
                
                <div class="form-group full-width">
                    <label for="product-description">äº§å“æè¿°</label>
                    <textarea id="product-description" rows="3" placeholder="è¯·è¯¦ç»†æè¿°äº§å“ç‰¹ç‚¹ã€ç§æ¤æ–¹å¼ã€è¥å…»ä»·å€¼ç­‰ä¿¡æ¯..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="product-contact">è”ç³»äºº</label>
                    <input type="text" id="product-contact" placeholder="æ‚¨çš„å§“å" required>
                </div>
                
                <div class="form-group">
                    <label for="product-phone">è”ç³»ç”µè¯</label>
                    <input type="tel" id="product-phone" placeholder="æ‚¨çš„æ‰‹æœºå·ç " required>
                </div>
                
                <div class="form-group">
                    <label for="product-wechat">å¾®ä¿¡å·ï¼ˆé€‰å¡«ï¼‰</label>
                    <input type="text" id="product-wechat" placeholder="ä¾¿äºå®¢æˆ·å¾®ä¿¡è”ç³»">
                </div>
                
                <div class="form-group full-width">
                    <button type="submit">ğŸŒ¾ å‘å¸ƒå†œå‰¯äº§å“</button>
                </div>
            </form>
        </div>
        
        <div id="business" class="tab-content">
            <h2>ğŸ’¼ å•†æœºå‘å¸ƒ</h2>
            <p>å‘å¸ƒå•†ä¸šåˆä½œä¿¡æ¯ã€æ‹›å•†ä¿¡æ¯ã€æ±‚èŒæ‹›è˜ç­‰å•†ä¸šæœºä¼šã€‚</p>
            <form onsubmit="publishBusiness(event)">
                <div class="form-group">
                    <label for="business-title">å•†æœºæ ‡é¢˜</label>
                    <input type="text" id="business-title" placeholder="ä¾‹å¦‚: å¯»æ‰¾åˆä½œä¼™ä¼´ã€åº—é“ºè½¬è®©ã€è®¾å¤‡è½¬è®©" required>
                </div>
                
                <div class="form-group">
                    <label for="business-type">å•†æœºç±»å‹</label>
                    <select id="business-type" required>
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="cooperation">å•†ä¸šåˆä½œ</option>
                        <option value="investment">æŠ•èµ„æ‹›å•†</option>
                        <option value="transfer">åº—é“ºè½¬è®©</option>
                        <option value="equipment">è®¾å¤‡è½¬è®©</option>
                        <option value="recruitment">æ‹›è˜æ±‚èŒ</option>
                        <option value="procurement">é‡‡è´­éœ€æ±‚</option>
                        <option value="service">æœåŠ¡æä¾›</option>
                        <option value="other">å…¶ä»–å•†æœº</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="business-investment">æŠ•èµ„é‡‘é¢</label>
                    <select id="business-investment" required>
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="small">1ä¸‡å…ƒä»¥ä¸‹</option>
                        <option value="medium">1-5ä¸‡å…ƒ</option>
                        <option value="large">5-10ä¸‡å…ƒ</option>
                        <option value="xlarge">10ä¸‡å…ƒä»¥ä¸Š</option>
                        <option value="negotiable">é¢è®®</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="business-location">æ‰€åœ¨åœ°åŒº</label>
                    <input type="text" id="business-location" placeholder="ä¾‹å¦‚: æŸæŸä¹¡é•‡ã€æŸæŸå¿åŸ" required>
                </div>
                
                <div class="form-group">
                    <label for="business-expiry">æœ‰æ•ˆæœŸé™</label>
                    <input type="date" id="business-expiry" required>
                </div>
                
                <div class="form-group">
                    <label for="business-urgency">ç´§æ€¥ç¨‹åº¦</label>
                    <select id="business-urgency" required>
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="urgent">ç´§æ€¥</option>
                        <option value="normal">ä¸€èˆ¬</option>
                        <option value="relaxed">ä¸æ€¥</option>
                    </select>
                </div>
                
                <div class="form-group full-width">
                    <label for="business-description">è¯¦ç»†è¯´æ˜</label>
                    <textarea id="business-description" rows="4" placeholder="è¯·è¯¦ç»†æè¿°å•†æœºå†…å®¹ã€åˆä½œæ¡ä»¶ã€å…·ä½“è¦æ±‚ç­‰ä¿¡æ¯..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="business-contact">è”ç³»äºº</label>
                    <input type="text" id="business-contact" placeholder="æ‚¨çš„å§“åæˆ–å…¬å¸åç§°" required>
                </div>
                
                <div class="form-group">
                    <label for="business-phone">è”ç³»ç”µè¯</label>
                    <input type="tel" id="business-phone" placeholder="æ‚¨çš„æ‰‹æœºå·ç " required>
                </div>
                
                <div class="form-group">
                    <label for="business-email">é‚®ç®±åœ°å€</label>
                    <input type="email" id="business-email" placeholder="ä¾¿äºå‘é€è¯¦ç»†èµ„æ–™">
                </div>
                
                <div class="form-group full-width">
                    <button type="submit">ğŸ’¼ å‘å¸ƒå•†æœºä¿¡æ¯</button>
                </div>
            </form>
        </div>
        
        <div id="my-rides" class="tab-content">
            <h2>æˆ‘çš„è¡Œç¨‹</h2>
            <div id="my-rides-container">
                <div class="no-rides">
                    <p style="font-size: 3rem; margin-bottom: 15px;">ğŸ‘¤</p>
                    <p>æ‚¨è¿˜æ²¡æœ‰å‘å¸ƒè¿‡è¡Œç¨‹</p>
                </div>
            </div>
        </div>

        <div id="share" class="tab-content">
            <h2>ğŸ“± åˆ†äº«èµšå¥–åŠ±</h2>
            <p>åˆ†äº«å¹³å°åˆ°å¾®ä¿¡ç¾¤æˆ–æœ‹å‹åœˆï¼Œæ¯æ—¥å‰5æ¬¡åˆ†äº«å¯è·å¾—å¥–åŠ±ï¼</p>
            
            <div class="share-section">
                <div style="font-size: 1.2rem; margin-bottom: 20px; color: #333;">
                    <strong>ğŸŒŸ åˆ†äº«å¥–åŠ±è§„åˆ™</strong><br>
                    <span style="font-size: 0.9rem; color: #666;">
                        â€¢ åˆ†äº«åˆ°å¾®ä¿¡ç¾¤ï¼šå¥–åŠ± Â¥0.10<br>
                        â€¢ åˆ†äº«åˆ°æœ‹å‹åœˆï¼šå¥–åŠ± Â¥0.10<br>
                        â€¢ æ¯æ—¥å‰5æ¬¡åˆ†äº«æœ‰æ•ˆè®¡è´¹<br>
                        â€¢ æ¯æ—¥æœ€å¤šå¯è·å¾— Â¥0.50 å¥–åŠ±<br>
                        â€¢ è¶…è¿‡5æ¬¡ååˆ†äº«æ— å¥–åŠ±
                    </span>
                </div>
                
                <div style="margin: 20px 0;">
                    <button class="share-btn" onclick="shareToWechat()">
                        ğŸ“‹ å¤åˆ¶é“¾æ¥åˆ†äº«åˆ°å¾®ä¿¡ç¾¤
                    </button>
                    <button class="share-btn" onclick="shareToMoments()">
                        ğŸ“· åˆ†äº«åˆ°æœ‹å‹åœˆ
                    </button>
                </div>
                
                <div class="share-amount">
                    ä»Šæ—¥å·²èµšï¼šÂ¥<span id="today-share-amount">0.00</span>
                </div>
                
                <div style="font-size: 0.9rem; color: #666; margin: 10px 0;">
                    åˆ†äº«æ¬¡æ•°ï¼š<span id="today-share-count">0/5</span>ï¼ˆå‰5æ¬¡æœ‰æ•ˆï¼‰
                </div>
                
                <div class="share-status" id="share-status">
                    åˆ†äº«æˆåŠŸåå¥–åŠ±å°†è‡ªåŠ¨åˆ°è´¦
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <p>Â© 2025 æ¹˜Mé¡ºé£è½¦å‘å¸ƒå¹³å° | ç»¿è‰²å‡ºè¡Œ Â· å…±äº«èµ„æº Â· ä¾¿åˆ©ç”Ÿæ´»</p>
        </div>
    </footer>

    <!-- å¯†ç éªŒè¯æ¨¡æ€æ¡† -->
    <div class="announcement-modal" id="password-modal">
        <div class="announcement-modal-content">
            <h3>ğŸ” ç®¡ç†å‘˜éªŒè¯</h3>
            <p style="margin-bottom: 15px; text-align: center; color: #666;">è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ä»¥ç¼–è¾‘å…¬å‘Š</p>
            <input type="password" class="announcement-textarea" id="password-input" placeholder="è¯·è¾“å…¥å¯†ç ..." style="min-height: auto;" onkeypress="if(event.keyCode==13) verifyPassword()">
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button onclick="hidePasswordModal()" style="background: #6c757d;">å–æ¶ˆ</button>
                <button onclick="verifyPassword()">éªŒè¯</button>
            </div>
        </div>
    </div>

    <!-- ç”¨æˆ·è®¤è¯æ¨¡æ€æ¡† -->
    <div class="auth-modal" id="auth-modal">
        <div class="auth-modal-content">
            <h3>ğŸ‘¤ ç”¨æˆ·ä¸­å¿ƒ</h3>
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="switchAuthTab('login')">ç™»å½•</div>
                <div class="auth-tab" onclick="switchAuthTab('register')">æ³¨å†Œ</div>
            </div>
            
            <!-- ç™»å½•è¡¨å• -->
            <div class="auth-form active" id="login-form">
                <div class="form-group">
                    <label for="login-username">ç”¨æˆ·å</label>
                    <input type="text" id="login-username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required>
                </div>
                <div class="form-group">
                    <label for="login-password">å¯†ç </label>
                    <input type="password" id="login-password" placeholder="è¯·è¾“å…¥å¯†ç " required>
                </div>
                <div class="form-group">
                    <button type="button" class="user-btn" onclick="login()">ç™»å½•</button>
                </div>
            </div>
            
            <!-- æ³¨å†Œè¡¨å• -->
            <div class="auth-form" id="register-form">
                <div class="form-group">
                    <label for="register-username">ç”¨æˆ·å</label>
                    <input type="text" id="register-username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required>
                </div>
                <div class="form-group">
                    <label for="register-password">å¯†ç </label>
                    <input type="password" id="register-password" placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰" required>
                </div>
                <div class="form-group">
                    <label for="register-phone">æ‰‹æœºå·</label>
                    <input type="tel" id="register-phone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" required>
                </div>
                <div class="form-group">
                    <button type="button" class="user-btn" onclick="register()">æ³¨å†Œ</button>
                </div>
            </div>
            
            <div style="margin-top: 15px; text-align: center;">
                <button class="cancel-btn" onclick="hideAuthModal()">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- ä»˜è´¹æŸ¥çœ‹æ¨¡æ€æ¡† -->
    <div class="payment-modal" id="payment-modal">
        <div class="payment-modal-content">
            <h3>ğŸ’° æŸ¥çœ‹è”ç³»æ–¹å¼</h3>
            <p>æŸ¥çœ‹è”ç³»æ–¹å¼éœ€è¦æ”¯ä»˜è´¹ç”¨</p>
            <div class="payment-price">Â¥0.20</div>
            <p style="color: #666; font-size: 0.9rem;">æ”¯ä»˜åå¯æŸ¥çœ‹å®Œæ•´ç”µè¯å·ç å¹¶ç›´æ¥æ‹¨æ‰“</p>
            
            <div style="margin: 20px 0;">
                <button class="payment-btn" onclick="simulatePayment()">ç«‹å³æ”¯ä»˜</button>
            </div>
            
            <button class="cancel-btn" onclick="hidePaymentModal()">å–æ¶ˆ</button>
        </div>
    </div>

    <!-- å…¬å‘Šç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="announcement-modal" id="announcement-modal">
        <div class="announcement-modal-content">
            <h3>ğŸ“¢ ç¼–è¾‘å…¬å‘Šå†…å®¹</h3>
            <textarea class="announcement-textarea" id="announcement-textarea" placeholder="è¯·è¾“å…¥å…¬å‘Šå†…å®¹..."></textarea>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button onclick="hideAnnouncementModal()" style="background: #6c757d;">å–æ¶ˆ</button>
                <button onclick="saveAnnouncement()">ä¿å­˜å…¬å‘Š</button>
            </div>
        </div>
    </div>

    <script>
        // æ•°æ®å­˜å‚¨
        var rides = [];
        var passengers = [];
        var products = [];
        var businesses = [];
        
        // ç”¨æˆ·ç³»ç»Ÿ
        var currentUser = null;
        var users = [];
        var paidContacts = []; // å­˜å‚¨å·²ä»˜è´¹æŸ¥çœ‹çš„è”ç³»æ–¹å¼
        var shareRecords = []; // å­˜å‚¨åˆ†äº«å¥–åŠ±è®°å½•
        var adminUsers = ['admin']; // ç®¡ç†å‘˜ç”¨æˆ·åˆ—è¡¨
        
        // å½“å‰è¦æŸ¥çœ‹çš„è”ç³»æ–¹å¼
        var currentViewingRide = null;
        var currentViewingType = null;
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabId) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            var tabContents = document.querySelectorAll('.tab-content');
            for (var i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            // å–æ¶ˆæ‰€æœ‰æ ‡ç­¾çš„æ´»åŠ¨çŠ¶æ€
            var tabs = document.querySelectorAll('.tab');
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾å†…å®¹
            var targetContent = document.getElementById(tabId);
            if (targetContent) {
                targetContent.classList.add('active');
            }
            
            // è®¾ç½®é€‰ä¸­æ ‡ç­¾çš„æ´»åŠ¨çŠ¶æ€
            for (var i = 0; i < tabs.length; i++) {
                var onclick = tabs[i].getAttribute('onclick');
                if (onclick && onclick.indexOf("switchTab('" + tabId + "')") !== -1) {
                    tabs[i].classList.add('active');
                    break;
                }
            }
            
            // å¦‚æœæ˜¯æŸ¥æ‰¾è¡Œç¨‹æ ‡ç­¾ï¼Œåˆ·æ–°åˆ—è¡¨
            if (tabId === 'find') {
                displayRides();
            }
            
            // å¦‚æœæ˜¯æˆ‘çš„è¡Œç¨‹æ ‡ç­¾ï¼Œåˆ·æ–°åˆ—è¡¨
            if (tabId === 'my-rides') {
                displayMyRides();
            }
        }
        
        // å‘å¸ƒè½¦æ‰¾äººä¿¡æ¯
        function publishRide(event) {
            event.preventDefault();
            
            // æ£€æŸ¥ç”¨æˆ·æƒé™
            if (!currentUser) {
                alert('ğŸ”’ è¯·å…ˆç™»å½•åå†å‘å¸ƒè¡Œç¨‹ä¿¡æ¯ï¼');
                showAuthModal();
                return;
            }
            
            // è·å–è¡¨å•æ•°æ®
            var rideData = {
                type: 'car-find-passenger',
                departure: document.getElementById('departure').value,
                destination: document.getElementById('destination').value,
                date: document.getElementById('date').value,
                time: document.getElementById('time').value,
                seats: document.getElementById('seats').value,
                price: document.getElementById('price').value,
                notes: document.getElementById('notes').value,
                name: document.getElementById('name').value,
                phone: document.getElementById('phone').value,
                publishTime: new Date().toLocaleString(),
                publisher: currentUser.username
            };
            
            // ä¿å­˜æ•°æ®
            rides.push(rideData);
            try {
                localStorage.setItem('rides', JSON.stringify(rides));
                console.log('è½¦æ‰¾äººä¿¡æ¯å·²ä¿å­˜ï¼Œå½“å‰æ€»æ•°ï¼š' + rides.length);
            } catch (e) {
                console.error('ä¿å­˜è½¦æ‰¾äººä¿¡æ¯å¤±è´¥:', e);
                alert('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
                return;
            }
            
            alert('ğŸš— è½¦æ‰¾äººä¿¡æ¯å‘å¸ƒæˆåŠŸï¼');
            
            // æ¸…ç©ºè¡¨å•
            event.target.reset();
            
            // åˆ·æ–°æˆ‘çš„è¡Œç¨‹é¡µé¢
            displayMyRides();
        }
        
        // å‘å¸ƒäººæ‰¾è½¦ä¿¡æ¯
        function publishPassenger(event) {
            event.preventDefault();
            
            // æ£€æŸ¥ç”¨æˆ·æƒé™
            if (!currentUser) {
                alert('ğŸ”’ è¯·å…ˆç™»å½•åå†å‘å¸ƒè¡Œç¨‹ä¿¡æ¯ï¼');
                showAuthModal();
                return;
            }
            
            // è·å–è¡¨å•æ•°æ®
            var passengerData = {
                type: 'passenger-find-car',
                departure: document.getElementById('passenger-departure').value,
                destination: document.getElementById('passenger-destination').value,
                date: document.getElementById('passenger-date').value,
                time: document.getElementById('passenger-time').value,
                count: document.getElementById('passenger-count').value,
                budget: document.getElementById('passenger-budget').value,
                notes: document.getElementById('passenger-notes').value,
                name: document.getElementById('passenger-name').value,
                phone: document.getElementById('passenger-phone').value,
                publishTime: new Date().toLocaleString(),
                publisher: currentUser.username
            };
            
            // ä¿å­˜æ•°æ®
            passengers.push(passengerData);
            try {
                localStorage.setItem('passengers', JSON.stringify(passengers));
                console.log('äººæ‰¾è½¦ä¿¡æ¯å·²ä¿å­˜ï¼Œå½“å‰æ€»æ•°ï¼š' + passengers.length);
            } catch (e) {
                console.error('ä¿å­˜äººæ‰¾è½¦ä¿¡æ¯å¤±è´¥:', e);
                alert('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
                return;
            }
            
            alert('ğŸš¶ äººæ‰¾è½¦ä¿¡æ¯å‘å¸ƒæˆåŠŸï¼');
            
            // æ¸…ç©ºè¡¨å•
            event.target.reset();
            
            // åˆ·æ–°æˆ‘çš„è¡Œç¨‹é¡µé¢
            displayMyRides();
        }
        
        // å‘å¸ƒå†œå‰¯äº§å“
        function publishProduct(event) {
            event.preventDefault();
            
            // è·å–è¡¨å•æ•°æ®
            var productData = {
                name: document.getElementById('product-name').value,
                category: document.getElementById('product-category').value,
                quantity: document.getElementById('product-quantity').value,
                price: document.getElementById('product-price').value,
                location: document.getElementById('product-location').value,
                harvest: document.getElementById('product-harvest').value,
                quality: document.getElementById('product-quality').value,
                description: document.getElementById('product-description').value,
                contact: document.getElementById('product-contact').value,
                phone: document.getElementById('product-phone').value,
                wechat: document.getElementById('product-wechat').value,
                publishTime: new Date().toLocaleString()
            };
            
            // ä¿å­˜æ•°æ®
            products.push(productData);
            try {
                localStorage.setItem('products', JSON.stringify(products));
                console.log('å†œå‰¯äº§å“ä¿¡æ¯å·²ä¿å­˜ï¼Œå½“å‰æ€»æ•°ï¼š' + products.length);
            } catch (e) {
                console.error('ä¿å­˜å†œå‰¯äº§å“ä¿¡æ¯å¤±è´¥:', e);
                alert('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
                return;
            }
            
            alert('ğŸŒ¾ å†œå‰¯äº§å“å‘å¸ƒæˆåŠŸï¼ä¿¡æ¯å·²ä¿å­˜åˆ°ç³»ç»Ÿã€‚');
            
            // æ¸…ç©ºè¡¨å•
            event.target.reset();
        }
        
        // å‘å¸ƒå•†æœºä¿¡æ¯
        function publishBusiness(event) {
            event.preventDefault();
            
            // è·å–è¡¨å•æ•°æ®
            var businessData = {
                title: document.getElementById('business-title').value,
                type: document.getElementById('business-type').value,
                investment: document.getElementById('business-investment').value,
                location: document.getElementById('business-location').value,
                expiry: document.getElementById('business-expiry').value,
                urgency: document.getElementById('business-urgency').value,
                description: document.getElementById('business-description').value,
                contact: document.getElementById('business-contact').value,
                phone: document.getElementById('business-phone').value,
                email: document.getElementById('business-email').value,
                publishTime: new Date().toLocaleString()
            };
            
            // ä¿å­˜æ•°æ®
            businesses.push(businessData);
            try {
                localStorage.setItem('businesses', JSON.stringify(businesses));
                console.log('å•†æœºä¿¡æ¯å·²ä¿å­˜ï¼Œå½“å‰æ€»æ•°ï¼š' + businesses.length);
            } catch (e) {
                console.error('ä¿å­˜å•†æœºä¿¡æ¯å¤±è´¥:', e);
                alert('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
                return;
            }
            
            alert('ğŸ’¼ å•†æœºä¿¡æ¯å‘å¸ƒæˆåŠŸï¼ä¿¡æ¯å·²ä¿å­˜åˆ°ç³»ç»Ÿã€‚');
            
            // æ¸…ç©ºè¡¨å•
            event.target.reset();
        }
        
        // æœç´¢è¡Œç¨‹
        function searchRides() {
            var searchTerm = document.getElementById('search-input').value.toLowerCase();
            var ridesContainer = document.getElementById('rides-container');
            
            if (!searchTerm) {
                displayRides();
                return;
            }
            
            // åˆå¹¶æ‰€æœ‰è¡Œç¨‹æ•°æ®
            var allRides = [];
            if (rides.length > 0) {
                allRides = allRides.concat(rides);
            }
            if (passengers.length > 0) {
                allRides = allRides.concat(passengers);
            }
            
            // æœç´¢åŒ¹é…çš„è¡Œç¨‹
            var searchResults = [];
            for (var i = 0; i < allRides.length; i++) {
                var ride = allRides[i];
                var searchIn = [
                    ride.departure || '',
                    ride.destination || '',
                    ride.name || '',
                    ride.phone || '',
                    ride.notes || ''
                ].join(' ').toLowerCase();
                
                if (searchIn.indexOf(searchTerm) !== -1) {
                    searchResults.push(ride);
                }
            }
            
            // æ˜¾ç¤ºæœç´¢ç»“æœ
            if (searchResults.length === 0) {
                ridesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸ”</p><p>æœªæ‰¾åˆ°åŒ¹é…çš„è¡Œç¨‹ï¼Œè¯·å°è¯•å…¶ä»–å…³é”®è¯</p></div>';
                return;
            }
            
            // ç”Ÿæˆæœç´¢ç»“æœHTML
            var html = '<h3 style="color: #ff5100; margin-bottom: 15px;">ğŸ” æœç´¢ç»“æœï¼šæ‰¾åˆ° ' + searchResults.length + ' ä¸ªåŒ¹é…è¡Œç¨‹</h3>';
            for (var i = 0; i < searchResults.length; i++) {
                var ride = searchResults[i];
                var typeIcon = ride.type === 'car-find-passenger' ? 'ğŸš—' : 'ğŸš¶';
                var typeName = ride.type === 'car-find-passenger' ? 'è½¦æ‰¾äºº' : 'äººæ‰¾è½¦';
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: #ff5100; margin: 0;">' + typeIcon + ' ' + typeName + '</h3>';
                html += '</div>';
                
                if (ride.departure && ride.destination) {
                    html += '<p><strong>è·¯çº¿ï¼š</strong>' + ride.departure + ' â†’ ' + ride.destination + '</p>';
                }
                
                if (ride.date && ride.time) {
                    html += '<p><strong>æ—¶é—´ï¼š</strong>' + ride.date + ' ' + ride.time + '</p>';
                }
                
                if (ride.seats) {
                    html += '<p><strong>åº§ä½ï¼š</strong>' + ride.seats + 'ä¸ª</p>';
                }
                
                if (ride.count) {
                    html += '<p><strong>äººæ•°ï¼š</strong>' + ride.count + 'äºº</p>';
                }
                
                if (ride.price) {
                    html += '<p><strong>è´¹ç”¨ï¼š</strong>' + ride.price + 'å…ƒ</p>';
                }
                
                if (ride.budget) {
                    html += '<p><strong>é¢„ç®—ï¼š</strong>' + ride.budget + 'å…ƒ</p>';
                }
                
                if (ride.name && ride.phone) {
                    // åœ¨"æˆ‘çš„è¡Œç¨‹"ä¸­æ˜¾ç¤ºå®Œæ•´å·ç ï¼Œå› ä¸ºæ˜¯è‡ªå·±å‘å¸ƒçš„
                    var isOwnRide = currentUser && ride.publisher === currentUser.username;
                    if (isOwnRide) {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + ride.name + ' (' + ride.phone + ')</p>';
                    } else {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + ride.name + ' (' + formatPhone(ride, i, 'my') + ')</p>';
                    }
                }
                
                if (ride.notes) {
                    html += '<p><strong>å¤‡æ³¨ï¼š</strong>' + ride.notes + '</p>';
                }
                
                if (ride.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + ride.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            ridesContainer.innerHTML = html;
        }
        
        // æ˜¾ç¤ºè¡Œç¨‹åˆ—è¡¨
        function displayRides() {
            var ridesContainer = document.getElementById('rides-container');
            
            // åˆå¹¶æ‰€æœ‰è¡Œç¨‹æ•°æ®
            var allRides = [];
            if (rides.length > 0) {
                allRides = allRides.concat(rides);
            }
            if (passengers.length > 0) {
                allRides = allRides.concat(passengers);
            }
            
            if (allRides.length === 0) {
                ridesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸš—</p><p>æš‚æ— å¯ç”¨è¡Œç¨‹ï¼Œè¯·ç¨åå†è¯•æˆ–å‘å¸ƒæ‚¨çš„è¡Œç¨‹</p></div>';
                return;
            }
            
            // æ˜¾ç¤ºæ‰€æœ‰è¡Œç¨‹
            var html = '<h3 style="color: #ff5100; margin-bottom: 15px;">ğŸš— æ‰€æœ‰å¯ç”¨è¡Œç¨‹ï¼ˆå…± ' + allRides.length + ' æ¡ï¼‰</h3>';
            for (var i = 0; i < allRides.length; i++) {
                var ride = allRides[i];
                var typeIcon = ride.type === 'car-find-passenger' ? 'ğŸš—' : 'ğŸš¶';
                var typeName = ride.type === 'car-find-passenger' ? 'è½¦æ‰¾äºº' : 'äººæ‰¾è½¦';
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: #ff5100; margin: 0;">' + typeIcon + ' ' + typeName + '</h3>';
                html += '</div>';
                
                if (ride.departure && ride.destination) {
                    html += '<p><strong>è·¯çº¿ï¼š</strong>' + ride.departure + ' â†’ ' + ride.destination + '</p>';
                }
                
                if (ride.date && ride.time) {
                    html += '<p><strong>æ—¶é—´ï¼š</strong>' + ride.date + ' ' + ride.time + '</p>';
                }
                
                if (ride.seats) {
                    html += '<p><strong>åº§ä½ï¼š</strong>' + ride.seats + 'ä¸ª</p>';
                }
                
                if (ride.count) {
                    html += '<p><strong>äººæ•°ï¼š</strong>' + ride.count + 'äºº</p>';
                }
                
                if (ride.price) {
                    html += '<p><strong>è´¹ç”¨ï¼š</strong>' + ride.price + 'å…ƒ</p>';
                }
                
                if (ride.budget) {
                    html += '<p><strong>é¢„ç®—ï¼š</strong>' + ride.budget + 'å…ƒ</p>';
                }
                
                if (ride.name && ride.phone) {
                    // åœ¨"æˆ‘çš„è¡Œç¨‹"ä¸­æ˜¾ç¤ºå®Œæ•´å·ç ï¼Œå› ä¸ºæ˜¯è‡ªå·±å‘å¸ƒçš„
                    var isOwnRide = currentUser && ride.publisher === currentUser.username;
                    if (isOwnRide) {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + ride.name + ' (' + ride.phone + ')</p>';
                    } else {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + ride.name + ' (' + formatPhone(ride, i, 'my') + ')</p>';
                    }
                }
                
                if (ride.notes) {
                    html += '<p><strong>å¤‡æ³¨ï¼š</strong>' + ride.notes + '</p>';
                }
                
                if (ride.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + ride.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            ridesContainer.innerHTML = html;
        }
        
        // æ˜¾ç¤ºæˆ‘çš„è¡Œç¨‹
        function displayMyRides() {
            var myRidesContainer = document.getElementById('my-rides-container');
            var allRides = [];
            
            // åˆå¹¶æ‰€æœ‰è¡Œç¨‹æ•°æ®
            if (rides.length > 0) {
                allRides = allRides.concat(rides);
            }
            if (passengers.length > 0) {
                allRides = allRides.concat(passengers);
            }
            
            if (allRides.length === 0) {
                myRidesContainer.innerHTML = '<div class="no-rides"><p style="font-size: 3rem; margin-bottom: 15px;">ğŸ‘¤</p><p>æ‚¨è¿˜æ²¡æœ‰å‘å¸ƒè¿‡è¡Œç¨‹</p></div>';
                return;
            }
            
            // æ˜¾ç¤ºè¡Œç¨‹åˆ—è¡¨
            var html = '';
            for (var i = 0; i < allRides.length; i++) {
                var ride = allRides[i];
                var typeIcon = ride.type === 'car-find-passenger' ? 'ğŸš—' : 'ğŸš¶';
                var typeName = ride.type === 'car-find-passenger' ? 'è½¦æ‰¾äºº' : 'äººæ‰¾è½¦';
                
                html += '<div class="ride-card">';
                html += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
                html += '<h3 style="color: #ff5100; margin: 0;">' + typeIcon + ' ' + typeName + '</h3>';
                html += '<button onclick="deleteRide(\'' + ride.type + '\', ' + i + ')" style="background: #dc3545; padding: 5px 10px; border-radius: 5px; font-size: 0.8rem;">åˆ é™¤</button>';
                html += '</div>';
                
                if (ride.departure && ride.destination) {
                    html += '<p><strong>è·¯çº¿ï¼š</strong>' + ride.departure + ' â†’ ' + ride.destination + '</p>';
                }
                
                if (ride.date && ride.time) {
                    html += '<p><strong>æ—¶é—´ï¼š</strong>' + ride.date + ' ' + ride.time + '</p>';
                }
                
                if (ride.seats) {
                    html += '<p><strong>åº§ä½ï¼š</strong>' + ride.seats + 'ä¸ª</p>';
                }
                
                if (ride.count) {
                    html += '<p><strong>äººæ•°ï¼š</strong>' + ride.count + 'äºº</p>';
                }
                
                if (ride.price) {
                    html += '<p><strong>è´¹ç”¨ï¼š</strong>' + ride.price + 'å…ƒ</p>';
                }
                
                if (ride.budget) {
                    html += '<p><strong>é¢„ç®—ï¼š</strong>' + ride.budget + 'å…ƒ</p>';
                }
                
                if (ride.name && ride.phone) {
                    // åœ¨"æˆ‘çš„è¡Œç¨‹"ä¸­æ˜¾ç¤ºå®Œæ•´å·ç ï¼Œå› ä¸ºæ˜¯è‡ªå·±å‘å¸ƒçš„
                    var isOwnRide = currentUser && ride.publisher === currentUser.username;
                    if (isOwnRide) {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + ride.name + ' (' + ride.phone + ')</p>';
                    } else {
                        html += '<p><strong>è”ç³»äººï¼š</strong>' + ride.name + ' (' + formatPhone(ride, i, 'my') + ')</p>';
                    }
                }
                
                if (ride.notes) {
                    html += '<p><strong>å¤‡æ³¨ï¼š</strong>' + ride.notes + '</p>';
                }
                
                if (ride.publishTime) {
                    html += '<p style="color: #666; font-size: 0.9rem;"><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>' + ride.publishTime + '</p>';
                }
                
                html += '</div>';
            }
            
            myRidesContainer.innerHTML = html;
        }
        
        // åˆ é™¤è¡Œç¨‹
        function deleteRide(type, index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè¡Œç¨‹å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ï¼')) {
                try {
                    if (type === 'car-find-passenger') {
                        rides.splice(index, 1);
                        localStorage.setItem('rides', JSON.stringify(rides));
                        console.log('è½¦æ‰¾äººä¿¡æ¯å·²åˆ é™¤ï¼Œå‰©ä½™ï¼š' + rides.length + ' æ¡');
                    } else if (type === 'passenger-find-car') {
                        passengers.splice(index, 1);
                        localStorage.setItem('passengers', JSON.stringify(passengers));
                        console.log('äººæ‰¾è½¦ä¿¡æ¯å·²åˆ é™¤ï¼Œå‰©ä½™ï¼š' + passengers.length + ' æ¡');
                    }
                    
                    // åˆ·æ–°æ˜¾ç¤º
                    displayMyRides();
                    alert('è¡Œç¨‹å·²åˆ é™¤ï¼');
                } catch (e) {
                    console.error('åˆ é™¤è¡Œç¨‹å¤±è´¥:', e);
                    alert('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
                }
            }
        }
        
        // æ˜¾ç¤ºå¯†ç éªŒè¯æ¨¡æ€æ¡†
        function showPasswordModal() {
            var modal = document.getElementById('password-modal');
            var passwordInput = document.getElementById('password-input');
            passwordInput.value = '';
            modal.style.display = 'flex';
        }
        
        // éšè—å¯†ç éªŒè¯æ¨¡æ€æ¡†
        function hidePasswordModal() {
            var modal = document.getElementById('password-modal');
            modal.style.display = 'none';
        }
        
        // éªŒè¯å¯†ç 
        function verifyPassword() {
            var passwordInput = document.getElementById('password-input');
            var password = passwordInput.value.trim();
            
            // é»˜è®¤å¯†ç ï¼šadmin123
            if (password === 'admin123') {
                hidePasswordModal();
                showAnnouncementModal();
            } else {
                alert('å¯†ç é”™è¯¯ï¼è¯·è”ç³»ç®¡ç†å‘˜è·å–æ­£ç¡®å¯†ç ã€‚');
                passwordInput.value = '';
                passwordInput.focus();
            }
        }
        
        // æ˜¾ç¤ºå…¬å‘Šç¼–è¾‘æ¨¡æ€æ¡†
        function showAnnouncementModal() {
            var modal = document.getElementById('announcement-modal');
            var textarea = document.getElementById('announcement-textarea');
            var currentText = document.getElementById('announcement-text').textContent;
            
            textarea.value = currentText;
            modal.style.display = 'flex';
        }
        
        // éšè—å…¬å‘Šç¼–è¾‘æ¨¡æ€æ¡†
        function hideAnnouncementModal() {
            var modal = document.getElementById('announcement-modal');
            modal.style.display = 'none';
        }
        
        // ä¿å­˜å…¬å‘Š
        function saveAnnouncement() {
            var textarea = document.getElementById('announcement-textarea');
            var announcementText = textarea.value.trim();
            
            if (announcementText) {
                document.getElementById('announcement-text').textContent = announcementText;
                alert('å…¬å‘Šæ›´æ–°æˆåŠŸï¼');
                hideAnnouncementModal();
                
                // ä¿å­˜åˆ°localStorageä»¥ä¾¿æŒä¹…åŒ–
                localStorage.setItem('announcementText', announcementText);
            } else {
                alert('è¯·è¾“å…¥å…¬å‘Šå†…å®¹ï¼');
            }
        }
        
        // ç”¨æˆ·ç³»ç»Ÿç›¸å…³å‡½æ•°
        
        // æ ¼å¼åŒ–ç”µè¯å·ç æ˜¾ç¤º
        function formatPhone(ride, index, context) {
            // æ£€æŸ¥æ˜¯å¦å·²ä»˜è´¹
            var contactId = ride.type + '_' + index;
            var hasPaid = paidContacts.some(function(paid) { 
                return paid.id === contactId && paid.username === (currentUser ? currentUser.username : 'guest');
            });
            
            // å¦‚æœæ˜¯è‡ªå·±çš„è¡Œç¨‹æˆ–è€…å·²ä»˜è´¹ï¼Œæ˜¾ç¤ºå®Œæ•´å·ç 
            var isOwnRide = currentUser && ride.publisher === currentUser.username;
            if (isOwnRide || hasPaid) {
                return '<span style="color: #28a745;">' + ride.phone + '</span>';
            }
            
            // å¦åˆ™æ˜¾ç¤ºéšè—å·ç å’Œä»˜è´¹æŒ‰é’®
            var hiddenPhone = ride.phone.substring(0, 3) + '****' + ride.phone.substring(7);
            return '<span class="phone-hidden">' + hiddenPhone + '</span>' + 
                   '<button class="reveal-phone-btn" onclick="showPaymentModal(\'' + ride.type + '\', ' + index + ')">æŸ¥çœ‹å·ç </button>';
        }
        
        // æ˜¾ç¤ºè®¤è¯æ¨¡æ€æ¡†
        function showAuthModal() {
            var modal = document.getElementById('auth-modal');
            modal.style.display = 'flex';
        }
        
        // éšè—è®¤è¯æ¨¡æ€æ¡†
        function hideAuthModal() {
            var modal = document.getElementById('auth-modal');
            modal.style.display = 'none';
        }
        
        // åˆ‡æ¢è®¤è¯æ ‡ç­¾
        function switchAuthTab(tab) {
            var loginTab = document.querySelector('.auth-tab:first-child');
            var registerTab = document.querySelector('.auth-tab:last-child');
            var loginForm = document.getElementById('login-form');
            var registerForm = document.getElementById('register-form');
            
            if (tab === 'login') {
                loginTab.classList.add('active');
                registerTab.classList.remove('active');
                loginForm.classList.add('active');
                registerForm.classList.remove('active');
            } else {
                loginTab.classList.remove('active');
                registerTab.classList.add('active');
                loginForm.classList.remove('active');
                registerForm.classList.add('active');
            }
        }
        
        // ç”¨æˆ·æ³¨å†Œ
        function register() {
            var username = document.getElementById('register-username').value.trim();
            var password = document.getElementById('register-password').value.trim();
            var phone = document.getElementById('register-phone').value.trim();
            
            if (!username || !password || !phone) {
                alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯ï¼');
                return;
            }
            
            if (password.length < 6) {
                alert('å¯†ç è‡³å°‘éœ€è¦6ä½ï¼');
                return;
            }
            
            // æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
            if (users.some(function(user) { return user.username === username; })) {
                alert('ç”¨æˆ·åå·²å­˜åœ¨ï¼');
                return;
            }
            
            // åˆ›å»ºæ–°ç”¨æˆ·
            var newUser = {
                username: username,
                password: password,
                phone: phone,
                registerTime: new Date().toLocaleString(),
                balance: 0 // åˆå§‹ä½™é¢
            };
            
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            alert('ğŸ‰ æ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•ã€‚');
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('register-form').reset();
            
            // åˆ‡æ¢åˆ°ç™»å½•æ ‡ç­¾
            switchAuthTab('login');
        }
        
        // ç”¨æˆ·ç™»å½•
        function login() {
            var username = document.getElementById('login-username').value.trim();
            var password = document.getElementById('login-password').value.trim();
            
            if (!username || !password) {
                alert('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼');
                return;
            }
            
            // æŸ¥æ‰¾ç”¨æˆ·
            var user = users.find(function(u) { 
                return u.username === username && u.password === password; 
            });
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateUserDisplay();
                hideAuthModal();
                alert('ğŸ‰ ç™»å½•æˆåŠŸï¼æ¬¢è¿å›æ¥ï¼Œ' + user.username + 'ï¼');
                
                // æ¸…ç©ºç™»å½•è¡¨å•
                document.getElementById('login-form').reset();
                
                // åˆ·æ–°æ˜¾ç¤º
                displayRides();
                displayMyRides();
            } else {
                alert('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼');
            }
        }
        
        // ç”¨æˆ·é€€å‡ºç™»å½•
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                currentUser = null;
                localStorage.removeItem('currentUser');
                updateUserDisplay();
                alert('ğŸ‘‹ å·²é€€å‡ºç™»å½•');
                
                // åˆ·æ–°æ˜¾ç¤º
                displayRides();
                displayMyRides();
            }
        }
        
        // æ›´æ–°ç”¨æˆ·æ˜¾ç¤º
        function updateUserDisplay() {
            var userInfo = document.getElementById('user-info');
            var userStatus = document.getElementById('user-status');
            
            if (currentUser) {
                var isAdmin = adminUsers.includes(currentUser.username);
                var statusText = currentUser.username + ' (Â¥' + (currentUser.balance || 0).toFixed(2) + ')';
                
                userInfo.classList.add('logged-in');
                userInfo.classList.remove('guest');
                
                // æ„å»ºç”¨æˆ·ä¿¡æ¯HTML
                var userHTML = '<span id="user-status">' + statusText + '</span>';
                
                // å¦‚æœæ˜¯ç®¡ç†å‘˜ï¼Œæ·»åŠ ç®¡ç†å‘˜æŒ‰é’®
                if (isAdmin) {
                    userHTML += '<button class="user-btn" onclick="showAdminPanel()">ç®¡ç†</button>';
                }
                
                userHTML += '<button class="user-btn logout" onclick="logout()">é€€å‡º</button>';
                
                userInfo.innerHTML = userHTML;
            } else {
                userInfo.classList.add('guest');
                userInfo.classList.remove('logged-in');
                
                // æ›´æ–°æŒ‰é’®
                userInfo.innerHTML = '<span id="user-status">æ¸¸å®¢æ¨¡å¼</span>' +
                                 '<button class="user-btn" onclick="showAuthModal()">ç™»å½•/æ³¨å†Œ</button>';
            }
        }
        
        // æ˜¾ç¤ºä»˜è´¹æ¨¡æ€æ¡†
        function showPaymentModal(type, index) {
            currentViewingRide = index;
            currentViewingType = type;
            
            // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
            if (!currentUser) {
                alert('ğŸ”’ è¯·å…ˆç™»å½•åå†æŸ¥çœ‹è”ç³»æ–¹å¼ï¼');
                showAuthModal();
                return;
            }
            
            // æ£€æŸ¥ä½™é¢
            if ((currentUser.balance || 0) < 0.2) {
                alert('ğŸ’° ä½™é¢ä¸è¶³ï¼è¯·å……å€¼åå†æŸ¥çœ‹è”ç³»æ–¹å¼ã€‚\nå½“å‰ä½™é¢ï¼šÂ¥' + (currentUser.balance || 0).toFixed(2));
                return;
            }
            
            var modal = document.getElementById('payment-modal');
            modal.style.display = 'flex';
        }
        
        // éšè—ä»˜è´¹æ¨¡æ€æ¡†
        function hidePaymentModal() {
            var modal = document.getElementById('payment-modal');
            modal.style.display = 'none';
        }
        
        // æ¨¡æ‹Ÿæ”¯ä»˜
        function simulatePayment() {
            if (!currentUser || currentViewingRide === null) {
                alert('å‚æ•°é”™è¯¯ï¼');
                return;
            }
            
            // æ‰£é™¤è´¹ç”¨
            currentUser.balance = (currentUser.balance || 0) - 0.2;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            // æ›´æ–°ç”¨æˆ·åˆ—è¡¨ä¸­çš„ä½™é¢
            var userIndex = users.findIndex(function(u) { return u.username === currentUser.username; });
            if (userIndex !== -1) {
                users[userIndex].balance = currentUser.balance;
                localStorage.setItem('users', JSON.stringify(users));
            }
            
            // è®°å½•å·²ä»˜è´¹æŸ¥çœ‹
            var contactId = currentViewingType + '_' + currentViewingRide;
            paidContacts.push({
                id: contactId,
                username: currentUser.username,
                paymentTime: new Date().toLocaleString(),
                amount: 0.2
            });
            localStorage.setItem('paidContacts', JSON.stringify(paidContacts));
            
            // æ›´æ–°æ˜¾ç¤º
            updateUserDisplay();
            hidePaymentModal();
            alert('ğŸ’° æ”¯ä»˜æˆåŠŸï¼ç°åœ¨å¯ä»¥æŸ¥çœ‹è”ç³»æ–¹å¼äº†ã€‚');
            
            // åˆ·æ–°æ˜¾ç¤º
            if (document.getElementById('find').classList.contains('active')) {
                searchRides();
            } else if (document.getElementById('my-rides').classList.contains('active')) {
                displayMyRides();
            } else {
                displayRides();
            }
        }

        // ç®¡ç†å‘˜åŠŸèƒ½ç›¸å…³å‡½æ•°
        
        // æ˜¾ç¤ºç®¡ç†å‘˜é¢æ¿
        function showAdminPanel() {
            if (!currentUser || !adminUsers.includes(currentUser.username)) {
                alert('ğŸ”’ æ‚¨æ²¡æœ‰ç®¡ç†å‘˜æƒé™ï¼');
                return;
            }
            
            var panel = document.getElementById('admin-panel');
            panel.classList.add('show');
            
            // åŠ è½½ç”¨æˆ·åˆ—è¡¨
            loadAdminUserList();
            
            // åŠ è½½åˆ†äº«è®°å½•
            loadShareRecords();
        }
        
        // éšè—ç®¡ç†å‘˜é¢æ¿
        function hideAdminPanel() {
            var panel = document.getElementById('admin-panel');
            panel.classList.remove('show');
        }
        
        // åŠ è½½ç®¡ç†å‘˜ç”¨æˆ·åˆ—è¡¨
        function loadAdminUserList() {
            var userList = document.getElementById('admin-user-list');
            var usernameSelect = document.getElementById('recharge-username');
            
            // æ¸…ç©ºç°æœ‰å†…å®¹
            userList.innerHTML = '';
            usernameSelect.innerHTML = '<option value="">è¯·é€‰æ‹©ç”¨æˆ·</option>';
            
            if (users.length === 0) {
                userList.innerHTML = '<div class="user-item">æš‚æ— ç”¨æˆ·</div>';
                return;
            }
            
            // æ·»åŠ ç”¨æˆ·åˆ°åˆ—è¡¨å’Œé€‰æ‹©æ¡†
            users.forEach(function(user) {
                // æ·»åŠ åˆ°ç”¨æˆ·åˆ—è¡¨
                var userItem = document.createElement('div');
                userItem.className = 'user-item';
                userItem.innerHTML = '<span>' + user.username + '</span>' +
                                    '<span class="balance-info">Â¥' + (user.balance || 0).toFixed(2) + '</span>';
                userList.appendChild(userItem);
                
                // æ·»åŠ åˆ°é€‰æ‹©æ¡†
                var option = document.createElement('option');
                option.value = user.username;
                option.textContent = user.username + ' (ä½™é¢: Â¥' + (user.balance || 0).toFixed(2) + ')';
                usernameSelect.appendChild(option);
            });
        }
        
        // ç®¡ç†å‘˜å……å€¼
        function adminRecharge() {
            var username = document.getElementById('recharge-username').value;
            var amount = parseFloat(document.getElementById('recharge-amount').value);
            var note = document.getElementById('recharge-note').value.trim();
            
            if (!username) {
                alert('è¯·é€‰æ‹©è¦å……å€¼çš„ç”¨æˆ·ï¼');
                return;
            }
            
            if (!amount || amount <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„å……å€¼é‡‘é¢ï¼');
                return;
            }
            
            // æŸ¥æ‰¾ç”¨æˆ·
            var userIndex = users.findIndex(function(u) { return u.username === username; });
            if (userIndex === -1) {
                alert('ç”¨æˆ·ä¸å­˜åœ¨ï¼');
                return;
            }
            
            // æ›´æ–°ç”¨æˆ·ä½™é¢
            users[userIndex].balance = (users[userIndex].balance || 0) + amount;
            
            // è®°å½•å……å€¼è®°å½•
            var rechargeRecord = {
                username: username,
                amount: amount,
                note: note || 'ç®¡ç†å‘˜å……å€¼',
                admin: currentUser.username,
                timestamp: new Date().toLocaleString()
            };
            
            // ä¿å­˜å……å€¼è®°å½•
            if (!users[userIndex].rechargeRecords) {
                users[userIndex].rechargeRecords = [];
            }
            users[userIndex].rechargeRecords.push(rechargeRecord);
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('users', JSON.stringify(users));
            
            // å¦‚æœæ˜¯å½“å‰ç™»å½•ç”¨æˆ·ï¼ŒåŒæ—¶æ›´æ–°currentUser
            if (currentUser && currentUser.username === username) {
                currentUser.balance = users[userIndex].balance;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateUserDisplay();
            }
            
            // åˆ·æ–°ç®¡ç†é¢æ¿
            loadAdminUserList();
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('recharge-amount').value = '';
            document.getElementById('recharge-note').value = '';
            document.getElementById('recharge-username').value = '';
            
            alert('âœ… å……å€¼æˆåŠŸï¼\nç”¨æˆ·ï¼š' + username + '\né‡‘é¢ï¼šÂ¥' + amount.toFixed(2) + '\nå¤‡æ³¨ï¼š' + note);
        }
        
        // åŠ è½½åˆ†äº«è®°å½•
        function loadShareRecords() {
            var recordsContainer = document.getElementById('share-records');
            
            if (shareRecords.length === 0) {
                recordsContainer.innerHTML = '<div class="user-item">æš‚æ— åˆ†äº«è®°å½•</div>';
                return;
            }
            
            recordsContainer.innerHTML = '';
            
            // æŒ‰æ—¶é—´å€’åºæ’åˆ—
            var sortedRecords = shareRecords.slice().sort(function(a, b) {
                return new Date(b.timestamp) - new Date(a.timestamp);
            });
            
            // åªæ˜¾ç¤ºæœ€è¿‘20æ¡è®°å½•
            var recentRecords = sortedRecords.slice(0, 20);
            
            recentRecords.forEach(function(record) {
                var recordItem = document.createElement('div');
                recordItem.className = 'user-item';
                recordItem.innerHTML = '<span>' + record.username + ' (' + record.type + ')</span>' +
                                    '<span style="color: #28a745;">Â¥0.10</span>';
                recordItem.title = 'æ—¶é—´ï¼š' + record.timestamp;
                recordsContainer.appendChild(recordItem);
            });
        }

        // åˆ†äº«åŠŸèƒ½ç›¸å…³å‡½æ•°
        
        // åˆ†äº«åˆ°å¾®ä¿¡ç¾¤
        function shareToWechat() {
            if (!currentUser) {
                alert('ğŸ”’ è¯·å…ˆç™»å½•åå†åˆ†äº«ï¼');
                showAuthModal();
                return;
            }
            
            // å¤åˆ¶é“¾æ¥åˆ°å‰ªè´´æ¿
            var shareUrl = window.location.href;
            var shareText = 'ã€æ¹˜Mé¡ºé£è½¦ã€‘ç»¿è‰²å‡ºè¡Œï¼Œä¾¿æ°‘åˆ©æ°‘ï¼è½¦æ‰¾äººã€äººæ‰¾è½¦ï¼Œè¿˜æœ‰å†œå‰¯äº§å“å•†æœºå‘å¸ƒï¼Œèµ¶å¿«åŠ å…¥å§ï¼\n' + shareUrl;
            
            copyToClipboard(shareText);
            
            // éªŒè¯åˆ†äº«
            verifyShare('å¾®ä¿¡ç¾¤');
        }
        
        // åˆ†äº«åˆ°æœ‹å‹åœˆ
        function shareToMoments() {
            if (!currentUser) {
                alert('ğŸ”’ è¯·å…ˆç™»å½•åå†åˆ†äº«ï¼');
                showAuthModal();
                return;
            }
            
            // ç›´æ¥å¤åˆ¶é“¾æ¥å¹¶éªŒè¯
            var shareUrl = window.location.href;
            var shareText = 'ã€æ¹˜Mé¡ºé£è½¦ã€‘ç»¿è‰²å‡ºè¡Œï¼Œä¾¿æ°‘åˆ©æ°‘ï¼è½¦æ‰¾äººã€äººæ‰¾è½¦ï¼Œè¿˜æœ‰å†œå‰¯äº§å“å•†æœºå‘å¸ƒï¼Œèµ¶å¿«åŠ å…¥å§ï¼\n' + shareUrl;
            
            copyToClipboard(shareText);
            
            // ç®€åŒ–éªŒè¯ï¼šç‚¹å‡»å³è§†ä¸ºåˆ†äº«æˆåŠŸ
            verifyShare('æœ‹å‹åœˆ');
        }
        
        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard(text) {
            var textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                document.execCommand('copy');
                showShareStatus('âœ… é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            } catch (err) {
                showShareStatus('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ï¼š\n' + text);
            }
            
            document.body.removeChild(textarea);
        }
        
        // éªŒè¯åˆ†äº«å¹¶å‘æ”¾å¥–åŠ±
        function verifyShare(shareType) {
            if (!currentUser) return;
            
            // è·å–ä»Šæ—¥æ—¥æœŸ
            var today = new Date().toDateString();
            
            // è·å–ä»Šæ—¥åˆ†äº«è®°å½•ï¼ˆåŒ…æ‹¬ä¸è®¡è´¹çš„ï¼‰
            var todayAllRecords = shareRecords.filter(function(record) {
                return record.username === currentUser.username && 
                       record.timestamp.startsWith(today.substring(0, 10));
            });
            
            // è·å–ä»Šæ—¥å·²è®¡è´¹æ¬¡æ•°
            var todayPaidRecords = todayAllRecords.filter(function(record) {
                return record.amount > 0;
            });
            
            // æ£€æŸ¥ä»Šæ—¥å·²åˆ†äº«æ¬¡æ•°
            var totalShareCount = todayAllRecords.length;
            var paidShareCount = todayPaidRecords.length;
            
            // è®°å½•åˆ†äº«ï¼ˆå§‹ç»ˆè®°å½•ï¼Œä½†ä¸ä¸€å®šç»™å¥–åŠ±ï¼‰
            var shareRecord = {
                username: currentUser.username,
                type: shareType,
                amount: 0, // é»˜è®¤æ— å¥–åŠ±
                timestamp: new Date().toLocaleString()
            };
            
            var shouldGiveReward = false;
            var message = '';
            
            if (paidShareCount >= 5) {
                // å‰5æ¬¡å·²ç»è·å¾—å¥–åŠ±ï¼Œæœ¬æ¬¡ä¸ç»™å¥–åŠ±
                message = 'ğŸ“± åˆ†äº«å·²è®°å½•ï¼ä»Šæ—¥å‰5æ¬¡åˆ†äº«å·²è·å¾—å¥–åŠ±ï¼Œåç»­åˆ†äº«æ— å¥–åŠ±ã€‚';
            } else {
                // å‰5æ¬¡å†…ï¼Œç»™å¥–åŠ±
                shareRecord.amount = 0.10;
                shouldGiveReward = true;
                message = 'ğŸ‰ åˆ†äº«æˆåŠŸï¼è·å¾— Â¥0.10 å¥–åŠ±ï¼Œå·²è‡ªåŠ¨åˆ°è´¦ï¼';
            }
            
            // ä¿å­˜åˆ†äº«è®°å½•
            shareRecords.push(shareRecord);
            localStorage.setItem('shareRecords', JSON.stringify(shareRecords));
            
            // å¦‚æœéœ€è¦ç»™å¥–åŠ±
            if (shouldGiveReward) {
                currentUser.balance = (currentUser.balance || 0) + 0.10;
                
                // æ›´æ–°ç”¨æˆ·åˆ—è¡¨
                var userIndex = users.findIndex(function(u) { return u.username === currentUser.username; });
                if (userIndex !== -1) {
                    users[userIndex].balance = currentUser.balance;
                    localStorage.setItem('users', JSON.stringify(users));
                }
                
                // ä¿å­˜å½“å‰ç”¨æˆ·
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
            }
            
            // æ›´æ–°æ˜¾ç¤º
            updateUserDisplay();
            updateTodayShareAmount();
            updateShareCountDisplay(totalShareCount + 1, paidShareCount + (shouldGiveReward ? 1 : 0));
            
            showShareStatus(message);
        }
        
        // æ˜¾ç¤ºåˆ†äº«çŠ¶æ€
        function showShareStatus(message) {
            var statusElement = document.getElementById('share-status');
            statusElement.textContent = message;
            statusElement.style.color = message.includes('æˆåŠŸ') ? '#28a745' : '#dc3545';
            
            // 3ç§’åæ¢å¤é»˜è®¤çŠ¶æ€
            setTimeout(function() {
                statusElement.textContent = 'åˆ†äº«æˆåŠŸåå¥–åŠ±å°†è‡ªåŠ¨åˆ°è´¦';
                statusElement.style.color = '#666';
            }, 3000);
        }
        
        // æ›´æ–°ä»Šæ—¥åˆ†äº«é‡‘é¢
        function updateTodayShareAmount() {
            if (!currentUser) {
                document.getElementById('today-share-amount').textContent = '0.00';
                return;
            }
            
            var today = new Date().toDateString();
            var todayPaidRecords = shareRecords.filter(function(record) {
                return record.username === currentUser.username && 
                       record.timestamp.startsWith(today.substring(0, 10)) &&
                       record.amount > 0;
            });
            
            var todayAmount = todayPaidRecords.length * 0.10;
            document.getElementById('today-share-amount').textContent = todayAmount.toFixed(2);
        }
        
        // æ›´æ–°åˆ†äº«æ¬¡æ•°æ˜¾ç¤º
        function updateShareCountDisplay(totalCount, paidCount) {
            if (!currentUser) return;
            
            var countElement = document.getElementById('today-share-count');
            if (countElement) {
                countElement.textContent = paidCount + '/5';
            }
        }
        
        // åˆå§‹åŒ–åˆ†äº«æ¬¡æ•°æ˜¾ç¤º
        function initShareCountDisplay() {
            if (!currentUser) {
                var countElement = document.getElementById('today-share-count');
                if (countElement) {
                    countElement.textContent = '0/5';
                }
                return;
            }
            
            var today = new Date().toDateString();
            var todayAllRecords = shareRecords.filter(function(record) {
                return record.username === currentUser.username && 
                       record.timestamp.startsWith(today.substring(0, 10));
            });
            
            var todayPaidRecords = todayAllRecords.filter(function(record) {
                return record.amount > 0;
            });
            
            updateShareCountDisplay(todayAllRecords.length, todayPaidRecords.length);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆ
        window.onload = function() {
            console.log('æ¹˜Mé¡ºé£è½¦å¹³å°åŠ è½½å®Œæˆï¼');
            
            // æ•°æ®åŠ è½½ä¿æŠ¤å‡½æ•° - é˜²æ­¢æ•°æ®ä¸¢å¤±
            function safeLoadData(key, defaultEmptyArray = false) {
                try {
                    var savedData = localStorage.getItem(key);
                    if (savedData) {
                        var parsed = JSON.parse(savedData);
                        // ç¡®ä¿è¿”å›çš„æ˜¯æ•°ç»„
                        return Array.isArray(parsed) ? parsed : [];
                    }
                    return defaultEmptyArray ? [] : null;
                } catch (e) {
                    console.warn('åŠ è½½æ•°æ®å¤±è´¥ [' + key + ']:', e);
                    return defaultEmptyArray ? [] : null;
                }
            }
            
            // æ•°æ®æ¢å¤æ£€æŸ¥ - æ£€æŸ¥æ˜¯å¦éœ€è¦ä»å¤‡ä»½æ¢å¤
            function checkAndRestoreFromBackup() {
                var backupKeys = Object.keys(localStorage).filter(function(key) {
                    return key.startsWith('backup_');
                });
                
                if (backupKeys.length > 0) {
                    backupKeys.sort().reverse(); // è·å–æœ€æ–°çš„å¤‡ä»½
                    
                    try {
                        var latestBackup = JSON.parse(localStorage.getItem(backupKeys[0]));
                        var backupTime = new Date(latestBackup.timestamp);
                        var now = new Date();
                        
                        // æ£€æŸ¥ä¸»è¦æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœéƒ½ä¸å­˜åœ¨åˆ™ä»å¤‡ä»½æ¢å¤
                        var hasMainData = localStorage.getItem('rides') || 
                                         localStorage.getItem('passengers') || 
                                         localStorage.getItem('products') || 
                                         localStorage.getItem('businesses');
                        
                        if (!hasMainData) {
                            console.log('æ£€æµ‹åˆ°æ•°æ®ä¸¢å¤±ï¼Œä»å¤‡ä»½æ¢å¤ï¼š' + backupKeys[0]);
                            
                            if (latestBackup.rides) rides = latestBackup.rides;
                            if (latestBackup.passengers) passengers = latestBackup.passengers;
                            if (latestBackup.products) products = latestBackup.products;
                            if (latestBackup.businesses) businesses = latestBackup.businesses;
                            if (latestBackup.users) users = latestBackup.users;
                            if (latestBackup.shareRecords) shareRecords = latestBackup.shareRecords;
                            if (latestBackup.paidContacts) paidContacts = latestBackup.paidContacts;
                            
                            // æ¢å¤åˆ°localStorage
                            localStorage.setItem('rides', JSON.stringify(rides));
                            localStorage.setItem('passengers', JSON.stringify(passengers));
                            localStorage.setItem('products', JSON.stringify(products));
                            localStorage.setItem('businesses', JSON.stringify(businesses));
                            localStorage.setItem('users', JSON.stringify(users));
                            localStorage.setItem('shareRecords', JSON.stringify(shareRecords));
                            localStorage.setItem('paidContacts', JSON.stringify(paidContacts));
                            
                            console.log('æ•°æ®æ¢å¤å®Œæˆ');
                            return true;
                        }
                    } catch (e) {
                        console.warn('å¤‡ä»½æ¢å¤å¤±è´¥:', e);
                    }
                }
                return false;
            }
            
            // å°è¯•ä»å¤‡ä»½æ¢å¤æ•°æ®
            var restored = checkAndRestoreFromBackup();
            if (restored) {
                console.log('å·²ä»å¤‡ä»½æ¢å¤æ•°æ®');
            }
            
            // åŠ è½½å‘å¸ƒæ•°æ®ï¼ˆä¼˜å…ˆåŠ è½½ï¼Œé˜²æ­¢è¢«ç”¨æˆ·åˆå§‹åŒ–è¦†ç›–ï¼‰
            rides = safeLoadData('rides', true);
            passengers = safeLoadData('passengers', true);
            products = safeLoadData('products', true);
            businesses = safeLoadData('businesses', true);
            
            // åŠ è½½ç”¨æˆ·æ•°æ®
            var savedUsers = safeLoadData('users');
            if (savedUsers && savedUsers.length > 0) {
                users = savedUsers;
                console.log('å·²åŠ è½½ç”¨æˆ·æ•°æ®ï¼š' + users.length + ' ä¸ªç”¨æˆ·');
            } else {
                console.log('é¦–æ¬¡ä½¿ç”¨ï¼Œåˆ›å»ºæµ‹è¯•ç”¨æˆ·');
                // åˆ›å»ºæµ‹è¯•ç”¨æˆ·
                users = [
                    {
                        username: 'admin',
                        password: 'admin123',
                        phone: '13800138000',
                        registerTime: new Date().toLocaleString(),
                        balance: 100.00,
                        rechargeRecords: []
                    },
                    {
                        username: 'test',
                        password: '123456',
                        phone: '13800138001',
                        registerTime: new Date().toLocaleString(),
                        balance: 10.00,
                        rechargeRecords: []
                    }
                ];
                localStorage.setItem('users', JSON.stringify(users));
            }
            
            // åŠ è½½å½“å‰ç™»å½•ç”¨æˆ·
            var savedCurrentUser = localStorage.getItem('currentUser');
            if (savedCurrentUser) {
                try {
                    currentUser = JSON.parse(savedCurrentUser);
                } catch (e) {
                    console.warn('åŠ è½½å½“å‰ç”¨æˆ·å¤±è´¥:', e);
                    currentUser = null;
                }
            }
            
            // åŠ è½½ä»˜è´¹è®°å½•
            paidContacts = safeLoadData('paidContacts', true);
            
            // åŠ è½½åˆ†äº«è®°å½•
            shareRecords = safeLoadData('shareRecords', true);
            
            // åŠ è½½ä¿å­˜çš„å…¬å‘Šå†…å®¹
            var savedAnnouncement = localStorage.getItem('announcementText');
            if (savedAnnouncement) {
                var announcementElement = document.getElementById('announcement-text');
                if (announcementElement) {
                    announcementElement.textContent = savedAnnouncement;
                }
            }
            
            // æ•°æ®å®Œæ•´æ€§æ£€æŸ¥å’Œæ—¥å¿—
            console.log('æ•°æ®åŠ è½½å®Œæˆï¼š');
            console.log('- è½¦æ‰¾äººä¿¡æ¯ï¼š' + rides.length + ' æ¡');
            console.log('- äººæ‰¾è½¦ä¿¡æ¯ï¼š' + passengers.length + ' æ¡');
            console.log('- å†œå‰¯äº§å“ï¼š' + products.length + ' æ¡');
            console.log('- å•†æœºä¿¡æ¯ï¼š' + businesses.length + ' æ¡');
            console.log('- ç”¨æˆ·æ•°æ®ï¼š' + users.length + ' ä¸ªç”¨æˆ·');
            
            // æ›´æ–°ç”¨æˆ·æ˜¾ç¤º
            updateUserDisplay();
            
            // æ›´æ–°ä»Šæ—¥åˆ†äº«é‡‘é¢
            updateTodayShareAmount();
            
            // åˆå§‹åŒ–åˆ†äº«æ¬¡æ•°æ˜¾ç¤º
            initShareCountDisplay();
            
            // é»˜è®¤æ˜¾ç¤ºæŸ¥æ‰¾è¡Œç¨‹
            switchTab('find');
        };
        
        // æ•°æ®å¤‡ä»½åŠŸèƒ½ - åˆ›å»ºè‡ªåŠ¨å¤‡ä»½
        function createDataBackup() {
            try {
                var backupData = {
                    timestamp: new Date().toISOString(),
                    rides: rides,
                    passengers: passengers,
                    products: products,
                    businesses: businesses,
                    users: users,
                    shareRecords: shareRecords,
                    paidContacts: paidContacts
                };
                
                var backupKey = 'backup_' + new Date().getTime();
                localStorage.setItem(backupKey, JSON.stringify(backupData));
                
                // ä¿ç•™æœ€è¿‘10ä¸ªå¤‡ä»½
                var allKeys = Object.keys(localStorage).filter(function(key) {
                    return key.startsWith('backup_');
                });
                
                if (allKeys.length > 10) {
                    allKeys.sort();
                    for (var i = 0; i < allKeys.length - 10; i++) {
                        localStorage.removeItem(allKeys[i]);
                    }
                }
                
                console.log('æ•°æ®å¤‡ä»½å·²åˆ›å»ºï¼š' + backupKey);
            } catch (e) {
                console.error('åˆ›å»ºæ•°æ®å¤‡ä»½å¤±è´¥:', e);
            }
        }
        
        // å®šæœŸåˆ›å»ºå¤‡ä»½ï¼ˆæ¯5åˆ†é’Ÿï¼‰
        setInterval(function() {
            if (currentUser) {
                createDataBackup();
            }
        }, 5 * 60 * 1000);
    </script>
</body>
</html>